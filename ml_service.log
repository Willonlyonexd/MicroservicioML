#12025-05-29 23:49:41.442 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-29 23:49:41.442 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-29 23:49:41.789 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-29 23:49:41.790 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.18 segundos
2025-05-29 23:51:14.049 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-29 23:51:14.050 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-29 23:51:14.284 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-29 23:51:14.285 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-29 23:51:17.181 | INFO     | __main__:main:260 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-29 23:51:17.182 | INFO     | __main__:main:261 - Modo desarrollo: True
2025-05-29 23:51:17.183 | INFO     | __main__:test_connections:17 - Probando conexiones a bases de datos...
2025-05-29 23:51:17.184 | INFO     | __main__:test_connections:24 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-29 23:51:17.187 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-29 23:51:17.187 | INFO     | __main__:test_connections:33 - Conexión a PostgreSQL funciona correctamente
2025-05-29 23:51:17.189 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-29 23:51:17.190 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-29 23:51:17.192 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-29 23:51:17.194 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-29 23:51:17.196 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-29 23:51:17.197 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-29 23:51:17.199 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-29 23:51:17.200 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-29 23:51:17.201 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-29 23:51:17.203 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-29 23:51:17.204 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-29 23:51:17.205 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-29 23:51:17.205 | INFO     | __main__:main:276 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-29 23:51:17.206 | INFO     | __main__:run_ml_forecast:109 - Iniciando módulo de forecasting...
2025-05-29 23:51:17.206 | INFO     | __main__:run_ml_forecast:133 - Iniciando entrenamiento de nuevo modelo general...
2025-05-29 23:51:17.207 | INFO     | __main__:run_ml_forecast:146 - Entrenando en CPU
2025-05-29 23:51:23.029 | INFO     | __main__:run_ml_forecast:153 - Entrenamiento del modelo general completado en 5.82 segundos
2025-05-29 23:51:23.030 | INFO     | __main__:run_ml_forecast:157 - Guardando modelo general entrenado...
2025-05-29 23:51:23.072 | INFO     | __main__:run_ml_forecast:160 - Modelo general guardado en models/forecast
2025-05-29 23:51:23.073 | INFO     | __main__:run_ml_forecast:167 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-29 23:51:23.298 | INFO     | __main__:run_ml_forecast:178 - Entrenamiento de 0/0 modelos de productos completado en 0.22 segundos
2025-05-29 23:51:23.299 | INFO     | __main__:run_ml_forecast:192 - Generando predicciones generales...
2025-05-29 23:51:23.706 | INFO     | __main__:run_ml_forecast:194 - Predicciones generales generadas para los próximos 7 días
2025-05-29 23:51:23.707 | INFO     | __main__:run_ml_forecast:197 - Guardando predicciones generales en MongoDB...
2025-05-29 23:51:23.715 | INFO     | __main__:run_ml_forecast:221 - Generando visualización de predicciones generales...
2025-05-29 23:51:25.015 | INFO     | __main__:run_ml_forecast:226 - Visualización general guardada en plots\forecast_20250529_235124.png
2025-05-29 23:51:25.016 | INFO     | __main__:run_ml_forecast:244 - Proceso de forecasting completado exitosamente
2025-05-29 23:51:25.019 | INFO     | __main__:main:288 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-29 23:51:25.022 | INFO     | __main__:main:294 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 00:01:58.556 | INFO     | __main__:main:299 - Programa interrumpido por el usuario
2025-05-30 00:01:58.556 | INFO     | __main__:main:303 - Servicio finalizado. Cerrando conexiones...
2025-05-30 00:01:58.558 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 00:01:58.560 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 00:02:02.239 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:02:02.239 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:02:02.483 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:02:02.484 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:02:26.762 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:02:26.763 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:02:27.011 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:02:27.012 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:04:28.873 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:04:28.874 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:04:29.104 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:04:29.104 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:07:00.813 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:07:00.814 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 00:07:01.043 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:07:01.044 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:11:24.209 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:11:24.209 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:11:24.440 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:11:24.440 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:12:01.035 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:12:01.036 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:12:01.275 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:12:01.275 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:12:46.398 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:12:46.399 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:12:46.647 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:12:46.648 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.08 segundos
2025-05-30 00:13:33.847 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:13:33.847 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:13:34.243 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:13:34.245 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.12 segundos
2025-05-30 00:15:58.679 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:15:58.680 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:15:58.925 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:15:58.926 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:16:55.456 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:16:55.457 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 00:16:55.684 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:16:55.684 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-05-30 00:20:47.143 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:20:47.143 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:20:47.366 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:20:47.367 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-05-30 00:27:03.042 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:27:03.042 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 00:27:03.269 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:27:03.270 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:29:11.807 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:29:11.807 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 00:29:12.061 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:29:12.062 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:29:15.226 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 00:29:15.227 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 00:29:15.228 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 00:29:15.230 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 00:29:15.232 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 00:29:15.233 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 00:29:15.234 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 00:29:15.236 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 00:29:15.237 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 00:29:15.238 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 00:29:15.240 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 00:29:15.242 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 00:29:15.243 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 00:29:15.244 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 00:29:15.246 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 00:29:15.247 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 00:29:15.248 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 00:29:15.249 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 00:29:15.249 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 00:29:15.250 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 00:29:15.250 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 00:29:15.252 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 00:29:15.262 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 00:29:15.264 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 00:29:15.274 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 00:29:15.276 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 00:29:15.278 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 00:29:15.280 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 00:29:15.281 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 00:29:15.304 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 00:29:15.305 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 00:29:15.306 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 00:29:15.307 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 00:29:22.916 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 7.61 segundos
2025-05-30 00:29:22.916 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 00:29:22.975 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 00:29:22.975 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 00:29:23.102 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.13 segundos
2025-05-30 00:29:23.102 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 00:29:23.450 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 00:29:23.451 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 00:29:23.468 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 00:29:24.556 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_002924.png
2025-05-30 00:29:24.558 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 00:29:24.559 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 00:29:24.560 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 15:39:28.462 | ERROR    | db.mongo_client:_connect:37 - No se pudo conectar a MongoDB: localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión, Timeout: 5.0s, Topology Description: <TopologyDescription id: 683a096b9f86104cd16488d6, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión')>]>
2025-05-30 15:40:40.857 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 15:40:40.858 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 15:40:41.190 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 15:40:41.191 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.10 segundos
2025-05-30 15:40:46.149 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 15:40:46.149 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 15:40:46.150 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 15:40:46.151 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 15:40:46.153 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 15:40:46.155 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 15:40:46.159 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 15:40:46.161 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 15:40:46.163 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 15:40:46.165 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 15:40:46.166 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 15:40:46.168 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 15:40:46.169 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 15:40:46.171 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 15:40:46.172 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 15:40:46.173 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 15:40:46.174 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 15:40:46.174 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 15:40:46.175 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 15:40:46.175 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 15:40:46.176 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 15:40:46.178 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 15:40:46.195 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 15:40:46.197 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 15:40:46.225 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 15:40:46.227 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 15:40:46.231 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 15:40:46.232 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 15:40:46.234 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 15:40:46.253 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 15:40:46.254 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 15:40:46.255 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 15:40:46.257 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 15:40:52.353 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 6.1 segundos
2025-05-30 15:40:52.355 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 15:40:52.385 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 15:40:52.386 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 15:40:52.469 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.08 segundos
2025-05-30 15:40:52.470 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 15:40:52.783 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 15:40:52.784 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 15:40:52.792 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 15:40:53.704 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_154053.png
2025-05-30 15:40:53.706 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 15:40:53.707 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 15:40:53.708 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 15:44:24.427 | INFO     | __main__:main:348 - Programa interrumpido por el usuario
2025-05-30 15:44:24.428 | INFO     | __main__:main:352 - Servicio finalizado. Cerrando conexiones...
2025-05-30 15:44:24.429 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 15:44:24.430 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
#---2025-05-30 16:54:43.808 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:54:43.808 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:56:04.030 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:56:04.031 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 16:57:01.871 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:57:01.871 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:57:02.641 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 16:57:02.642 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.15 segundos
2025-05-30 16:57:44.932 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:57:44.932 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:57:45.194 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 16:57:45.195 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 16:57:49.421 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 16:57:49.421 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 16:57:49.422 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 16:57:49.426 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 16:57:49.427 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 16:57:49.427 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 16:57:49.432 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 16:57:49.437 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 16:57:49.441 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 16:57:49.445 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 16:57:49.448 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 16:57:49.451 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 16:57:49.454 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 16:57:49.459 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:57:49.462 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:57:49.466 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 16:57:49.469 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 16:57:49.470 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 16:57:49.470 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 16:57:49.471 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 16:57:49.471 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 16:57:49.476 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 16:57:49.485 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 16:57:49.489 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 16:57:49.503 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 16:57:49.509 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 16:57:49.515 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 16:57:49.518 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 16:57:49.523 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 16:57:49.540 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 16:57:49.542 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 16:57:49.542 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 16:57:49.543 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 16:57:55.237 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 5.69 segundos
2025-05-30 16:57:55.237 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 16:57:55.267 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 16:57:55.267 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 16:57:55.354 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.09 segundos
2025-05-30 16:57:55.355 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 16:57:55.779 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 16:57:55.779 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 16:57:55.789 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 16:57:57.629 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_165757.png
2025-05-30 16:57:57.630 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 16:57:57.631 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 16:57:57.632 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 16:58:50.830 | INFO     | __main__:main:348 - Programa interrumpido por el usuario
2025-05-30 16:58:50.832 | INFO     | __main__:main:352 - Servicio finalizado. Cerrando conexiones...
2025-05-30 16:58:50.834 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 16:58:50.841 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 16:59:19.980 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:59:19.981 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:59:20.274 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 16:59:20.275 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 16:59:24.227 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 16:59:24.228 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 16:59:24.228 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 16:59:24.233 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 16:59:24.235 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 16:59:24.235 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 16:59:24.239 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 16:59:24.243 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 16:59:24.246 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 16:59:24.251 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 16:59:24.254 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 16:59:24.257 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 16:59:24.260 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 16:59:24.263 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:59:24.266 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:59:24.269 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 16:59:24.272 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 16:59:24.272 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 16:59:24.273 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 16:59:24.273 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 16:59:24.273 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 16:59:24.277 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 16:59:24.283 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 16:59:24.286 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 16:59:24.296 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 16:59:24.300 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 16:59:24.304 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 16:59:24.307 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 16:59:24.311 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 16:59:24.328 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 16:59:24.328 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 16:59:24.329 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 16:59:24.330 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 16:59:33.054 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 8.72 segundos
2025-05-30 16:59:33.055 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 16:59:33.084 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 16:59:33.084 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 16:59:33.168 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.08 segundos
2025-05-30 16:59:33.169 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 16:59:33.605 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 16:59:33.606 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 16:59:33.615 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 16:59:34.516 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_165934.png
2025-05-30 16:59:34.516 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 16:59:34.517 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 16:59:34.517 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:02:47.599 | INFO     | __main__:main:348 - Programa interrumpido por el usuario
2025-05-30 17:02:47.600 | INFO     | __main__:main:352 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:02:47.601 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:02:47.608 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:02:50.903 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:02:50.903 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 17:02:51.163 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:02:51.163 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:02:55.076 | INFO     | __main__:main:312 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:02:55.077 | INFO     | __main__:main:313 - Modo desarrollo: True
2025-05-30 17:02:55.078 | INFO     | __main__:test_connections:66 - Probando conexiones a bases de datos...
2025-05-30 17:02:55.079 | INFO     | __main__:test_connections:73 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:02:55.081 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:02:55.082 | INFO     | __main__:test_connections:82 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:02:55.083 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:02:55.084 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:02:55.086 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:02:55.087 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:02:55.089 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:02:55.090 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:02:55.091 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:02:55.091 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:02:55.093 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:02:55.094 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:02:55.095 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:02:55.095 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:02:55.095 | INFO     | __main__:main:328 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:02:55.096 | INFO     | __main__:run_ml_forecast:158 - Iniciando módulo de forecasting...
2025-05-30 17:02:55.096 | INFO     | __main__:diagnosticar_datos_disponibles:22 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:02:55.097 | INFO     | __main__:diagnosticar_datos_disponibles:26 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:02:55.100 | INFO     | __main__:diagnosticar_datos_disponibles:32 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:02:55.101 | INFO     | __main__:diagnosticar_datos_disponibles:37 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:02:55.108 | INFO     | __main__:diagnosticar_datos_disponibles:32 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:02:55.109 | INFO     | __main__:diagnosticar_datos_disponibles:37 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:02:55.111 | INFO     | __main__:diagnosticar_datos_disponibles:32 - Colección raw_productos: 31 documentos
2025-05-30 17:02:55.112 | INFO     | __main__:diagnosticar_datos_disponibles:37 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:02:55.113 | INFO     | __main__:diagnosticar_datos_disponibles:43 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:02:55.125 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:02:55.125 | INFO     | __main__:diagnosticar_datos_disponibles:62 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:02:55.126 | INFO     | __main__:run_ml_forecast:185 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:02:55.127 | INFO     | __main__:run_ml_forecast:198 - Entrenando en CPU
2025-05-30 17:03:02.238 | INFO     | __main__:run_ml_forecast:205 - Entrenamiento del modelo general completado en 7.11 segundos
2025-05-30 17:03:02.239 | INFO     | __main__:run_ml_forecast:209 - Guardando modelo general entrenado...
2025-05-30 17:03:02.268 | INFO     | __main__:run_ml_forecast:212 - Modelo general guardado en models/forecast
2025-05-30 17:03:02.269 | INFO     | __main__:run_ml_forecast:219 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 17:03:02.344 | INFO     | __main__:run_ml_forecast:230 - Entrenamiento de 0/10 modelos de productos completado en 0.07 segundos
2025-05-30 17:03:02.344 | INFO     | __main__:run_ml_forecast:244 - Generando predicciones generales...
2025-05-30 17:03:02.797 | INFO     | __main__:run_ml_forecast:246 - Predicciones generales generadas para los próximos 7 días
2025-05-30 17:03:02.797 | INFO     | __main__:run_ml_forecast:249 - Guardando predicciones generales en MongoDB...
2025-05-30 17:03:02.801 | INFO     | __main__:run_ml_forecast:273 - Generando visualización de predicciones generales...
2025-05-30 17:03:03.666 | INFO     | __main__:run_ml_forecast:278 - Visualización general guardada en plots\forecast_20250530_170303.png
2025-05-30 17:03:03.667 | INFO     | __main__:run_ml_forecast:296 - Proceso de forecasting completado exitosamente
2025-05-30 17:03:03.667 | INFO     | __main__:main:340 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 17:03:03.668 | INFO     | __main__:main:346 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:04:43.414 | INFO     | __main__:main:351 - Programa interrumpido por el usuario
2025-05-30 17:04:43.415 | INFO     | __main__:main:355 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:04:43.418 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:04:43.420 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:04:47.275 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:04:47.275 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 17:04:47.534 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:04:47.535 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:04:51.474 | INFO     | __main__:main:313 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:04:51.474 | INFO     | __main__:main:314 - Modo desarrollo: True
2025-05-30 17:04:51.475 | INFO     | __main__:test_connections:67 - Probando conexiones a bases de datos...
2025-05-30 17:04:51.476 | INFO     | __main__:test_connections:74 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:04:51.478 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:04:51.479 | INFO     | __main__:test_connections:83 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:04:51.481 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:04:51.483 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:04:51.484 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:04:51.484 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:04:51.486 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:04:51.487 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:04:51.489 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:04:51.489 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:04:51.491 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:04:51.491 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:04:51.493 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:04:51.493 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:04:51.493 | INFO     | __main__:main:329 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:04:51.494 | INFO     | __main__:run_ml_forecast:159 - Iniciando módulo de forecasting...
2025-05-30 17:04:51.494 | INFO     | __main__:diagnosticar_datos_disponibles:23 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:04:51.495 | INFO     | __main__:diagnosticar_datos_disponibles:27 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:04:51.499 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:04:51.500 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:04:51.508 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:04:51.509 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:04:51.512 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colección raw_productos: 31 documentos
2025-05-30 17:04:51.514 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:04:51.515 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:04:51.528 | INFO     | __main__:diagnosticar_datos_disponibles:56 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:04:51.529 | INFO     | __main__:diagnosticar_datos_disponibles:63 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:04:51.530 | INFO     | __main__:run_ml_forecast:186 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:04:51.531 | INFO     | __main__:run_ml_forecast:199 - Entrenando en CPU
2025-05-30 17:04:56.804 | INFO     | __main__:run_ml_forecast:206 - Entrenamiento del modelo general completado en 5.27 segundos
2025-05-30 17:04:56.804 | INFO     | __main__:run_ml_forecast:210 - Guardando modelo general entrenado...
2025-05-30 17:04:56.831 | INFO     | __main__:run_ml_forecast:213 - Modelo general guardado en models/forecast
2025-05-30 17:04:56.832 | INFO     | __main__:run_ml_forecast:220 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 17:04:56.902 | INFO     | __main__:run_ml_forecast:231 - Entrenamiento de 0/10 modelos de productos completado en 0.07 segundos
2025-05-30 17:04:56.902 | INFO     | __main__:run_ml_forecast:245 - Generando predicciones generales...
2025-05-30 17:04:57.324 | INFO     | __main__:run_ml_forecast:247 - Predicciones generales generadas para los próximos 7 días
2025-05-30 17:04:57.325 | INFO     | __main__:run_ml_forecast:250 - Guardando predicciones generales en MongoDB...
2025-05-30 17:04:57.328 | INFO     | __main__:run_ml_forecast:274 - Generando visualización de predicciones generales...
2025-05-30 17:04:57.888 | INFO     | __main__:run_ml_forecast:279 - Visualización general guardada en plots\forecast_20250530_170457.png
2025-05-30 17:04:57.890 | INFO     | __main__:run_ml_forecast:297 - Proceso de forecasting completado exitosamente
2025-05-30 17:04:57.891 | INFO     | __main__:main:341 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 17:04:57.892 | INFO     | __main__:main:347 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:06:36.951 | INFO     | __main__:main:352 - Programa interrumpido por el usuario
2025-05-30 17:06:36.952 | INFO     | __main__:main:356 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:06:36.954 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:06:36.956 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:06:43.262 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:06:43.262 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 17:06:43.513 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:06:43.514 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:06:47.521 | INFO     | __main__:main:315 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:06:47.522 | INFO     | __main__:main:316 - Modo desarrollo: True
2025-05-30 17:06:47.523 | INFO     | __main__:test_connections:69 - Probando conexiones a bases de datos...
2025-05-30 17:06:47.524 | INFO     | __main__:test_connections:76 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:06:47.526 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:06:47.527 | INFO     | __main__:test_connections:85 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:06:47.528 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:06:47.530 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:06:47.531 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:06:47.533 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:06:47.534 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:06:47.535 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:06:47.536 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:06:47.537 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:06:47.538 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:06:47.538 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:06:47.539 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:06:47.540 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:06:47.540 | INFO     | __main__:main:331 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:06:47.540 | INFO     | __main__:run_ml_forecast:161 - Iniciando módulo de forecasting...
2025-05-30 17:06:47.541 | INFO     | __main__:diagnosticar_datos_disponibles:25 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:06:47.542 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:06:47.545 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:06:47.547 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:06:47.554 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:06:47.555 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:06:47.557 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_productos: 31 documentos
2025-05-30 17:06:47.558 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:06:47.559 | INFO     | __main__:diagnosticar_datos_disponibles:46 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:06:47.573 | INFO     | __main__:diagnosticar_datos_disponibles:58 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:06:47.574 | INFO     | __main__:diagnosticar_datos_disponibles:65 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:06:47.574 | INFO     | __main__:run_ml_forecast:188 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:06:47.575 | INFO     | __main__:run_ml_forecast:201 - Entrenando en CPU
2025-05-30 17:06:53.186 | INFO     | __main__:run_ml_forecast:208 - Entrenamiento del modelo general completado en 5.61 segundos
2025-05-30 17:06:53.186 | INFO     | __main__:run_ml_forecast:212 - Guardando modelo general entrenado...
2025-05-30 17:06:53.212 | INFO     | __main__:run_ml_forecast:215 - Modelo general guardado en models/forecast
2025-05-30 17:06:53.212 | INFO     | __main__:run_ml_forecast:222 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 17:06:53.281 | INFO     | __main__:run_ml_forecast:233 - Entrenamiento de 0/10 modelos de productos completado en 0.07 segundos
2025-05-30 17:06:53.282 | INFO     | __main__:run_ml_forecast:247 - Generando predicciones generales...
2025-05-30 17:06:53.729 | INFO     | __main__:run_ml_forecast:249 - Predicciones generales generadas para los próximos 7 días
2025-05-30 17:06:53.730 | INFO     | __main__:run_ml_forecast:252 - Guardando predicciones generales en MongoDB...
2025-05-30 17:06:53.733 | INFO     | __main__:run_ml_forecast:276 - Generando visualización de predicciones generales...
2025-05-30 17:06:54.233 | INFO     | __main__:run_ml_forecast:281 - Visualización general guardada en plots\forecast_20250530_170654.png
2025-05-30 17:06:54.234 | INFO     | __main__:run_ml_forecast:299 - Proceso de forecasting completado exitosamente
2025-05-30 17:06:54.234 | INFO     | __main__:main:343 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 17:06:54.235 | INFO     | __main__:main:349 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:24:48.250 | INFO     | __main__:main:354 - Programa interrumpido por el usuario
2025-05-30 17:24:48.250 | INFO     | __main__:main:358 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:24:48.251 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:24:48.254 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:25:09.545 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:25:09.546 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 17:25:09.798 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:25:09.799 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:28:43.388 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:28:43.388 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 17:28:43.640 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:28:43.640 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:28:47.331 | INFO     | __main__:main:315 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:28:47.332 | INFO     | __main__:main:316 - Modo desarrollo: True
2025-05-30 17:28:47.333 | INFO     | __main__:test_connections:69 - Probando conexiones a bases de datos...
2025-05-30 17:28:47.334 | INFO     | __main__:test_connections:76 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:28:47.336 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:28:47.337 | INFO     | __main__:test_connections:85 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:28:47.338 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:28:47.339 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:28:47.340 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:28:47.342 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:28:47.343 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:28:47.344 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:28:47.344 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:28:47.345 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:28:47.346 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:28:47.348 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:28:47.348 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:28:47.348 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:28:47.349 | INFO     | __main__:main:331 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:28:47.349 | INFO     | __main__:run_ml_forecast:161 - Iniciando módulo de forecasting...
2025-05-30 17:28:47.349 | INFO     | __main__:diagnosticar_datos_disponibles:25 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:28:47.350 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:28:47.354 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:28:47.355 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:28:47.362 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:28:47.363 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:28:47.365 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_productos: 31 documentos
2025-05-30 17:28:47.366 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:28:47.367 | INFO     | __main__:diagnosticar_datos_disponibles:46 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:28:47.379 | INFO     | __main__:diagnosticar_datos_disponibles:58 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:28:47.380 | INFO     | __main__:diagnosticar_datos_disponibles:65 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:28:47.380 | INFO     | __main__:run_ml_forecast:188 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:28:47.381 | INFO     | __main__:run_ml_forecast:201 - Entrenando en CPU
2025-05-30 17:28:47.424 | ERROR    | __main__:run_ml_forecast:303 - Error en el proceso de forecasting: tuple index out of range
2025-05-30 17:28:47.425 | WARNING  | __main__:main:345 - El módulo ML presentó errores. Revisar logs para más detalles.
2025-05-30 17:28:47.425 | INFO     | __main__:main:349 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:29:10.076 | INFO     | __main__:main:354 - Programa interrumpido por el usuario
2025-05-30 17:29:10.078 | INFO     | __main__:main:358 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:29:10.079 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:29:10.081 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 18:14:33.451 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:14:33.451 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 18:14:33.729 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:14:33.730 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 18:19:03.671 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:19:03.671 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 18:19:03.937 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:19:03.938 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 18:19:07.061 | INFO     | __main__:main:406 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 18:19:07.061 | INFO     | __main__:main:407 - Modo desarrollo: True
2025-05-30 18:19:07.062 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 18:19:07.063 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 18:19:07.065 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 18:19:07.066 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 18:19:07.068 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 18:19:07.069 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 18:19:07.070 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 18:19:07.071 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 18:19:07.072 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 18:19:07.073 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 18:19:07.075 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 18:19:07.075 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:19:07.076 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:19:07.077 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 18:19:07.078 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 18:19:07.078 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 18:19:07.078 | INFO     | __main__:main:422 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 18:19:07.079 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 18:19:07.079 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 18:19:07.080 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 18:19:07.084 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 18:19:07.085 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 18:19:07.097 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 18:19:07.099 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 18:19:07.101 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 18:19:07.102 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 18:19:07.105 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 18:19:07.288 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 18:19:07.289 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 18:19:07.289 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 18:19:07.290 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 18:19:13.141 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.85 segundos
2025-05-30 18:19:13.142 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 18:19:13.172 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 18:19:13.173 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 18:19:13.366 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 0/10 modelos de productos completado en 0.19 segundos
2025-05-30 18:19:13.367 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 18:19:13.683 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 18:19:13.684 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 18:19:13.832 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 18:19:13.833 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 18:19:13.974 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 18:19:13.975 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 18:19:13.984 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 18:19:13.985 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 18:19:13.986 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 18:19:14.553 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_181914.png
2025-05-30 18:19:14.554 | INFO     | __main__:run_ml_forecast:390 - Proceso de forecasting completado exitosamente
2025-05-30 18:19:14.556 | INFO     | __main__:main:434 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 18:19:14.556 | INFO     | __main__:main:440 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 18:36:39.567 | INFO     | __main__:main:445 - Programa interrumpido por el usuario
2025-05-30 18:36:39.568 | INFO     | __main__:main:449 - Servicio finalizado. Cerrando conexiones...
2025-05-30 18:36:39.568 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 18:36:39.570 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 18:37:04.904 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:37:04.905 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 18:37:05.173 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:37:05.174 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 18:37:08.384 | INFO     | __main__:main:406 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 18:37:08.385 | INFO     | __main__:main:407 - Modo desarrollo: True
2025-05-30 18:37:08.385 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 18:37:08.387 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 18:37:08.389 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 18:37:08.389 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 18:37:08.391 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 18:37:08.392 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 18:37:08.394 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 18:37:08.395 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 18:37:08.396 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 18:37:08.398 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 18:37:08.399 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 18:37:08.400 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:37:08.401 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:37:08.401 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 18:37:08.402 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 18:37:08.403 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 18:37:08.403 | INFO     | __main__:main:422 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 18:37:08.403 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 18:37:08.403 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 18:37:08.404 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 18:37:08.408 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 18:37:08.409 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 18:37:08.418 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 18:37:08.419 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 18:37:08.421 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 18:37:08.422 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 18:37:08.422 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 18:37:08.435 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 18:37:08.435 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 18:37:08.436 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 18:37:08.437 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 18:37:14.331 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.89 segundos
2025-05-30 18:37:14.332 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 18:37:14.359 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 18:37:14.359 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 18:37:55.801 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 41.44 segundos
2025-05-30 18:37:55.801 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 18:37:55.966 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 18:37:55.968 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 18:37:56.313 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 18:37:56.314 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 18:37:56.682 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 18:37:56.683 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 18:37:56.822 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 18:37:56.823 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 18:37:56.827 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 18:37:56.829 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 18:37:56.830 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 18:37:59.347 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 18:37:59.348 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 18:37:59.368 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 18:38:00.234 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 18:38:00.250 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 18:38:00.250 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 18:38:00.956 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_183800.png
2025-05-30 18:38:00.957 | INFO     | __main__:run_ml_forecast:381 - Generando visualización para producto 16...
2025-05-30 18:38:01.426 | INFO     | __main__:run_ml_forecast:386 - Visualización de producto 16 guardada en plots\product_16_20250530_183801.png
2025-05-30 18:38:01.427 | INFO     | __main__:run_ml_forecast:381 - Generando visualización para producto 25...
2025-05-30 18:38:01.875 | INFO     | __main__:run_ml_forecast:386 - Visualización de producto 25 guardada en plots\product_25_20250530_183801.png
2025-05-30 18:38:01.875 | INFO     | __main__:run_ml_forecast:381 - Generando visualización para producto 11...
2025-05-30 18:38:02.315 | INFO     | __main__:run_ml_forecast:386 - Visualización de producto 11 guardada en plots\product_11_20250530_183802.png
2025-05-30 18:38:02.316 | INFO     | __main__:run_ml_forecast:390 - Proceso de forecasting completado exitosamente
2025-05-30 18:38:02.316 | INFO     | __main__:main:434 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 18:38:02.317 | INFO     | __main__:main:440 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 18:47:38.475 | INFO     | __main__:main:445 - Programa interrumpido por el usuario
2025-05-30 18:47:38.475 | INFO     | __main__:main:449 - Servicio finalizado. Cerrando conexiones...
2025-05-30 18:47:38.477 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 18:47:38.478 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 18:47:58.228 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:47:58.228 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 18:47:58.491 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:47:58.492 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-05-30 18:48:01.440 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 18:48:01.441 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-05-30 18:48:01.441 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 18:48:01.443 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 18:48:01.445 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 18:48:01.445 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 18:48:01.447 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 18:48:01.448 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 18:48:01.449 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 18:48:01.451 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 18:48:01.453 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 18:48:01.454 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 18:48:01.455 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 18:48:01.456 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:48:01.457 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:48:01.458 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 18:48:01.459 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 18:48:01.459 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 18:48:01.459 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 18:48:01.460 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 18:48:01.460 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 18:48:01.461 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 18:48:01.464 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 18:48:01.465 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 18:48:01.473 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 18:48:01.474 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 18:48:01.476 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 18:48:01.477 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 18:48:01.478 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 18:48:01.490 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 18:48:01.492 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 18:48:01.492 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 18:48:01.493 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 18:48:06.926 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.43 segundos
2025-05-30 18:48:06.927 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 18:48:06.956 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 18:48:06.957 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 18:48:52.333 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 45.38 segundos
2025-05-30 18:48:52.333 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 18:48:52.491 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 18:48:52.491 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 18:48:53.054 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 18:48:53.054 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 18:48:53.194 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 18:48:53.194 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 18:48:53.344 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 18:48:53.344 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 18:48:53.349 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 18:48:53.351 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 18:48:53.351 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 18:48:55.928 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 18:48:55.929 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 18:48:55.937 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 18:48:56.814 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 18:48:56.817 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 18:48:56.819 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 18:48:57.547 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_184857.png
2025-05-30 18:48:57.548 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-05-30 18:48:57.548 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-05-30 18:48:57.966 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250530_184857.png
2025-05-30 18:48:57.967 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-05-30 18:48:58.409 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250530_184858.png
2025-05-30 18:48:58.410 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-05-30 18:48:58.870 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250530_184858.png
2025-05-30 18:48:58.871 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-05-30 18:48:59.390 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250530_184859.png
2025-05-30 18:48:59.391 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-05-30 18:48:59.852 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250530_184859.png
2025-05-30 18:48:59.853 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-05-30 18:49:00.316 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250530_184900.png
2025-05-30 18:49:00.317 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-05-30 18:49:01.003 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250530_184900.png
2025-05-30 18:49:01.003 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-05-30 18:49:01.438 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250530_184901.png
2025-05-30 18:49:01.439 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-05-30 18:49:01.907 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250530_184901.png
2025-05-30 18:49:01.907 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-05-30 18:49:01.911 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-05-30 18:49:01.912 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-05-30 18:49:03.426 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250530_184903.png
2025-05-30 18:49:03.427 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-05-30 18:49:05.152 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250530_184905.png
2025-05-30 18:49:05.153 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-05-30 18:49:06.833 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250530_184906.png
2025-05-30 18:49:06.834 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-05-30 18:49:08.284 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250530_184908.png
2025-05-30 18:49:08.284 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-05-30 18:49:10.019 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250530_184909.png
2025-05-30 18:49:10.019 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-05-30 18:49:10.020 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 18:49:10.020 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 18:50:31.301 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-05-30 18:50:31.302 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-05-30 18:50:31.302 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 18:50:31.303 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 22:35:02.516 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:35:02.517 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 22:35:02.870 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 22:35:02.870 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.09 segundos
2025-05-30 22:35:08.514 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 22:35:08.515 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-05-30 22:35:08.516 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 22:35:08.517 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 22:35:08.518 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 22:35:08.519 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 22:35:08.520 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 22:35:08.521 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 22:35:08.523 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 22:35:08.524 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 22:35:08.526 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 22:35:08.527 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 22:35:08.528 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 22:35:08.530 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 22:35:08.531 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 22:35:08.532 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 22:35:08.534 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 22:35:08.534 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 22:35:08.535 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 22:35:08.535 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 22:35:08.535 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 22:35:08.537 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 22:35:08.542 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 22:35:08.545 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 22:35:08.556 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 22:35:08.557 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 22:35:08.559 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 22:35:08.561 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 22:35:08.563 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 22:35:08.575 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 22:35:08.575 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 22:35:08.576 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 22:35:08.579 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 22:35:14.015 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.44 segundos
2025-05-30 22:35:14.015 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 22:35:14.051 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 22:35:14.051 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 22:36:06.061 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 52.01 segundos
2025-05-30 22:36:06.061 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 22:36:06.226 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 22:36:06.227 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 22:36:06.792 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 22:36:06.793 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 22:36:06.948 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 22:36:06.948 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 22:36:07.099 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 22:36:07.100 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 22:36:07.106 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 22:36:07.108 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 22:36:07.108 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 22:36:10.478 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 22:36:10.478 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 22:36:10.488 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 22:36:11.786 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 22:36:11.789 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 22:36:11.790 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 22:36:12.877 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_223612.png
2025-05-30 22:36:12.877 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-05-30 22:36:12.878 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-05-30 22:36:13.912 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250530_223613.png
2025-05-30 22:36:13.913 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-05-30 22:36:14.505 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250530_223614.png
2025-05-30 22:36:14.506 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-05-30 22:36:14.991 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250530_223614.png
2025-05-30 22:36:14.992 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-05-30 22:36:15.474 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250530_223615.png
2025-05-30 22:36:15.475 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-05-30 22:36:15.983 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250530_223615.png
2025-05-30 22:36:15.984 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-05-30 22:36:16.664 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250530_223616.png
2025-05-30 22:36:16.664 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-05-30 22:36:17.965 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250530_223617.png
2025-05-30 22:36:17.966 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-05-30 22:36:18.550 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250530_223618.png
2025-05-30 22:36:18.550 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-05-30 22:36:19.066 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250530_223618.png
2025-05-30 22:36:19.067 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-05-30 22:36:19.077 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-05-30 22:36:19.078 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-05-30 22:36:20.736 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250530_223620.png
2025-05-30 22:36:20.737 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-05-30 22:36:22.392 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250530_223622.png
2025-05-30 22:36:22.392 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-05-30 22:36:24.127 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250530_223624.png
2025-05-30 22:36:24.128 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-05-30 22:36:25.666 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250530_223625.png
2025-05-30 22:36:25.668 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-05-30 22:36:27.436 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250530_223627.png
2025-05-30 22:36:27.437 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-05-30 22:36:27.437 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 22:36:27.438 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 22:36:34.978 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-05-30 22:36:34.979 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-05-30 22:36:34.981 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 22:36:34.983 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 22:39:57.255 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:39:57.256 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 22:40:01.638 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:40:01.638 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 22:54:36.656 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:54:36.656 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 22:54:41.057 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:54:41.058 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 23:11:55.766 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:11:55.767 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 23:12:03.052 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:12:03.053 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 23:12:18.237 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:12:18.237 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 23:12:18.514 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 23:12:18.515 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 23:12:21.980 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 23:12:21.981 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-05-30 23:12:21.982 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 23:12:21.983 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 23:12:21.985 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 23:12:21.986 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 23:12:21.987 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 23:12:21.988 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 23:12:21.989 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 23:12:21.990 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 23:12:21.992 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 23:12:21.993 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 23:12:21.995 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 23:12:21.996 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 23:12:21.997 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 23:12:21.998 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 23:12:21.999 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 23:12:21.999 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 23:12:21.999 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 23:12:21.999 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 23:12:22.000 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 23:12:22.001 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 23:12:22.004 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 23:12:22.005 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 23:12:22.015 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 23:12:22.016 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 23:12:22.017 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 23:12:22.019 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 23:12:22.020 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 23:12:22.034 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 23:12:22.034 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 23:12:22.035 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 23:12:22.036 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 23:12:27.786 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.75 segundos
2025-05-30 23:12:27.787 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 23:12:27.856 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 23:12:27.857 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 23:13:25.638 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 57.78 segundos
2025-05-30 23:13:25.638 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 23:13:25.837 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 23:13:25.837 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 23:13:26.163 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 23:13:26.164 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 23:13:26.524 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 23:13:26.525 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 23:13:26.664 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 23:13:26.665 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 23:13:26.670 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 23:13:26.671 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 23:13:26.671 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 23:13:29.204 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 23:13:29.205 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 23:13:29.212 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 23:13:30.104 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 23:13:30.108 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 23:13:30.109 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 23:13:30.847 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_231330.png
2025-05-30 23:13:30.848 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-05-30 23:13:30.848 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-05-30 23:13:31.321 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250530_231331.png
2025-05-30 23:13:31.321 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-05-30 23:13:31.751 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250530_231331.png
2025-05-30 23:13:31.752 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-05-30 23:13:32.190 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250530_231332.png
2025-05-30 23:13:32.191 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-05-30 23:13:32.606 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250530_231332.png
2025-05-30 23:13:32.607 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-05-30 23:13:33.030 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250530_231332.png
2025-05-30 23:13:33.031 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-05-30 23:13:33.441 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250530_231333.png
2025-05-30 23:13:33.442 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-05-30 23:13:34.102 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250530_231334.png
2025-05-30 23:13:34.102 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-05-30 23:13:34.514 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250530_231334.png
2025-05-30 23:13:34.515 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-05-30 23:13:34.943 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250530_231334.png
2025-05-30 23:13:34.943 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-05-30 23:13:34.947 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-05-30 23:13:34.947 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-05-30 23:13:36.366 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250530_231336.png
2025-05-30 23:13:36.367 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-05-30 23:13:37.889 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250530_231337.png
2025-05-30 23:13:37.889 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-05-30 23:13:39.423 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250530_231339.png
2025-05-30 23:13:39.423 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-05-30 23:13:40.756 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250530_231340.png
2025-05-30 23:13:40.756 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-05-30 23:13:42.362 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250530_231342.png
2025-05-30 23:13:42.362 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-05-30 23:13:42.363 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 23:13:42.363 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 23:13:44.551 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-05-30 23:13:44.553 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-05-30 23:13:44.555 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 23:13:44.557 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 23:13:55.051 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:13:55.051 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 23:13:55.542 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:13:55.542 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 10:44:47.765 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:44:47.766 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 10:44:48.033 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 10:44:48.033 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 10:44:51.363 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 10:44:51.364 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-06-01 10:44:51.365 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-06-01 10:44:51.366 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 10:44:51.367 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 10:44:51.368 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-06-01 10:44:51.368 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 10:44:51.369 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 10:44:51.370 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 10:44:51.372 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 10:44:51.373 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 10:44:51.375 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 10:44:51.376 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 10:44:51.376 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:44:51.377 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:44:51.378 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 10:44:51.378 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 10:44:51.379 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 10:44:51.379 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-06-01 10:44:51.380 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-06-01 10:44:51.380 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-06-01 10:44:51.381 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 10:44:51.384 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-06-01 10:44:51.385 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 10:44:51.393 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-06-01 10:44:51.394 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 10:44:51.395 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-06-01 10:44:51.396 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 10:44:51.397 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 10:44:51.410 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 10:44:51.410 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 10:44:51.411 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-06-01 10:44:51.412 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-06-01 10:44:56.094 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 4.68 segundos
2025-06-01 10:44:56.094 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-06-01 10:44:56.122 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-06-01 10:44:56.123 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-06-01 10:45:32.069 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 35.95 segundos
2025-06-01 10:45:32.069 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-06-01 10:45:32.299 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-06-01 10:45:32.300 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-06-01 10:45:32.609 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 10:45:32.609 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-06-01 10:45:32.753 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 10:45:32.753 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-06-01 10:45:32.897 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 10:45:32.898 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-06-01 10:45:32.901 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-06-01 10:45:32.902 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-06-01 10:45:32.903 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-06-01 10:45:35.632 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-06-01 10:45:35.633 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-06-01 10:45:35.640 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-06-01 10:45:36.558 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-06-01 10:45:36.561 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-06-01 10:45:36.562 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-06-01 10:45:37.095 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250601_104536.png
2025-06-01 10:45:37.096 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-06-01 10:45:37.096 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-06-01 10:45:37.567 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250601_104537.png
2025-06-01 10:45:37.568 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-06-01 10:45:38.307 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250601_104538.png
2025-06-01 10:45:38.308 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-06-01 10:45:38.802 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250601_104538.png
2025-06-01 10:45:38.802 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-06-01 10:45:39.255 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250601_104539.png
2025-06-01 10:45:39.255 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-06-01 10:45:39.713 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250601_104539.png
2025-06-01 10:45:39.714 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-06-01 10:45:40.147 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250601_104540.png
2025-06-01 10:45:40.148 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-06-01 10:45:40.586 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250601_104540.png
2025-06-01 10:45:40.586 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-06-01 10:45:41.297 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250601_104541.png
2025-06-01 10:45:41.298 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-06-01 10:45:41.729 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250601_104541.png
2025-06-01 10:45:41.729 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-06-01 10:45:41.733 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-06-01 10:45:41.733 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-06-01 10:45:43.127 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250601_104543.png
2025-06-01 10:45:43.128 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-06-01 10:45:44.667 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250601_104544.png
2025-06-01 10:45:44.668 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-06-01 10:45:46.082 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250601_104545.png
2025-06-01 10:45:46.082 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-06-01 10:45:47.695 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250601_104547.png
2025-06-01 10:45:47.696 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-06-01 10:45:49.523 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250601_104549.png
2025-06-01 10:45:49.524 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-06-01 10:45:49.525 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-06-01 10:45:49.525 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-06-01 10:46:41.714 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-06-01 10:46:41.715 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-06-01 10:46:41.718 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 10:46:41.720 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 10:47:35.519 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:47:35.520 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 10:47:36.049 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:47:36.050 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 10:53:45.240 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:53:45.241 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 10:56:31.767 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:56:31.768 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 10:56:32.030 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 10:56:32.031 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 10:56:35.268 | INFO     | __main__:main:497 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 10:56:35.270 | INFO     | __main__:main:498 - Modo desarrollo: True
2025-06-01 10:56:35.270 | INFO     | __main__:main:499 - Sistema multi-tenant activado
2025-06-01 10:56:35.271 | INFO     | __main__:main:500 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 10:56:35.271 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-06-01 10:56:35.272 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 10:56:35.274 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 10:56:35.275 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-06-01 10:56:35.277 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 10:56:35.278 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 10:56:35.279 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 10:56:35.280 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 10:56:35.282 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 10:56:35.284 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 10:56:35.285 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 10:56:35.286 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:56:35.287 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:56:35.288 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 10:56:35.290 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 10:56:35.290 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 10:56:35.290 | INFO     | __main__:main:537 - ======= PROCESANDO TENANT 1 =======
2025-06-01 10:56:35.291 | INFO     | __main__:run_ml_forecast:168 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 10:56:35.291 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 10:56:35.292 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 10:56:35.296 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 10:56:35.298 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 10:56:35.307 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 10:56:35.308 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 10:56:35.310 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 10:56:35.311 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 10:56:35.313 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 10:56:35.325 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 10:56:35.326 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 10:56:35.326 | INFO     | __main__:run_ml_forecast:218 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 10:56:35.327 | INFO     | __main__:run_ml_forecast:231 - Entrenando en CPU
2025-06-01 10:56:49.370 | INFO     | __main__:run_ml_forecast:239 - Entrenamiento del modelo general completado en 14.04 segundos
2025-06-01 10:56:49.372 | INFO     | __main__:run_ml_forecast:243 - Guardando modelo general entrenado para tenant 1...
2025-06-01 10:56:49.394 | INFO     | __main__:run_ml_forecast:246 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 10:56:49.395 | INFO     | __main__:run_ml_forecast:265 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 10:58:35.485 | INFO     | __main__:run_ml_forecast:276 - Entrenamiento de 9/10 modelos de productos completado en 106.09 segundos
2025-06-01 10:58:35.486 | INFO     | __main__:run_ml_forecast:280 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 10:58:35.655 | INFO     | __main__:run_ml_forecast:283 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 10:58:35.656 | INFO     | __main__:run_ml_forecast:286 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 10:58:36.085 | INFO     | __main__:run_ml_forecast:290 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 10:58:36.086 | INFO     | __main__:run_ml_forecast:293 - Generando predicciones semanales para tenant 1...
2025-06-01 10:58:36.535 | INFO     | __main__:run_ml_forecast:295 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 10:58:36.536 | INFO     | __main__:run_ml_forecast:298 - Generando predicciones mensuales para tenant 1...
2025-06-01 10:58:36.724 | INFO     | __main__:run_ml_forecast:300 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 10:58:36.724 | INFO     | __main__:run_ml_forecast:303 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 10:58:36.729 | INFO     | __main__:run_ml_forecast:338 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 10:58:36.731 | INFO     | __main__:run_ml_forecast:342 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 10:58:36.732 | INFO     | __main__:run_ml_forecast:348 - Generando predicciones por producto para tenant 1...
2025-06-01 10:58:39.367 | INFO     | __main__:run_ml_forecast:352 - Predicciones generadas para 9 productos
2025-06-01 10:58:39.368 | INFO     | __main__:run_ml_forecast:355 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 10:58:39.374 | INFO     | __main__:run_ml_forecast:359 - Generando predicciones por categoría para tenant 1...
2025-06-01 10:58:40.224 | INFO     | __main__:run_ml_forecast:364 - Predicciones generadas para 5 categorías
2025-06-01 10:58:40.227 | INFO     | __main__:run_ml_forecast:390 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 10:58:40.228 | INFO     | __main__:run_ml_forecast:404 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 10:58:40.409 | ERROR    | __main__:run_ml_forecast:485 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 10:58:40.409 | WARNING  | __main__:main:552 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 10:58:40.410 | INFO     | __main__:main:554 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 10:58:40.410 | INFO     | __main__:main:556 - Todos los tenants procesados correctamente
2025-06-01 10:58:40.411 | INFO     | __main__:main:560 - Iniciando servidor GraphQL para pruebas...
2025-06-01 10:58:40.412 | INFO     | __main__:main:588 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 10:58:40.413 | INFO     | __main__:main:589 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 10:58:40.414 | INFO     | __main__:main:590 - Presiona Ctrl+C para terminar.
2025-06-01 10:58:41.009 | INFO     | __main__:run_server:571 - Servidor importado desde api.server
2025-06-01 11:01:22.034 | INFO     | __main__:main:596 - Programa interrumpido por el usuario
2025-06-01 11:01:22.036 | INFO     | __main__:main:603 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:01:22.038 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:01:22.040 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:02:23.507 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:02:23.507 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 11:02:23.777 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:02:23.778 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 11:02:27.509 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:02:27.510 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:02:27.511 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:02:27
2025-06-01 11:02:27.512 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:02:27.512 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:02:27.514 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:02:27.515 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:02:27.516 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:02:27.517 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:02:27.519 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:02:27.520 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:02:27.521 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:02:27.522 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:02:27.524 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:02:27.526 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:02:27.526 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:02:27.527 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:02:27.528 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:02:27.529 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:02:27.529 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:02:27.530 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:02:27.530 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:02:27.531 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:02:27.531 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:02:27.535 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:02:27.536 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:02:27.542 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:02:27.544 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:02:27.546 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:02:27.547 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:02:27.548 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:02:27.560 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:02:27.562 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:02:27.565 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:02:27.565 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:02:27.567 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:02:27.569 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:02:27.571 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:02:27.573 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:02:27.574 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:02:27.575 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:02:27.578 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:02:27.578 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:02:27.579 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:02:27.579 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:02:27.580 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:02:40.347 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 12.77 segundos
2025-06-01 11:02:40.348 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:02:40.374 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:02:40.375 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:04:28.607 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 108.23 segundos
2025-06-01 11:04:28.608 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:04:28.783 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:04:28.785 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:04:29.143 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:04:29.143 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:04:29.512 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:04:29.513 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:04:29.653 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:04:29.654 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:04:29.658 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:04:29.660 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:04:29.661 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:04:32.287 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:04:32.288 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:04:32.294 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:04:33.150 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:04:33.154 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:04:33.154 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:04:33.333 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:04:33.335 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:04:33.335 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:04:33.336 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:04:33.336 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:04:33.337 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:04:33.338 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:04:33.338 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:04:33.929 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:10:51.763 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:10:51.764 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:10:51.764 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:10:51.766 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:10:55.444 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:10:55.445 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 11:10:55.711 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:10:55.712 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 11:10:58.967 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:10:58.968 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:10:58.969 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:10:58
2025-06-01 11:10:58.970 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:10:58.970 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:10:58.972 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:10:58.974 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:10:58.974 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:10:58.976 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:10:58.977 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:10:58.979 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:10:58.980 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:10:58.982 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:10:58.983 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:10:58.983 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:10:58.984 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:10:58.985 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:10:58.986 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:10:58.987 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:10:58.988 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:10:58.989 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:10:58.990 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:10:58.990 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:10:58.991 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:10:58.995 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:10:58.996 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:10:59.002 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:10:59.004 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:10:59.007 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:10:59.008 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:10:59.010 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:10:59.022 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:10:59.025 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:10:59.027 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:10:59.027 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:10:59.029 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:10:59.031 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:10:59.032 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:10:59.033 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:10:59.034 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:10:59.035 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:10:59.037 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:10:59.037 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:10:59.038 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:10:59.039 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:10:59.040 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:11:16.323 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 17.28 segundos
2025-06-01 11:11:16.324 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:11:16.380 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:11:16.381 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:13:16.615 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 120.23 segundos
2025-06-01 11:13:16.615 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:13:16.777 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:13:16.778 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:13:17.325 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:13:17.326 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:13:17.466 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:13:17.467 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:13:17.630 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:13:17.630 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:13:17.635 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:13:17.636 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:13:17.636 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:13:20.167 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:13:20.168 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:13:20.175 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:13:21.242 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:13:21.246 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:13:21.247 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:13:21.422 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:13:21.423 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:13:21.424 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:13:21.424 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:13:21.425 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:13:21.426 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:13:21.427 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:13:21.427 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:13:21.648 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:26:49.211 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:26:49.212 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:26:49.214 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:26:49.215 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:27:27.555 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:27:27.555 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 11:27:27.816 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:27:27.817 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 11:27:31.036 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:27:31.037 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:27:31.038 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:27:31
2025-06-01 11:27:31.038 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:27:31.039 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:27:31.040 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:27:31.042 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:27:31.042 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:27:31.043 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:27:31.044 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:27:31.045 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:27:31.045 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:27:31.046 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:27:31.047 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:27:31.047 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:27:31.048 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:27:31.049 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:27:31.050 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:27:31.051 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:27:31.051 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:27:31.052 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:27:31.052 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:27:31.052 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:27:31.053 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:27:31.057 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:27:31.057 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:27:31.064 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:27:31.065 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:27:31.067 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:27:31.069 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:27:31.070 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:27:31.081 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:27:31.083 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:27:31.085 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:27:31.086 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:27:31.089 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:27:31.090 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:27:31.091 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:27:31.092 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:27:31.093 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:27:31.094 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:27:31.095 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:27:31.096 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:27:31.096 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:27:31.097 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:27:31.098 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:27:45.781 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 14.68 segundos
2025-06-01 11:27:45.782 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:27:45.828 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:27:45.829 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:29:45.317 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 119.49 segundos
2025-06-01 11:29:45.317 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:29:45.493 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:29:45.494 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:29:45.862 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:29:45.862 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:29:46.229 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:29:46.230 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:29:46.368 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:29:46.369 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:29:46.373 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:29:46.374 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:29:46.374 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:29:48.995 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:29:48.996 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:29:49.003 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:29:49.898 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:29:49.901 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:29:49.903 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:29:50.081 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:29:50.082 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:29:50.082 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:29:50.082 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:29:50.083 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:29:50.084 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:29:50.084 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:29:50.085 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:29:50.658 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:34:25.632 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:34:25.634 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:34:25.636 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:34:25.638 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:39:11.661 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:39:11.662 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 11:39:11.950 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:39:11.950 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-06-01 11:39:15.346 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:39:15.348 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:39:15.348 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:39:15
2025-06-01 11:39:15.349 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:39:15.350 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:39:15.350 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:39:15.352 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:39:15.353 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:39:15.354 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:39:15.356 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:39:15.357 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:39:15.358 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:39:15.359 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:39:15.360 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:39:15.361 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:39:15.363 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:39:15.363 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:39:15.364 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:39:15.365 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:39:15.366 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:39:15.366 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:39:15.366 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:39:15.367 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:39:15.368 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:39:15.371 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:39:15.372 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:39:15.378 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:39:15.381 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:39:15.383 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:39:15.384 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:39:15.386 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:39:15.400 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:39:15.402 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:39:15.403 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:39:15.404 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:39:15.405 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:39:15.406 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:39:15.407 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:39:15.408 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:39:15.409 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:39:15.411 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:39:15.412 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:39:15.413 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:39:15.413 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:39:15.414 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:39:15.415 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:39:26.971 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 11.56 segundos
2025-06-01 11:39:26.972 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:39:26.994 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:39:26.995 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:41:08.648 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 101.65 segundos
2025-06-01 11:41:08.649 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:41:08.863 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:41:08.863 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:41:09.231 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:41:09.232 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:41:09.624 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:41:09.624 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:41:09.763 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:41:09.764 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:41:09.768 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:41:09.770 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:41:09.771 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:41:12.329 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:41:12.329 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:41:12.336 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:41:13.181 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:41:13.183 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:41:13.184 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:41:13.363 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:41:13.364 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:41:13.364 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:41:13.365 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:41:13.365 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:41:13.367 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:41:13.367 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:41:13.368 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:41:13.933 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:47:46.438 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:47:46.440 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:47:46.442 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:47:46.445 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
