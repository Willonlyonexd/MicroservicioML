#12025-05-29 23:49:41.442 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-29 23:49:41.442 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-29 23:49:41.789 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-29 23:49:41.790 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.18 segundos
2025-05-29 23:51:14.049 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-29 23:51:14.050 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-29 23:51:14.284 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-29 23:51:14.285 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-29 23:51:17.181 | INFO     | __main__:main:260 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-29 23:51:17.182 | INFO     | __main__:main:261 - Modo desarrollo: True
2025-05-29 23:51:17.183 | INFO     | __main__:test_connections:17 - Probando conexiones a bases de datos...
2025-05-29 23:51:17.184 | INFO     | __main__:test_connections:24 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-29 23:51:17.187 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-29 23:51:17.187 | INFO     | __main__:test_connections:33 - Conexión a PostgreSQL funciona correctamente
2025-05-29 23:51:17.189 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-29 23:51:17.190 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-29 23:51:17.192 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-29 23:51:17.194 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-29 23:51:17.196 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-29 23:51:17.197 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-29 23:51:17.199 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-29 23:51:17.200 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-29 23:51:17.201 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-29 23:51:17.203 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-29 23:51:17.204 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-29 23:51:17.205 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-29 23:51:17.205 | INFO     | __main__:main:276 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-29 23:51:17.206 | INFO     | __main__:run_ml_forecast:109 - Iniciando módulo de forecasting...
2025-05-29 23:51:17.206 | INFO     | __main__:run_ml_forecast:133 - Iniciando entrenamiento de nuevo modelo general...
2025-05-29 23:51:17.207 | INFO     | __main__:run_ml_forecast:146 - Entrenando en CPU
2025-05-29 23:51:23.029 | INFO     | __main__:run_ml_forecast:153 - Entrenamiento del modelo general completado en 5.82 segundos
2025-05-29 23:51:23.030 | INFO     | __main__:run_ml_forecast:157 - Guardando modelo general entrenado...
2025-05-29 23:51:23.072 | INFO     | __main__:run_ml_forecast:160 - Modelo general guardado en models/forecast
2025-05-29 23:51:23.073 | INFO     | __main__:run_ml_forecast:167 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-29 23:51:23.298 | INFO     | __main__:run_ml_forecast:178 - Entrenamiento de 0/0 modelos de productos completado en 0.22 segundos
2025-05-29 23:51:23.299 | INFO     | __main__:run_ml_forecast:192 - Generando predicciones generales...
2025-05-29 23:51:23.706 | INFO     | __main__:run_ml_forecast:194 - Predicciones generales generadas para los próximos 7 días
2025-05-29 23:51:23.707 | INFO     | __main__:run_ml_forecast:197 - Guardando predicciones generales en MongoDB...
2025-05-29 23:51:23.715 | INFO     | __main__:run_ml_forecast:221 - Generando visualización de predicciones generales...
2025-05-29 23:51:25.015 | INFO     | __main__:run_ml_forecast:226 - Visualización general guardada en plots\forecast_20250529_235124.png
2025-05-29 23:51:25.016 | INFO     | __main__:run_ml_forecast:244 - Proceso de forecasting completado exitosamente
2025-05-29 23:51:25.019 | INFO     | __main__:main:288 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-29 23:51:25.022 | INFO     | __main__:main:294 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 00:01:58.556 | INFO     | __main__:main:299 - Programa interrumpido por el usuario
2025-05-30 00:01:58.556 | INFO     | __main__:main:303 - Servicio finalizado. Cerrando conexiones...
2025-05-30 00:01:58.558 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 00:01:58.560 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 00:02:02.239 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:02:02.239 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:02:02.483 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:02:02.484 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:02:26.762 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:02:26.763 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:02:27.011 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:02:27.012 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:04:28.873 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:04:28.874 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:04:29.104 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:04:29.104 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:07:00.813 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:07:00.814 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 00:07:01.043 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:07:01.044 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:11:24.209 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:11:24.209 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:11:24.440 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:11:24.440 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:12:01.035 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:12:01.036 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:12:01.275 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:12:01.275 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:12:46.398 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:12:46.399 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:12:46.647 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:12:46.648 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.08 segundos
2025-05-30 00:13:33.847 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:13:33.847 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:13:34.243 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:13:34.245 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.12 segundos
2025-05-30 00:15:58.679 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:15:58.680 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:15:58.925 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:15:58.926 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:16:55.456 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:16:55.457 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 00:16:55.684 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:16:55.684 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-05-30 00:20:47.143 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:20:47.143 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 00:20:47.366 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:20:47.367 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-05-30 00:27:03.042 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:27:03.042 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 00:27:03.269 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:27:03.270 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:29:11.807 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 00:29:11.807 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 00:29:12.061 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 00:29:12.062 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 00:29:15.226 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 00:29:15.227 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 00:29:15.228 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 00:29:15.230 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 00:29:15.232 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 00:29:15.233 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 00:29:15.234 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 00:29:15.236 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 00:29:15.237 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 00:29:15.238 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 00:29:15.240 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 00:29:15.242 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 00:29:15.243 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 00:29:15.244 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 00:29:15.246 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 00:29:15.247 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 00:29:15.248 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 00:29:15.249 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 00:29:15.249 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 00:29:15.250 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 00:29:15.250 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 00:29:15.252 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 00:29:15.262 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 00:29:15.264 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 00:29:15.274 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 00:29:15.276 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 00:29:15.278 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 00:29:15.280 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 00:29:15.281 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 00:29:15.304 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 00:29:15.305 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 00:29:15.306 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 00:29:15.307 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 00:29:22.916 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 7.61 segundos
2025-05-30 00:29:22.916 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 00:29:22.975 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 00:29:22.975 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 00:29:23.102 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.13 segundos
2025-05-30 00:29:23.102 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 00:29:23.450 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 00:29:23.451 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 00:29:23.468 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 00:29:24.556 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_002924.png
2025-05-30 00:29:24.558 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 00:29:24.559 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 00:29:24.560 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 15:39:28.462 | ERROR    | db.mongo_client:_connect:37 - No se pudo conectar a MongoDB: localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión, Timeout: 5.0s, Topology Description: <TopologyDescription id: 683a096b9f86104cd16488d6, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión')>]>
2025-05-30 15:40:40.857 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 15:40:40.858 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 15:40:41.190 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 15:40:41.191 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.10 segundos
2025-05-30 15:40:46.149 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 15:40:46.149 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 15:40:46.150 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 15:40:46.151 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 15:40:46.153 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 15:40:46.155 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 15:40:46.159 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 15:40:46.161 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 15:40:46.163 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 15:40:46.165 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 15:40:46.166 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 15:40:46.168 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 15:40:46.169 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 15:40:46.171 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 15:40:46.172 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 15:40:46.173 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 15:40:46.174 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 15:40:46.174 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 15:40:46.175 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 15:40:46.175 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 15:40:46.176 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 15:40:46.178 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 15:40:46.195 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 15:40:46.197 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 15:40:46.225 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 15:40:46.227 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 15:40:46.231 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 15:40:46.232 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 15:40:46.234 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 15:40:46.253 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 15:40:46.254 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 15:40:46.255 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 15:40:46.257 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 15:40:52.353 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 6.1 segundos
2025-05-30 15:40:52.355 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 15:40:52.385 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 15:40:52.386 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 15:40:52.469 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.08 segundos
2025-05-30 15:40:52.470 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 15:40:52.783 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 15:40:52.784 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 15:40:52.792 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 15:40:53.704 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_154053.png
2025-05-30 15:40:53.706 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 15:40:53.707 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 15:40:53.708 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 15:44:24.427 | INFO     | __main__:main:348 - Programa interrumpido por el usuario
2025-05-30 15:44:24.428 | INFO     | __main__:main:352 - Servicio finalizado. Cerrando conexiones...
2025-05-30 15:44:24.429 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 15:44:24.430 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
#---2025-05-30 16:54:43.808 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:54:43.808 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:56:04.030 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:56:04.031 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 16:57:01.871 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:57:01.871 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:57:02.641 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 16:57:02.642 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.15 segundos
2025-05-30 16:57:44.932 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:57:44.932 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:57:45.194 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 16:57:45.195 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 16:57:49.421 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 16:57:49.421 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 16:57:49.422 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 16:57:49.426 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 16:57:49.427 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 16:57:49.427 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 16:57:49.432 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 16:57:49.437 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 16:57:49.441 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 16:57:49.445 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 16:57:49.448 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 16:57:49.451 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 16:57:49.454 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 16:57:49.459 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:57:49.462 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:57:49.466 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 16:57:49.469 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 16:57:49.470 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 16:57:49.470 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 16:57:49.471 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 16:57:49.471 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 16:57:49.476 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 16:57:49.485 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 16:57:49.489 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 16:57:49.503 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 16:57:49.509 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 16:57:49.515 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 16:57:49.518 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 16:57:49.523 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 16:57:49.540 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 16:57:49.542 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 16:57:49.542 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 16:57:49.543 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 16:57:55.237 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 5.69 segundos
2025-05-30 16:57:55.237 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 16:57:55.267 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 16:57:55.267 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 16:57:55.354 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.09 segundos
2025-05-30 16:57:55.355 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 16:57:55.779 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 16:57:55.779 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 16:57:55.789 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 16:57:57.629 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_165757.png
2025-05-30 16:57:57.630 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 16:57:57.631 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 16:57:57.632 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 16:58:50.830 | INFO     | __main__:main:348 - Programa interrumpido por el usuario
2025-05-30 16:58:50.832 | INFO     | __main__:main:352 - Servicio finalizado. Cerrando conexiones...
2025-05-30 16:58:50.834 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 16:58:50.841 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 16:59:19.980 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 16:59:19.981 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 16:59:20.274 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 16:59:20.275 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 16:59:24.227 | INFO     | __main__:main:309 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 16:59:24.228 | INFO     | __main__:main:310 - Modo desarrollo: True
2025-05-30 16:59:24.228 | INFO     | __main__:test_connections:63 - Probando conexiones a bases de datos...
2025-05-30 16:59:24.233 | INFO     | __main__:test_connections:70 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 16:59:24.235 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 16:59:24.235 | INFO     | __main__:test_connections:79 - Conexión a PostgreSQL funciona correctamente
2025-05-30 16:59:24.239 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 16:59:24.243 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 16:59:24.246 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 16:59:24.251 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 16:59:24.254 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 16:59:24.257 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 16:59:24.260 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 16:59:24.263 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:59:24.266 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 16:59:24.269 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 16:59:24.272 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 16:59:24.272 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 16:59:24.273 | INFO     | __main__:main:325 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 16:59:24.273 | INFO     | __main__:run_ml_forecast:155 - Iniciando módulo de forecasting...
2025-05-30 16:59:24.273 | INFO     | __main__:diagnosticar_datos_disponibles:19 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 16:59:24.277 | INFO     | __main__:diagnosticar_datos_disponibles:23 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 16:59:24.283 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedidos: 7449 documentos
2025-05-30 16:59:24.286 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 16:59:24.296 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 16:59:24.300 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 16:59:24.304 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colección raw_productos: 31 documentos
2025-05-30 16:59:24.307 | INFO     | __main__:diagnosticar_datos_disponibles:34 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 16:59:24.311 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 16:59:24.328 | INFO     | __main__:diagnosticar_datos_disponibles:52 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 16:59:24.328 | INFO     | __main__:diagnosticar_datos_disponibles:59 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 16:59:24.329 | INFO     | __main__:run_ml_forecast:182 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 16:59:24.330 | INFO     | __main__:run_ml_forecast:195 - Entrenando en CPU
2025-05-30 16:59:33.054 | INFO     | __main__:run_ml_forecast:202 - Entrenamiento del modelo general completado en 8.72 segundos
2025-05-30 16:59:33.055 | INFO     | __main__:run_ml_forecast:206 - Guardando modelo general entrenado...
2025-05-30 16:59:33.084 | INFO     | __main__:run_ml_forecast:209 - Modelo general guardado en models/forecast
2025-05-30 16:59:33.084 | INFO     | __main__:run_ml_forecast:216 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 16:59:33.168 | INFO     | __main__:run_ml_forecast:227 - Entrenamiento de 0/10 modelos de productos completado en 0.08 segundos
2025-05-30 16:59:33.169 | INFO     | __main__:run_ml_forecast:241 - Generando predicciones generales...
2025-05-30 16:59:33.605 | INFO     | __main__:run_ml_forecast:243 - Predicciones generales generadas para los próximos 7 días
2025-05-30 16:59:33.606 | INFO     | __main__:run_ml_forecast:246 - Guardando predicciones generales en MongoDB...
2025-05-30 16:59:33.615 | INFO     | __main__:run_ml_forecast:270 - Generando visualización de predicciones generales...
2025-05-30 16:59:34.516 | INFO     | __main__:run_ml_forecast:275 - Visualización general guardada en plots\forecast_20250530_165934.png
2025-05-30 16:59:34.516 | INFO     | __main__:run_ml_forecast:293 - Proceso de forecasting completado exitosamente
2025-05-30 16:59:34.517 | INFO     | __main__:main:337 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 16:59:34.517 | INFO     | __main__:main:343 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:02:47.599 | INFO     | __main__:main:348 - Programa interrumpido por el usuario
2025-05-30 17:02:47.600 | INFO     | __main__:main:352 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:02:47.601 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:02:47.608 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:02:50.903 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:02:50.903 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 17:02:51.163 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:02:51.163 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:02:55.076 | INFO     | __main__:main:312 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:02:55.077 | INFO     | __main__:main:313 - Modo desarrollo: True
2025-05-30 17:02:55.078 | INFO     | __main__:test_connections:66 - Probando conexiones a bases de datos...
2025-05-30 17:02:55.079 | INFO     | __main__:test_connections:73 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:02:55.081 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:02:55.082 | INFO     | __main__:test_connections:82 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:02:55.083 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:02:55.084 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:02:55.086 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:02:55.087 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:02:55.089 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:02:55.090 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:02:55.091 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:02:55.091 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:02:55.093 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:02:55.094 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:02:55.095 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:02:55.095 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:02:55.095 | INFO     | __main__:main:328 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:02:55.096 | INFO     | __main__:run_ml_forecast:158 - Iniciando módulo de forecasting...
2025-05-30 17:02:55.096 | INFO     | __main__:diagnosticar_datos_disponibles:22 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:02:55.097 | INFO     | __main__:diagnosticar_datos_disponibles:26 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:02:55.100 | INFO     | __main__:diagnosticar_datos_disponibles:32 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:02:55.101 | INFO     | __main__:diagnosticar_datos_disponibles:37 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:02:55.108 | INFO     | __main__:diagnosticar_datos_disponibles:32 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:02:55.109 | INFO     | __main__:diagnosticar_datos_disponibles:37 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:02:55.111 | INFO     | __main__:diagnosticar_datos_disponibles:32 - Colección raw_productos: 31 documentos
2025-05-30 17:02:55.112 | INFO     | __main__:diagnosticar_datos_disponibles:37 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:02:55.113 | INFO     | __main__:diagnosticar_datos_disponibles:43 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:02:55.125 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:02:55.125 | INFO     | __main__:diagnosticar_datos_disponibles:62 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:02:55.126 | INFO     | __main__:run_ml_forecast:185 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:02:55.127 | INFO     | __main__:run_ml_forecast:198 - Entrenando en CPU
2025-05-30 17:03:02.238 | INFO     | __main__:run_ml_forecast:205 - Entrenamiento del modelo general completado en 7.11 segundos
2025-05-30 17:03:02.239 | INFO     | __main__:run_ml_forecast:209 - Guardando modelo general entrenado...
2025-05-30 17:03:02.268 | INFO     | __main__:run_ml_forecast:212 - Modelo general guardado en models/forecast
2025-05-30 17:03:02.269 | INFO     | __main__:run_ml_forecast:219 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 17:03:02.344 | INFO     | __main__:run_ml_forecast:230 - Entrenamiento de 0/10 modelos de productos completado en 0.07 segundos
2025-05-30 17:03:02.344 | INFO     | __main__:run_ml_forecast:244 - Generando predicciones generales...
2025-05-30 17:03:02.797 | INFO     | __main__:run_ml_forecast:246 - Predicciones generales generadas para los próximos 7 días
2025-05-30 17:03:02.797 | INFO     | __main__:run_ml_forecast:249 - Guardando predicciones generales en MongoDB...
2025-05-30 17:03:02.801 | INFO     | __main__:run_ml_forecast:273 - Generando visualización de predicciones generales...
2025-05-30 17:03:03.666 | INFO     | __main__:run_ml_forecast:278 - Visualización general guardada en plots\forecast_20250530_170303.png
2025-05-30 17:03:03.667 | INFO     | __main__:run_ml_forecast:296 - Proceso de forecasting completado exitosamente
2025-05-30 17:03:03.667 | INFO     | __main__:main:340 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 17:03:03.668 | INFO     | __main__:main:346 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:04:43.414 | INFO     | __main__:main:351 - Programa interrumpido por el usuario
2025-05-30 17:04:43.415 | INFO     | __main__:main:355 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:04:43.418 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:04:43.420 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:04:47.275 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:04:47.275 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 17:04:47.534 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:04:47.535 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:04:51.474 | INFO     | __main__:main:313 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:04:51.474 | INFO     | __main__:main:314 - Modo desarrollo: True
2025-05-30 17:04:51.475 | INFO     | __main__:test_connections:67 - Probando conexiones a bases de datos...
2025-05-30 17:04:51.476 | INFO     | __main__:test_connections:74 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:04:51.478 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:04:51.479 | INFO     | __main__:test_connections:83 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:04:51.481 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:04:51.483 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:04:51.484 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:04:51.484 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:04:51.486 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:04:51.487 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:04:51.489 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:04:51.489 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:04:51.491 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:04:51.491 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:04:51.493 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:04:51.493 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:04:51.493 | INFO     | __main__:main:329 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:04:51.494 | INFO     | __main__:run_ml_forecast:159 - Iniciando módulo de forecasting...
2025-05-30 17:04:51.494 | INFO     | __main__:diagnosticar_datos_disponibles:23 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:04:51.495 | INFO     | __main__:diagnosticar_datos_disponibles:27 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:04:51.499 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:04:51.500 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:04:51.508 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:04:51.509 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:04:51.512 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colección raw_productos: 31 documentos
2025-05-30 17:04:51.514 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:04:51.515 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:04:51.528 | INFO     | __main__:diagnosticar_datos_disponibles:56 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:04:51.529 | INFO     | __main__:diagnosticar_datos_disponibles:63 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:04:51.530 | INFO     | __main__:run_ml_forecast:186 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:04:51.531 | INFO     | __main__:run_ml_forecast:199 - Entrenando en CPU
2025-05-30 17:04:56.804 | INFO     | __main__:run_ml_forecast:206 - Entrenamiento del modelo general completado en 5.27 segundos
2025-05-30 17:04:56.804 | INFO     | __main__:run_ml_forecast:210 - Guardando modelo general entrenado...
2025-05-30 17:04:56.831 | INFO     | __main__:run_ml_forecast:213 - Modelo general guardado en models/forecast
2025-05-30 17:04:56.832 | INFO     | __main__:run_ml_forecast:220 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 17:04:56.902 | INFO     | __main__:run_ml_forecast:231 - Entrenamiento de 0/10 modelos de productos completado en 0.07 segundos
2025-05-30 17:04:56.902 | INFO     | __main__:run_ml_forecast:245 - Generando predicciones generales...
2025-05-30 17:04:57.324 | INFO     | __main__:run_ml_forecast:247 - Predicciones generales generadas para los próximos 7 días
2025-05-30 17:04:57.325 | INFO     | __main__:run_ml_forecast:250 - Guardando predicciones generales en MongoDB...
2025-05-30 17:04:57.328 | INFO     | __main__:run_ml_forecast:274 - Generando visualización de predicciones generales...
2025-05-30 17:04:57.888 | INFO     | __main__:run_ml_forecast:279 - Visualización general guardada en plots\forecast_20250530_170457.png
2025-05-30 17:04:57.890 | INFO     | __main__:run_ml_forecast:297 - Proceso de forecasting completado exitosamente
2025-05-30 17:04:57.891 | INFO     | __main__:main:341 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 17:04:57.892 | INFO     | __main__:main:347 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:06:36.951 | INFO     | __main__:main:352 - Programa interrumpido por el usuario
2025-05-30 17:06:36.952 | INFO     | __main__:main:356 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:06:36.954 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:06:36.956 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:06:43.262 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:06:43.262 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 17:06:43.513 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:06:43.514 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:06:47.521 | INFO     | __main__:main:315 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:06:47.522 | INFO     | __main__:main:316 - Modo desarrollo: True
2025-05-30 17:06:47.523 | INFO     | __main__:test_connections:69 - Probando conexiones a bases de datos...
2025-05-30 17:06:47.524 | INFO     | __main__:test_connections:76 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:06:47.526 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:06:47.527 | INFO     | __main__:test_connections:85 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:06:47.528 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:06:47.530 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:06:47.531 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:06:47.533 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:06:47.534 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:06:47.535 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:06:47.536 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:06:47.537 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:06:47.538 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:06:47.538 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:06:47.539 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:06:47.540 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:06:47.540 | INFO     | __main__:main:331 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:06:47.540 | INFO     | __main__:run_ml_forecast:161 - Iniciando módulo de forecasting...
2025-05-30 17:06:47.541 | INFO     | __main__:diagnosticar_datos_disponibles:25 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:06:47.542 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:06:47.545 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:06:47.547 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:06:47.554 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:06:47.555 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:06:47.557 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_productos: 31 documentos
2025-05-30 17:06:47.558 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:06:47.559 | INFO     | __main__:diagnosticar_datos_disponibles:46 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:06:47.573 | INFO     | __main__:diagnosticar_datos_disponibles:58 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:06:47.574 | INFO     | __main__:diagnosticar_datos_disponibles:65 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:06:47.574 | INFO     | __main__:run_ml_forecast:188 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:06:47.575 | INFO     | __main__:run_ml_forecast:201 - Entrenando en CPU
2025-05-30 17:06:53.186 | INFO     | __main__:run_ml_forecast:208 - Entrenamiento del modelo general completado en 5.61 segundos
2025-05-30 17:06:53.186 | INFO     | __main__:run_ml_forecast:212 - Guardando modelo general entrenado...
2025-05-30 17:06:53.212 | INFO     | __main__:run_ml_forecast:215 - Modelo general guardado en models/forecast
2025-05-30 17:06:53.212 | INFO     | __main__:run_ml_forecast:222 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 17:06:53.281 | INFO     | __main__:run_ml_forecast:233 - Entrenamiento de 0/10 modelos de productos completado en 0.07 segundos
2025-05-30 17:06:53.282 | INFO     | __main__:run_ml_forecast:247 - Generando predicciones generales...
2025-05-30 17:06:53.729 | INFO     | __main__:run_ml_forecast:249 - Predicciones generales generadas para los próximos 7 días
2025-05-30 17:06:53.730 | INFO     | __main__:run_ml_forecast:252 - Guardando predicciones generales en MongoDB...
2025-05-30 17:06:53.733 | INFO     | __main__:run_ml_forecast:276 - Generando visualización de predicciones generales...
2025-05-30 17:06:54.233 | INFO     | __main__:run_ml_forecast:281 - Visualización general guardada en plots\forecast_20250530_170654.png
2025-05-30 17:06:54.234 | INFO     | __main__:run_ml_forecast:299 - Proceso de forecasting completado exitosamente
2025-05-30 17:06:54.234 | INFO     | __main__:main:343 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 17:06:54.235 | INFO     | __main__:main:349 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:24:48.250 | INFO     | __main__:main:354 - Programa interrumpido por el usuario
2025-05-30 17:24:48.250 | INFO     | __main__:main:358 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:24:48.251 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:24:48.254 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 17:25:09.545 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:25:09.546 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 17:25:09.798 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:25:09.799 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:28:43.388 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 17:28:43.388 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 17:28:43.640 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 17:28:43.640 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 17:28:47.331 | INFO     | __main__:main:315 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 17:28:47.332 | INFO     | __main__:main:316 - Modo desarrollo: True
2025-05-30 17:28:47.333 | INFO     | __main__:test_connections:69 - Probando conexiones a bases de datos...
2025-05-30 17:28:47.334 | INFO     | __main__:test_connections:76 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 17:28:47.336 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 17:28:47.337 | INFO     | __main__:test_connections:85 - Conexión a PostgreSQL funciona correctamente
2025-05-30 17:28:47.338 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 17:28:47.339 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 17:28:47.340 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 17:28:47.342 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 17:28:47.343 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 17:28:47.344 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 17:28:47.344 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 17:28:47.345 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:28:47.346 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 17:28:47.348 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 17:28:47.348 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 17:28:47.348 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 17:28:47.349 | INFO     | __main__:main:331 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 17:28:47.349 | INFO     | __main__:run_ml_forecast:161 - Iniciando módulo de forecasting...
2025-05-30 17:28:47.349 | INFO     | __main__:diagnosticar_datos_disponibles:25 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 17:28:47.350 | INFO     | __main__:diagnosticar_datos_disponibles:29 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 17:28:47.354 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedidos: 7449 documentos
2025-05-30 17:28:47.355 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 17:28:47.362 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 17:28:47.363 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 17:28:47.365 | INFO     | __main__:diagnosticar_datos_disponibles:35 - Colección raw_productos: 31 documentos
2025-05-30 17:28:47.366 | INFO     | __main__:diagnosticar_datos_disponibles:40 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 17:28:47.367 | INFO     | __main__:diagnosticar_datos_disponibles:46 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 17:28:47.379 | INFO     | __main__:diagnosticar_datos_disponibles:58 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 17:28:47.380 | INFO     | __main__:diagnosticar_datos_disponibles:65 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 17:28:47.380 | INFO     | __main__:run_ml_forecast:188 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 17:28:47.381 | INFO     | __main__:run_ml_forecast:201 - Entrenando en CPU
2025-05-30 17:28:47.424 | ERROR    | __main__:run_ml_forecast:303 - Error en el proceso de forecasting: tuple index out of range
2025-05-30 17:28:47.425 | WARNING  | __main__:main:345 - El módulo ML presentó errores. Revisar logs para más detalles.
2025-05-30 17:28:47.425 | INFO     | __main__:main:349 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 17:29:10.076 | INFO     | __main__:main:354 - Programa interrumpido por el usuario
2025-05-30 17:29:10.078 | INFO     | __main__:main:358 - Servicio finalizado. Cerrando conexiones...
2025-05-30 17:29:10.079 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 17:29:10.081 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 18:14:33.451 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:14:33.451 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 18:14:33.729 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:14:33.730 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 18:19:03.671 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:19:03.671 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 18:19:03.937 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:19:03.938 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 18:19:07.061 | INFO     | __main__:main:406 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 18:19:07.061 | INFO     | __main__:main:407 - Modo desarrollo: True
2025-05-30 18:19:07.062 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 18:19:07.063 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 18:19:07.065 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 18:19:07.066 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 18:19:07.068 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 18:19:07.069 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 18:19:07.070 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 18:19:07.071 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 18:19:07.072 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 18:19:07.073 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 18:19:07.075 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 18:19:07.075 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:19:07.076 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:19:07.077 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 18:19:07.078 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 18:19:07.078 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 18:19:07.078 | INFO     | __main__:main:422 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 18:19:07.079 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 18:19:07.079 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 18:19:07.080 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 18:19:07.084 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 18:19:07.085 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 18:19:07.097 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 18:19:07.099 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 18:19:07.101 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 18:19:07.102 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 18:19:07.105 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 18:19:07.288 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 18:19:07.289 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 18:19:07.289 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 18:19:07.290 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 18:19:13.141 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.85 segundos
2025-05-30 18:19:13.142 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 18:19:13.172 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 18:19:13.173 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 18:19:13.366 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 0/10 modelos de productos completado en 0.19 segundos
2025-05-30 18:19:13.367 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 18:19:13.683 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 18:19:13.684 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 18:19:13.832 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 18:19:13.833 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 18:19:13.974 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 18:19:13.975 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 18:19:13.984 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 18:19:13.985 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 18:19:13.986 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 18:19:14.553 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_181914.png
2025-05-30 18:19:14.554 | INFO     | __main__:run_ml_forecast:390 - Proceso de forecasting completado exitosamente
2025-05-30 18:19:14.556 | INFO     | __main__:main:434 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 18:19:14.556 | INFO     | __main__:main:440 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 18:36:39.567 | INFO     | __main__:main:445 - Programa interrumpido por el usuario
2025-05-30 18:36:39.568 | INFO     | __main__:main:449 - Servicio finalizado. Cerrando conexiones...
2025-05-30 18:36:39.568 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 18:36:39.570 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 18:37:04.904 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:37:04.905 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 18:37:05.173 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:37:05.174 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 18:37:08.384 | INFO     | __main__:main:406 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 18:37:08.385 | INFO     | __main__:main:407 - Modo desarrollo: True
2025-05-30 18:37:08.385 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 18:37:08.387 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 18:37:08.389 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 18:37:08.389 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 18:37:08.391 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 18:37:08.392 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 18:37:08.394 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 18:37:08.395 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 18:37:08.396 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 18:37:08.398 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 18:37:08.399 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 18:37:08.400 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:37:08.401 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:37:08.401 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 18:37:08.402 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 18:37:08.403 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 18:37:08.403 | INFO     | __main__:main:422 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 18:37:08.403 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 18:37:08.403 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 18:37:08.404 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 18:37:08.408 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 18:37:08.409 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 18:37:08.418 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 18:37:08.419 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 18:37:08.421 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 18:37:08.422 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 18:37:08.422 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 18:37:08.435 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 18:37:08.435 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 18:37:08.436 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 18:37:08.437 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 18:37:14.331 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.89 segundos
2025-05-30 18:37:14.332 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 18:37:14.359 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 18:37:14.359 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 18:37:55.801 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 41.44 segundos
2025-05-30 18:37:55.801 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 18:37:55.966 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 18:37:55.968 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 18:37:56.313 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 18:37:56.314 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 18:37:56.682 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 18:37:56.683 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 18:37:56.822 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 18:37:56.823 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 18:37:56.827 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 18:37:56.829 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 18:37:56.830 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 18:37:59.347 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 18:37:59.348 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 18:37:59.368 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 18:38:00.234 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 18:38:00.250 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 18:38:00.250 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 18:38:00.956 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_183800.png
2025-05-30 18:38:00.957 | INFO     | __main__:run_ml_forecast:381 - Generando visualización para producto 16...
2025-05-30 18:38:01.426 | INFO     | __main__:run_ml_forecast:386 - Visualización de producto 16 guardada en plots\product_16_20250530_183801.png
2025-05-30 18:38:01.427 | INFO     | __main__:run_ml_forecast:381 - Generando visualización para producto 25...
2025-05-30 18:38:01.875 | INFO     | __main__:run_ml_forecast:386 - Visualización de producto 25 guardada en plots\product_25_20250530_183801.png
2025-05-30 18:38:01.875 | INFO     | __main__:run_ml_forecast:381 - Generando visualización para producto 11...
2025-05-30 18:38:02.315 | INFO     | __main__:run_ml_forecast:386 - Visualización de producto 11 guardada en plots\product_11_20250530_183802.png
2025-05-30 18:38:02.316 | INFO     | __main__:run_ml_forecast:390 - Proceso de forecasting completado exitosamente
2025-05-30 18:38:02.316 | INFO     | __main__:main:434 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 18:38:02.317 | INFO     | __main__:main:440 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 18:47:38.475 | INFO     | __main__:main:445 - Programa interrumpido por el usuario
2025-05-30 18:47:38.475 | INFO     | __main__:main:449 - Servicio finalizado. Cerrando conexiones...
2025-05-30 18:47:38.477 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 18:47:38.478 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 18:47:58.228 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 18:47:58.228 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 18:47:58.491 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 18:47:58.492 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-05-30 18:48:01.440 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 18:48:01.441 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-05-30 18:48:01.441 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 18:48:01.443 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 18:48:01.445 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 18:48:01.445 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 18:48:01.447 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 18:48:01.448 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 18:48:01.449 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 18:48:01.451 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 18:48:01.453 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 18:48:01.454 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 18:48:01.455 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 18:48:01.456 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:48:01.457 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 18:48:01.458 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 18:48:01.459 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 18:48:01.459 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 18:48:01.459 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 18:48:01.460 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 18:48:01.460 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 18:48:01.461 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 18:48:01.464 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 18:48:01.465 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 18:48:01.473 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 18:48:01.474 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 18:48:01.476 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 18:48:01.477 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 18:48:01.478 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 18:48:01.490 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 18:48:01.492 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 18:48:01.492 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 18:48:01.493 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 18:48:06.926 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.43 segundos
2025-05-30 18:48:06.927 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 18:48:06.956 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 18:48:06.957 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 18:48:52.333 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 45.38 segundos
2025-05-30 18:48:52.333 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 18:48:52.491 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 18:48:52.491 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 18:48:53.054 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 18:48:53.054 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 18:48:53.194 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 18:48:53.194 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 18:48:53.344 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 18:48:53.344 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 18:48:53.349 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 18:48:53.351 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 18:48:53.351 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 18:48:55.928 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 18:48:55.929 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 18:48:55.937 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 18:48:56.814 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 18:48:56.817 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 18:48:56.819 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 18:48:57.547 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_184857.png
2025-05-30 18:48:57.548 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-05-30 18:48:57.548 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-05-30 18:48:57.966 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250530_184857.png
2025-05-30 18:48:57.967 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-05-30 18:48:58.409 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250530_184858.png
2025-05-30 18:48:58.410 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-05-30 18:48:58.870 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250530_184858.png
2025-05-30 18:48:58.871 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-05-30 18:48:59.390 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250530_184859.png
2025-05-30 18:48:59.391 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-05-30 18:48:59.852 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250530_184859.png
2025-05-30 18:48:59.853 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-05-30 18:49:00.316 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250530_184900.png
2025-05-30 18:49:00.317 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-05-30 18:49:01.003 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250530_184900.png
2025-05-30 18:49:01.003 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-05-30 18:49:01.438 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250530_184901.png
2025-05-30 18:49:01.439 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-05-30 18:49:01.907 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250530_184901.png
2025-05-30 18:49:01.907 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-05-30 18:49:01.911 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-05-30 18:49:01.912 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-05-30 18:49:03.426 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250530_184903.png
2025-05-30 18:49:03.427 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-05-30 18:49:05.152 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250530_184905.png
2025-05-30 18:49:05.153 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-05-30 18:49:06.833 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250530_184906.png
2025-05-30 18:49:06.834 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-05-30 18:49:08.284 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250530_184908.png
2025-05-30 18:49:08.284 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-05-30 18:49:10.019 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250530_184909.png
2025-05-30 18:49:10.019 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-05-30 18:49:10.020 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 18:49:10.020 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 18:50:31.301 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-05-30 18:50:31.302 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-05-30 18:50:31.302 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 18:50:31.303 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 22:35:02.516 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:35:02.517 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 22:35:02.870 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 22:35:02.870 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.09 segundos
2025-05-30 22:35:08.514 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 22:35:08.515 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-05-30 22:35:08.516 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 22:35:08.517 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 22:35:08.518 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 22:35:08.519 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 22:35:08.520 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 22:35:08.521 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 22:35:08.523 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 22:35:08.524 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 22:35:08.526 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 22:35:08.527 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 22:35:08.528 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 22:35:08.530 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 22:35:08.531 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 22:35:08.532 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 22:35:08.534 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 22:35:08.534 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 22:35:08.535 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 22:35:08.535 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 22:35:08.535 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 22:35:08.537 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 22:35:08.542 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 22:35:08.545 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 22:35:08.556 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 22:35:08.557 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 22:35:08.559 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 22:35:08.561 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 22:35:08.563 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 22:35:08.575 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 22:35:08.575 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 22:35:08.576 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 22:35:08.579 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 22:35:14.015 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.44 segundos
2025-05-30 22:35:14.015 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 22:35:14.051 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 22:35:14.051 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 22:36:06.061 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 52.01 segundos
2025-05-30 22:36:06.061 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 22:36:06.226 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 22:36:06.227 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 22:36:06.792 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 22:36:06.793 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 22:36:06.948 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 22:36:06.948 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 22:36:07.099 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 22:36:07.100 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 22:36:07.106 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 22:36:07.108 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 22:36:07.108 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 22:36:10.478 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 22:36:10.478 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 22:36:10.488 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 22:36:11.786 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 22:36:11.789 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 22:36:11.790 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 22:36:12.877 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_223612.png
2025-05-30 22:36:12.877 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-05-30 22:36:12.878 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-05-30 22:36:13.912 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250530_223613.png
2025-05-30 22:36:13.913 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-05-30 22:36:14.505 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250530_223614.png
2025-05-30 22:36:14.506 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-05-30 22:36:14.991 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250530_223614.png
2025-05-30 22:36:14.992 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-05-30 22:36:15.474 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250530_223615.png
2025-05-30 22:36:15.475 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-05-30 22:36:15.983 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250530_223615.png
2025-05-30 22:36:15.984 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-05-30 22:36:16.664 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250530_223616.png
2025-05-30 22:36:16.664 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-05-30 22:36:17.965 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250530_223617.png
2025-05-30 22:36:17.966 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-05-30 22:36:18.550 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250530_223618.png
2025-05-30 22:36:18.550 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-05-30 22:36:19.066 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250530_223618.png
2025-05-30 22:36:19.067 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-05-30 22:36:19.077 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-05-30 22:36:19.078 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-05-30 22:36:20.736 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250530_223620.png
2025-05-30 22:36:20.737 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-05-30 22:36:22.392 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250530_223622.png
2025-05-30 22:36:22.392 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-05-30 22:36:24.127 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250530_223624.png
2025-05-30 22:36:24.128 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-05-30 22:36:25.666 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250530_223625.png
2025-05-30 22:36:25.668 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-05-30 22:36:27.436 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250530_223627.png
2025-05-30 22:36:27.437 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-05-30 22:36:27.437 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 22:36:27.438 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 22:36:34.978 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-05-30 22:36:34.979 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-05-30 22:36:34.981 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 22:36:34.983 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 22:39:57.255 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:39:57.256 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 22:40:01.638 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:40:01.638 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 22:54:36.656 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:54:36.656 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 22:54:41.057 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 22:54:41.058 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 23:11:55.766 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:11:55.767 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 23:12:03.052 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:12:03.053 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-05-30 23:12:18.237 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:12:18.237 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-05-30 23:12:18.514 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-05-30 23:12:18.515 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-05-30 23:12:21.980 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-05-30 23:12:21.981 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-05-30 23:12:21.982 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-05-30 23:12:21.983 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-05-30 23:12:21.985 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-05-30 23:12:21.986 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-05-30 23:12:21.987 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-05-30 23:12:21.988 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-05-30 23:12:21.989 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-05-30 23:12:21.990 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-05-30 23:12:21.992 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-05-30 23:12:21.993 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-05-30 23:12:21.995 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-05-30 23:12:21.996 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-05-30 23:12:21.997 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-05-30 23:12:21.998 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-05-30 23:12:21.999 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-05-30 23:12:21.999 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-05-30 23:12:21.999 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-05-30 23:12:21.999 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-05-30 23:12:22.000 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-05-30 23:12:22.001 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-05-30 23:12:22.004 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-05-30 23:12:22.005 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-05-30 23:12:22.015 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-05-30 23:12:22.016 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-05-30 23:12:22.017 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-05-30 23:12:22.019 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-05-30 23:12:22.020 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-05-30 23:12:22.034 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-05-30 23:12:22.034 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-05-30 23:12:22.035 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-05-30 23:12:22.036 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-05-30 23:12:27.786 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 5.75 segundos
2025-05-30 23:12:27.787 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-05-30 23:12:27.856 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-05-30 23:12:27.857 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-05-30 23:13:25.638 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 57.78 segundos
2025-05-30 23:13:25.638 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-05-30 23:13:25.837 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-05-30 23:13:25.837 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-05-30 23:13:26.163 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-05-30 23:13:26.164 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-05-30 23:13:26.524 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-05-30 23:13:26.525 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-05-30 23:13:26.664 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-05-30 23:13:26.665 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-05-30 23:13:26.670 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-05-30 23:13:26.671 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-05-30 23:13:26.671 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-05-30 23:13:29.204 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-05-30 23:13:29.205 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-05-30 23:13:29.212 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-05-30 23:13:30.104 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-05-30 23:13:30.108 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-05-30 23:13:30.109 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-05-30 23:13:30.847 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250530_231330.png
2025-05-30 23:13:30.848 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-05-30 23:13:30.848 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-05-30 23:13:31.321 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250530_231331.png
2025-05-30 23:13:31.321 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-05-30 23:13:31.751 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250530_231331.png
2025-05-30 23:13:31.752 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-05-30 23:13:32.190 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250530_231332.png
2025-05-30 23:13:32.191 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-05-30 23:13:32.606 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250530_231332.png
2025-05-30 23:13:32.607 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-05-30 23:13:33.030 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250530_231332.png
2025-05-30 23:13:33.031 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-05-30 23:13:33.441 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250530_231333.png
2025-05-30 23:13:33.442 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-05-30 23:13:34.102 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250530_231334.png
2025-05-30 23:13:34.102 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-05-30 23:13:34.514 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250530_231334.png
2025-05-30 23:13:34.515 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-05-30 23:13:34.943 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250530_231334.png
2025-05-30 23:13:34.943 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-05-30 23:13:34.947 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-05-30 23:13:34.947 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-05-30 23:13:36.366 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250530_231336.png
2025-05-30 23:13:36.367 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-05-30 23:13:37.889 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250530_231337.png
2025-05-30 23:13:37.889 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-05-30 23:13:39.423 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250530_231339.png
2025-05-30 23:13:39.423 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-05-30 23:13:40.756 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250530_231340.png
2025-05-30 23:13:40.756 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-05-30 23:13:42.362 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250530_231342.png
2025-05-30 23:13:42.362 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-05-30 23:13:42.363 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-05-30 23:13:42.363 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-05-30 23:13:44.551 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-05-30 23:13:44.553 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-05-30 23:13:44.555 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-05-30 23:13:44.557 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-05-30 23:13:55.051 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:13:55.051 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-05-30 23:13:55.542 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-05-30 23:13:55.542 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 10:44:47.765 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:44:47.766 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 10:44:48.033 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 10:44:48.033 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 10:44:51.363 | INFO     | __main__:main:431 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 10:44:51.364 | INFO     | __main__:main:432 - Modo desarrollo: True
2025-06-01 10:44:51.365 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-06-01 10:44:51.366 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 10:44:51.367 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 10:44:51.368 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-06-01 10:44:51.368 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 10:44:51.369 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 10:44:51.370 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 10:44:51.372 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 10:44:51.373 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 10:44:51.375 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 10:44:51.376 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 10:44:51.376 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:44:51.377 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:44:51.378 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 10:44:51.378 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 10:44:51.379 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 10:44:51.379 | INFO     | __main__:main:447 - Sincronización desactivada. Usando datos existentes en MongoDB para ML.
2025-06-01 10:44:51.380 | INFO     | __main__:run_ml_forecast:165 - Iniciando módulo de forecasting...
2025-06-01 10:44:51.380 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB ===
2025-06-01 10:44:51.381 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 10:44:51.384 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos
2025-06-01 10:44:51.385 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 10:44:51.393 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos
2025-06-01 10:44:51.394 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 10:44:51.395 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos
2025-06-01 10:44:51.396 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 10:44:51.397 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 10:44:51.410 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 10:44:51.410 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 10:44:51.411 | INFO     | __main__:run_ml_forecast:192 - Iniciando entrenamiento de nuevo modelo general...
2025-06-01 10:44:51.412 | INFO     | __main__:run_ml_forecast:205 - Entrenando en CPU
2025-06-01 10:44:56.094 | INFO     | __main__:run_ml_forecast:212 - Entrenamiento del modelo general completado en 4.68 segundos
2025-06-01 10:44:56.094 | INFO     | __main__:run_ml_forecast:216 - Guardando modelo general entrenado...
2025-06-01 10:44:56.122 | INFO     | __main__:run_ml_forecast:219 - Modelo general guardado en models/forecast
2025-06-01 10:44:56.123 | INFO     | __main__:run_ml_forecast:226 - Iniciando entrenamiento de modelos para los top 10 productos...
2025-06-01 10:45:32.069 | INFO     | __main__:run_ml_forecast:237 - Entrenamiento de 9/10 modelos de productos completado en 35.95 segundos
2025-06-01 10:45:32.069 | INFO     | __main__:run_ml_forecast:241 - Guardando modelos de productos entrenados...
2025-06-01 10:45:32.299 | INFO     | __main__:run_ml_forecast:244 - Modelos de productos guardados en models/forecast/products
2025-06-01 10:45:32.300 | INFO     | __main__:run_ml_forecast:251 - Generando predicciones generales...
2025-06-01 10:45:32.609 | INFO     | __main__:run_ml_forecast:255 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 10:45:32.609 | INFO     | __main__:run_ml_forecast:258 - Generando predicciones semanales...
2025-06-01 10:45:32.753 | INFO     | __main__:run_ml_forecast:260 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 10:45:32.753 | INFO     | __main__:run_ml_forecast:263 - Generando predicciones mensuales...
2025-06-01 10:45:32.897 | INFO     | __main__:run_ml_forecast:265 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 10:45:32.898 | INFO     | __main__:run_ml_forecast:268 - Guardando predicciones diarias en MongoDB...
2025-06-01 10:45:32.901 | INFO     | __main__:run_ml_forecast:301 - Guardadas 1 predicciones semanales en MongoDB
2025-06-01 10:45:32.902 | INFO     | __main__:run_ml_forecast:305 - Guardadas 1 predicciones mensuales en MongoDB
2025-06-01 10:45:32.903 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones por producto...
2025-06-01 10:45:35.632 | INFO     | __main__:run_ml_forecast:315 - Predicciones generadas para 9 productos
2025-06-01 10:45:35.633 | INFO     | __main__:run_ml_forecast:318 - Guardando predicciones por producto en MongoDB...
2025-06-01 10:45:35.640 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones por categoría...
2025-06-01 10:45:36.558 | INFO     | __main__:run_ml_forecast:327 - Predicciones generadas para 5 categorías
2025-06-01 10:45:36.561 | INFO     | __main__:run_ml_forecast:352 - Guardadas 35 predicciones por categoría en MongoDB
2025-06-01 10:45:36.562 | INFO     | __main__:run_ml_forecast:367 - Generando visualización de predicciones generales...
2025-06-01 10:45:37.095 | INFO     | __main__:run_ml_forecast:372 - Visualización general guardada en plots\forecast_20250601_104536.png
2025-06-01 10:45:37.096 | INFO     | __main__:run_ml_forecast:378 - Generando visualizaciones para 9 productos...
2025-06-01 10:45:37.096 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 16...
2025-06-01 10:45:37.567 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 16 guardada en plots\product_16_20250601_104537.png
2025-06-01 10:45:37.568 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 25...
2025-06-01 10:45:38.307 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 25 guardada en plots\product_25_20250601_104538.png
2025-06-01 10:45:38.308 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 11...
2025-06-01 10:45:38.802 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 11 guardada en plots\product_11_20250601_104538.png
2025-06-01 10:45:38.802 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 9...
2025-06-01 10:45:39.255 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 9 guardada en plots\product_9_20250601_104539.png
2025-06-01 10:45:39.255 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 12...
2025-06-01 10:45:39.713 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 12 guardada en plots\product_12_20250601_104539.png
2025-06-01 10:45:39.714 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 30...
2025-06-01 10:45:40.147 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 30 guardada en plots\product_30_20250601_104540.png
2025-06-01 10:45:40.148 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 29...
2025-06-01 10:45:40.586 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 29 guardada en plots\product_29_20250601_104540.png
2025-06-01 10:45:40.586 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 1...
2025-06-01 10:45:41.297 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 1 guardada en plots\product_1_20250601_104541.png
2025-06-01 10:45:41.298 | INFO     | __main__:run_ml_forecast:382 - Generando visualización para producto 2...
2025-06-01 10:45:41.729 | INFO     | __main__:run_ml_forecast:387 - Visualización de producto 2 guardada en plots\product_2_20250601_104541.png
2025-06-01 10:45:41.729 | INFO     | __main__:run_ml_forecast:392 - Generando visualizaciones por categoría...
2025-06-01 10:45:41.733 | INFO     | __main__:run_ml_forecast:401 - Generando visualizaciones para 5 categorías...
2025-06-01 10:45:41.733 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 1...
2025-06-01 10:45:43.127 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 1 guardada en plots\category_1_20250601_104543.png
2025-06-01 10:45:43.128 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 2...
2025-06-01 10:45:44.667 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 2 guardada en plots\category_2_20250601_104544.png
2025-06-01 10:45:44.668 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 3...
2025-06-01 10:45:46.082 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 3 guardada en plots\category_3_20250601_104545.png
2025-06-01 10:45:46.082 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 6...
2025-06-01 10:45:47.695 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 6 guardada en plots\category_6_20250601_104547.png
2025-06-01 10:45:47.696 | INFO     | __main__:run_ml_forecast:406 - Generando visualización para categoría 8...
2025-06-01 10:45:49.523 | INFO     | __main__:run_ml_forecast:411 - Visualización de categoría 8 guardada en plots\category_8_20250601_104549.png
2025-06-01 10:45:49.524 | INFO     | __main__:run_ml_forecast:415 - Proceso de forecasting completado exitosamente
2025-06-01 10:45:49.525 | INFO     | __main__:main:459 - Módulo ML ejecutado correctamente. Resultados disponibles en MongoDB.
2025-06-01 10:45:49.525 | INFO     | __main__:main:465 - Modo desarrollo: Programa en ejecución. Presiona Ctrl+C para terminar.
2025-06-01 10:46:41.714 | INFO     | __main__:main:470 - Programa interrumpido por el usuario
2025-06-01 10:46:41.715 | INFO     | __main__:main:474 - Servicio finalizado. Cerrando conexiones...
2025-06-01 10:46:41.718 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 10:46:41.720 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 10:47:35.519 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:47:35.520 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 10:47:36.049 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:47:36.050 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 10:53:45.240 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:53:45.241 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 10:56:31.767 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 10:56:31.768 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 10:56:32.030 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 10:56:32.031 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 10:56:35.268 | INFO     | __main__:main:497 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 10:56:35.270 | INFO     | __main__:main:498 - Modo desarrollo: True
2025-06-01 10:56:35.270 | INFO     | __main__:main:499 - Sistema multi-tenant activado
2025-06-01 10:56:35.271 | INFO     | __main__:main:500 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 10:56:35.271 | INFO     | __main__:test_connections:73 - Probando conexiones a bases de datos...
2025-06-01 10:56:35.272 | INFO     | __main__:test_connections:80 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 10:56:35.274 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 10:56:35.275 | INFO     | __main__:test_connections:89 - Conexión a PostgreSQL funciona correctamente
2025-06-01 10:56:35.277 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 10:56:35.278 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 10:56:35.279 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 10:56:35.280 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 10:56:35.282 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 10:56:35.284 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 10:56:35.285 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 10:56:35.286 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:56:35.287 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 10:56:35.288 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 10:56:35.290 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 10:56:35.290 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 10:56:35.290 | INFO     | __main__:main:537 - ======= PROCESANDO TENANT 1 =======
2025-06-01 10:56:35.291 | INFO     | __main__:run_ml_forecast:168 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 10:56:35.291 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 10:56:35.292 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 10:56:35.296 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 10:56:35.298 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 10:56:35.307 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 10:56:35.308 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 10:56:35.310 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 10:56:35.311 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 10:56:35.313 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 10:56:35.325 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 10:56:35.326 | INFO     | __main__:diagnosticar_datos_disponibles:69 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 10:56:35.326 | INFO     | __main__:run_ml_forecast:218 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 10:56:35.327 | INFO     | __main__:run_ml_forecast:231 - Entrenando en CPU
2025-06-01 10:56:49.370 | INFO     | __main__:run_ml_forecast:239 - Entrenamiento del modelo general completado en 14.04 segundos
2025-06-01 10:56:49.372 | INFO     | __main__:run_ml_forecast:243 - Guardando modelo general entrenado para tenant 1...
2025-06-01 10:56:49.394 | INFO     | __main__:run_ml_forecast:246 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 10:56:49.395 | INFO     | __main__:run_ml_forecast:265 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 10:58:35.485 | INFO     | __main__:run_ml_forecast:276 - Entrenamiento de 9/10 modelos de productos completado en 106.09 segundos
2025-06-01 10:58:35.486 | INFO     | __main__:run_ml_forecast:280 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 10:58:35.655 | INFO     | __main__:run_ml_forecast:283 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 10:58:35.656 | INFO     | __main__:run_ml_forecast:286 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 10:58:36.085 | INFO     | __main__:run_ml_forecast:290 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 10:58:36.086 | INFO     | __main__:run_ml_forecast:293 - Generando predicciones semanales para tenant 1...
2025-06-01 10:58:36.535 | INFO     | __main__:run_ml_forecast:295 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 10:58:36.536 | INFO     | __main__:run_ml_forecast:298 - Generando predicciones mensuales para tenant 1...
2025-06-01 10:58:36.724 | INFO     | __main__:run_ml_forecast:300 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 10:58:36.724 | INFO     | __main__:run_ml_forecast:303 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 10:58:36.729 | INFO     | __main__:run_ml_forecast:338 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 10:58:36.731 | INFO     | __main__:run_ml_forecast:342 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 10:58:36.732 | INFO     | __main__:run_ml_forecast:348 - Generando predicciones por producto para tenant 1...
2025-06-01 10:58:39.367 | INFO     | __main__:run_ml_forecast:352 - Predicciones generadas para 9 productos
2025-06-01 10:58:39.368 | INFO     | __main__:run_ml_forecast:355 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 10:58:39.374 | INFO     | __main__:run_ml_forecast:359 - Generando predicciones por categoría para tenant 1...
2025-06-01 10:58:40.224 | INFO     | __main__:run_ml_forecast:364 - Predicciones generadas para 5 categorías
2025-06-01 10:58:40.227 | INFO     | __main__:run_ml_forecast:390 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 10:58:40.228 | INFO     | __main__:run_ml_forecast:404 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 10:58:40.409 | ERROR    | __main__:run_ml_forecast:485 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 10:58:40.409 | WARNING  | __main__:main:552 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 10:58:40.410 | INFO     | __main__:main:554 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 10:58:40.410 | INFO     | __main__:main:556 - Todos los tenants procesados correctamente
2025-06-01 10:58:40.411 | INFO     | __main__:main:560 - Iniciando servidor GraphQL para pruebas...
2025-06-01 10:58:40.412 | INFO     | __main__:main:588 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 10:58:40.413 | INFO     | __main__:main:589 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 10:58:40.414 | INFO     | __main__:main:590 - Presiona Ctrl+C para terminar.
2025-06-01 10:58:41.009 | INFO     | __main__:run_server:571 - Servidor importado desde api.server
2025-06-01 11:01:22.034 | INFO     | __main__:main:596 - Programa interrumpido por el usuario
2025-06-01 11:01:22.036 | INFO     | __main__:main:603 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:01:22.038 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:01:22.040 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:02:23.507 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:02:23.507 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 11:02:23.777 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:02:23.778 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 11:02:27.509 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:02:27.510 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:02:27.511 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:02:27
2025-06-01 11:02:27.512 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:02:27.512 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:02:27.514 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:02:27.515 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:02:27.516 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:02:27.517 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:02:27.519 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:02:27.520 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:02:27.521 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:02:27.522 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:02:27.524 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:02:27.526 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:02:27.526 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:02:27.527 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:02:27.528 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:02:27.529 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:02:27.529 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:02:27.530 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:02:27.530 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:02:27.531 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:02:27.531 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:02:27.535 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:02:27.536 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:02:27.542 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:02:27.544 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:02:27.546 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:02:27.547 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:02:27.548 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:02:27.560 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:02:27.562 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:02:27.565 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:02:27.565 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:02:27.567 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:02:27.569 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:02:27.571 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:02:27.573 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:02:27.574 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:02:27.575 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:02:27.578 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:02:27.578 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:02:27.579 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:02:27.579 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:02:27.580 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:02:40.347 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 12.77 segundos
2025-06-01 11:02:40.348 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:02:40.374 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:02:40.375 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:04:28.607 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 108.23 segundos
2025-06-01 11:04:28.608 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:04:28.783 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:04:28.785 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:04:29.143 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:04:29.143 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:04:29.512 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:04:29.513 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:04:29.653 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:04:29.654 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:04:29.658 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:04:29.660 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:04:29.661 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:04:32.287 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:04:32.288 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:04:32.294 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:04:33.150 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:04:33.154 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:04:33.154 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:04:33.333 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:04:33.335 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:04:33.335 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:04:33.336 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:04:33.336 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:04:33.337 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:04:33.338 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:04:33.338 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:04:33.929 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:10:51.763 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:10:51.764 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:10:51.764 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:10:51.766 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:10:55.444 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:10:55.445 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 11:10:55.711 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:10:55.712 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 11:10:58.967 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:10:58.968 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:10:58.969 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:10:58
2025-06-01 11:10:58.970 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:10:58.970 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:10:58.972 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:10:58.974 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:10:58.974 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:10:58.976 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:10:58.977 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:10:58.979 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:10:58.980 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:10:58.982 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:10:58.983 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:10:58.983 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:10:58.984 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:10:58.985 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:10:58.986 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:10:58.987 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:10:58.988 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:10:58.989 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:10:58.990 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:10:58.990 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:10:58.991 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:10:58.995 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:10:58.996 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:10:59.002 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:10:59.004 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:10:59.007 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:10:59.008 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:10:59.010 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:10:59.022 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:10:59.025 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:10:59.027 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:10:59.027 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:10:59.029 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:10:59.031 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:10:59.032 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:10:59.033 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:10:59.034 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:10:59.035 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:10:59.037 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:10:59.037 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:10:59.038 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:10:59.039 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:10:59.040 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:11:16.323 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 17.28 segundos
2025-06-01 11:11:16.324 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:11:16.380 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:11:16.381 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:13:16.615 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 120.23 segundos
2025-06-01 11:13:16.615 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:13:16.777 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:13:16.778 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:13:17.325 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:13:17.326 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:13:17.466 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:13:17.467 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:13:17.630 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:13:17.630 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:13:17.635 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:13:17.636 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:13:17.636 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:13:20.167 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:13:20.168 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:13:20.175 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:13:21.242 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:13:21.246 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:13:21.247 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:13:21.422 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:13:21.423 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:13:21.424 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:13:21.424 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:13:21.425 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:13:21.426 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:13:21.427 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:13:21.427 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:13:21.648 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:26:49.211 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:26:49.212 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:26:49.214 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:26:49.215 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:27:27.555 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:27:27.555 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 11:27:27.816 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:27:27.817 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 11:27:31.036 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:27:31.037 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:27:31.038 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:27:31
2025-06-01 11:27:31.038 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:27:31.039 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:27:31.040 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:27:31.042 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:27:31.042 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:27:31.043 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:27:31.044 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:27:31.045 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:27:31.045 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:27:31.046 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:27:31.047 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:27:31.047 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:27:31.048 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:27:31.049 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:27:31.050 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:27:31.051 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:27:31.051 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:27:31.052 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:27:31.052 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:27:31.052 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:27:31.053 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:27:31.057 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:27:31.057 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:27:31.064 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:27:31.065 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:27:31.067 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:27:31.069 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:27:31.070 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:27:31.081 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:27:31.083 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:27:31.085 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:27:31.086 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:27:31.089 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:27:31.090 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:27:31.091 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:27:31.092 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:27:31.093 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:27:31.094 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:27:31.095 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:27:31.096 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:27:31.096 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:27:31.097 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:27:31.098 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:27:45.781 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 14.68 segundos
2025-06-01 11:27:45.782 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:27:45.828 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:27:45.829 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:29:45.317 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 119.49 segundos
2025-06-01 11:29:45.317 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:29:45.493 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:29:45.494 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:29:45.862 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:29:45.862 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:29:46.229 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:29:46.230 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:29:46.368 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:29:46.369 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:29:46.373 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:29:46.374 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:29:46.374 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:29:48.995 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:29:48.996 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:29:49.003 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:29:49.898 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:29:49.901 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:29:49.903 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:29:50.081 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:29:50.082 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:29:50.082 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:29:50.082 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:29:50.083 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:29:50.084 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:29:50.084 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:29:50.085 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:29:50.658 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:34:25.632 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:34:25.634 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:34:25.636 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:34:25.638 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 11:39:11.661 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 11:39:11.662 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 11:39:11.950 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 11:39:11.950 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-06-01 11:39:15.346 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 11:39:15.348 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 11:39:15.348 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 11:39:15
2025-06-01 11:39:15.349 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 11:39:15.350 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 11:39:15.350 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 11:39:15.352 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 11:39:15.353 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 11:39:15.354 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 11:39:15.356 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 11:39:15.357 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 11:39:15.358 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 11:39:15.359 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 11:39:15.360 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 11:39:15.361 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 11:39:15.363 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:39:15.363 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 11:39:15.364 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 11:39:15.365 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 11:39:15.366 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 11:39:15.366 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 11:39:15.366 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 11:39:15.367 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 11:39:15.368 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 11:39:15.371 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 11:39:15.372 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 11:39:15.378 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 11:39:15.381 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 11:39:15.383 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 11:39:15.384 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 11:39:15.386 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 11:39:15.400 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 11:39:15.402 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 11:39:15.403 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 11:39:15.404 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 11:39:15.405 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 11:39:15.406 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 11:39:15.407 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 11:39:15.408 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 11:39:15.409 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 11:39:15.411 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 11:39:15.412 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 11:39:15.413 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 11:39:15.413 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 11:39:15.414 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 11:39:15.415 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 11:39:26.971 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 11.56 segundos
2025-06-01 11:39:26.972 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 11:39:26.994 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 11:39:26.995 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 11:41:08.648 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 101.65 segundos
2025-06-01 11:41:08.649 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 11:41:08.863 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 11:41:08.863 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 11:41:09.231 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 11:41:09.232 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 11:41:09.624 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 11:41:09.624 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 11:41:09.763 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 11:41:09.764 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 11:41:09.768 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 11:41:09.770 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 11:41:09.771 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 11:41:12.329 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 11:41:12.329 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 11:41:12.336 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 11:41:13.181 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 11:41:13.183 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 11:41:13.184 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 11:41:13.363 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 11:41:13.364 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 11:41:13.364 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 11:41:13.365 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 11:41:13.365 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 11:41:13.367 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 11:41:13.367 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 11:41:13.368 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 11:41:13.933 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 11:47:46.438 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 11:47:46.440 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 11:47:46.442 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 11:47:46.445 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 12:12:04.623 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 12:12:04.624 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 12:12:04.934 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 12:12:04.935 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 12:12:08.571 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 12:12:08.571 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 12:12:08.572 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 12:12:08
2025-06-01 12:12:08.572 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 12:12:08.573 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 12:12:08.574 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 12:12:08.576 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 12:12:08.577 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 12:12:08.578 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 12:12:08.580 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 12:12:08.581 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 12:12:08.583 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 12:12:08.584 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 12:12:08.585 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 12:12:08.586 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 12:12:08.587 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:12:08.588 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:12:08.588 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 12:12:08.589 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 12:12:08.589 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 12:12:08.590 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 12:12:08.590 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 12:12:08.590 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 12:12:08.592 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 12:12:08.596 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 12:12:08.597 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 12:12:08.605 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 12:12:08.607 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 12:12:08.609 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 12:12:08.611 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 12:12:08.612 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 12:12:08.815 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 12:12:08.818 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 12:12:08.820 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 12:12:08.821 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 12:12:08.823 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 12:12:08.824 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 12:12:08.826 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 12:12:08.828 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 12:12:08.830 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 12:12:08.831 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 12:12:08.833 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 12:12:08.834 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 12:12:08.835 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 12:12:08.835 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 12:12:08.836 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 12:12:21.876 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 13.04 segundos
2025-06-01 12:12:21.878 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 12:12:21.943 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 12:12:21.944 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 12:14:22.754 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 120.81 segundos
2025-06-01 12:14:22.754 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 12:14:22.988 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 12:14:22.989 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 12:14:23.609 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 12:14:23.610 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 12:14:23.769 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 12:14:23.770 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 12:14:23.926 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 12:14:23.927 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 12:14:23.932 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 12:14:23.933 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 12:14:23.933 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 12:14:26.605 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 12:14:26.606 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 12:14:26.614 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 12:14:27.791 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 12:14:27.796 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 12:14:27.797 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 12:14:28.000 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 12:14:28.001 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 12:14:28.002 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 12:14:28.002 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 12:14:28.003 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 12:14:28.003 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 12:14:28.004 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 12:14:28.004 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 12:14:28.297 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 12:23:58.378 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 12:23:58.378 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 12:23:58.379 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 12:23:58.381 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 12:24:27.145 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 12:24:27.146 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 12:24:27.409 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 12:24:27.410 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 12:24:30.842 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 12:24:30.843 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 12:24:30.844 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 12:24:30
2025-06-01 12:24:30.844 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 12:24:30.845 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 12:24:30.846 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 12:24:30.848 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 12:24:30.848 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 12:24:30.850 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 12:24:30.852 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 12:24:30.854 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 12:24:30.855 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 12:24:30.856 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 12:24:30.857 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 12:24:30.858 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 12:24:30.858 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:24:30.859 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:24:30.860 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 12:24:30.860 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 12:24:30.861 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 12:24:30.861 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 12:24:30.861 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 12:24:30.862 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 12:24:30.863 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 12:24:30.866 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 12:24:30.868 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 12:24:30.880 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 12:24:30.882 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 12:24:30.884 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 12:24:30.886 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 12:24:30.887 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 12:24:30.905 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 12:24:30.907 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 12:24:30.909 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 12:24:30.909 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 12:24:30.911 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 12:24:30.912 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 12:24:30.914 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 12:24:30.915 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 12:24:30.916 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 12:24:30.917 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 12:24:30.919 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 12:24:30.920 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 12:24:30.920 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 12:24:30.921 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 12:24:30.921 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 12:24:42.093 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 11.17 segundos
2025-06-01 12:24:42.093 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 12:24:42.117 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 12:24:42.117 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 12:26:44.632 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 122.51 segundos
2025-06-01 12:26:44.633 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 12:26:44.781 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 12:26:44.782 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 12:26:45.091 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 12:26:45.091 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 12:26:45.452 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 12:26:45.453 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 12:26:45.591 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 12:26:45.593 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 12:26:45.596 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 12:26:45.597 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 12:26:45.598 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 12:26:48.028 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 12:26:48.028 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 12:26:48.035 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 12:26:48.908 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 12:26:48.911 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 12:26:48.911 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 12:26:49.092 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 12:26:49.092 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 12:26:49.093 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 12:26:49.093 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 12:26:49.093 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 12:26:49.094 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 12:26:49.095 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 12:26:49.095 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 12:26:49.685 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 12:32:28.627 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 12:32:28.627 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 12:32:28.629 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 12:32:28.630 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 12:36:28.362 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 12:36:28.363 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 12:36:28.626 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 12:36:28.627 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.06 segundos
2025-06-01 12:36:31.888 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 12:36:31.889 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 12:36:31.890 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 12:36:31
2025-06-01 12:36:31.890 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 12:36:31.891 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 12:36:31.892 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 12:36:31.894 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 12:36:31.895 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 12:36:31.896 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 12:36:31.897 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 12:36:31.899 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 12:36:31.900 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 12:36:31.901 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 12:36:31.901 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 12:36:31.902 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 12:36:31.903 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:36:31.904 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:36:31.904 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 12:36:31.905 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 12:36:31.905 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 12:36:31.906 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 12:36:31.906 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 12:36:31.907 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 12:36:31.908 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 12:36:31.911 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 12:36:31.913 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 12:36:31.921 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 12:36:31.923 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 12:36:31.926 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 12:36:31.927 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 12:36:31.928 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 12:36:31.953 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 12:36:31.955 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 12:36:31.957 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 12:36:31.957 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 12:36:31.959 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 12:36:31.961 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 12:36:31.964 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 12:36:31.966 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 12:36:31.966 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 12:36:31.968 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 12:36:31.969 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 12:36:31.970 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 12:36:31.970 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 12:36:31.971 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 12:36:31.971 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 12:36:43.111 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 11.14 segundos
2025-06-01 12:36:43.112 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 12:36:43.135 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 12:36:43.135 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 12:38:34.378 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 111.24 segundos
2025-06-01 12:38:34.379 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 12:38:34.530 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 12:38:34.530 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 12:38:34.842 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 12:38:34.843 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 12:38:35.209 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 12:38:35.209 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 12:38:35.525 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 12:38:35.525 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 12:38:35.530 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 12:38:35.531 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 12:38:35.532 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 12:38:38.147 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 12:38:38.147 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 12:38:38.154 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 12:38:39.224 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 12:38:39.227 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 12:38:39.228 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 12:38:39.796 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 12:38:39.798 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 12:38:39.799 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 12:38:39.799 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 12:38:39.800 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 12:38:39.801 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 12:38:39.801 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 12:38:39.802 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 12:38:40.402 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 12:42:32.705 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 12:42:32.706 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 12:42:32.708 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 12:42:32.711 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 12:49:58.434 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 12:49:58.435 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 12:49:58.884 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 12:49:58.885 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.10 segundos
2025-06-01 12:50:03.619 | INFO     | __main__:main:516 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 12:50:03.621 | INFO     | __main__:main:517 - Modo desarrollo: True
2025-06-01 12:50:03.622 | INFO     | __main__:main:518 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 12:50:03
2025-06-01 12:50:03.623 | INFO     | __main__:main:519 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 12:50:03.625 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 12:50:03.627 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 12:50:03.631 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 12:50:03.632 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 12:50:03.634 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 12:50:03.637 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 12:50:03.639 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 12:50:03.641 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 12:50:03.644 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 12:50:03.646 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 12:50:03.648 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 12:50:03.651 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:50:03.653 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 12:50:03.655 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 12:50:03.658 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 12:50:03.659 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 12:50:03.660 | INFO     | __main__:main:556 - ======= PROCESANDO TENANT 1 =======
2025-06-01 12:50:03.661 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 12:50:03.662 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 12:50:03.664 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 12:50:03.676 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 12:50:03.679 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 12:50:03.706 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 12:50:03.708 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 12:50:03.713 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 12:50:03.716 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 12:50:03.719 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 12:50:03.771 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 12:50:03.776 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 12:50:03.778 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 12:50:03.779 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 12:50:03.783 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 12:50:03.785 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 12:50:03.789 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 12:50:03.792 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 12:50:03.793 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 12:50:03.797 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 12:50:03.799 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 12:50:03.801 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 12:50:03.802 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 12:50:03.803 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 12:50:03.804 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 12:50:26.709 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 22.9 segundos
2025-06-01 12:50:26.711 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 12:50:26.749 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 12:50:26.750 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 12:53:48.281 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 201.53 segundos
2025-06-01 12:53:48.282 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 12:53:48.535 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 12:53:48.536 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 12:53:49.053 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 12:53:49.054 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 12:53:49.604 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 12:53:49.605 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 12:53:49.881 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 12:53:49.881 | INFO     | __main__:run_ml_forecast:316 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 12:53:49.890 | INFO     | __main__:run_ml_forecast:351 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 12:53:49.892 | INFO     | __main__:run_ml_forecast:355 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 12:53:49.893 | INFO     | __main__:run_ml_forecast:361 - Generando predicciones por producto para tenant 1...
2025-06-01 12:53:53.531 | INFO     | __main__:run_ml_forecast:365 - Predicciones generadas para 9 productos
2025-06-01 12:53:53.533 | INFO     | __main__:run_ml_forecast:368 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 12:53:53.548 | INFO     | __main__:run_ml_forecast:372 - Generando predicciones por categoría para tenant 1...
2025-06-01 12:53:54.983 | INFO     | __main__:run_ml_forecast:377 - Predicciones generadas para 5 categorías
2025-06-01 12:53:54.988 | INFO     | __main__:run_ml_forecast:403 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 12:53:54.990 | INFO     | __main__:run_ml_forecast:417 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 12:53:55.356 | ERROR    | __main__:run_ml_forecast:504 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 12:53:55.357 | WARNING  | __main__:main:571 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 12:53:55.359 | INFO     | __main__:main:573 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 12:53:55.360 | INFO     | __main__:main:575 - Todos los tenants procesados correctamente
2025-06-01 12:53:55.361 | INFO     | __main__:main:579 - Iniciando servidor GraphQL para pruebas...
2025-06-01 12:53:55.364 | INFO     | __main__:main:607 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 12:53:55.365 | INFO     | __main__:main:608 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 12:53:55.367 | INFO     | __main__:main:609 - Presiona Ctrl+C para terminar.
2025-06-01 12:53:56.179 | INFO     | __main__:run_server:590 - Servidor importado desde api.server
2025-06-01 13:01:18.784 | INFO     | __main__:main:615 - Programa interrumpido por el usuario
2025-06-01 13:01:18.785 | INFO     | __main__:main:622 - Servicio finalizado. Cerrando conexiones...
2025-06-01 13:01:18.786 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 13:01:18.788 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 13:01:41.972 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 13:01:41.973 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 13:01:42.357 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 13:01:42.359 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.13 segundos
2025-06-01 13:01:47.031 | INFO     | __main__:main:649 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 13:01:47.032 | INFO     | __main__:main:650 - Modo desarrollo: True
2025-06-01 13:01:47.033 | INFO     | __main__:main:651 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 13:01:47
2025-06-01 13:01:47.034 | INFO     | __main__:main:652 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 13:01:47.034 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 13:01:47.036 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 13:01:47.038 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 13:01:47.038 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 13:01:47.040 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 13:01:47.042 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 13:01:47.044 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 13:01:47.046 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 13:01:47.048 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 13:01:47.049 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 13:01:47.051 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 13:01:47.053 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 13:01:47.055 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 13:01:47.056 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 13:01:47.058 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 13:01:47.058 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 13:01:47.058 | INFO     | __main__:main:689 - ======= PROCESANDO TENANT 1 =======
2025-06-01 13:01:47.058 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 13:01:47.060 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 13:01:47.062 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 13:01:47.071 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 13:01:47.074 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 13:01:47.100 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 13:01:47.102 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 13:01:47.108 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 13:01:47.110 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 13:01:47.113 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 13:01:47.163 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 13:01:47.167 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 13:01:47.170 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 13:01:47.171 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 13:01:47.175 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 13:01:47.178 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 13:01:47.181 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 13:01:47.185 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 13:01:47.187 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 13:01:47.192 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 13:01:47.195 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 13:01:47.196 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 13:01:47.197 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 13:01:47.199 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 13:01:47.201 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 13:02:13.128 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 25.92 segundos
2025-06-01 13:02:13.130 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 13:02:13.238 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 13:02:13.240 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 13:05:51.763 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 218.52 segundos
2025-06-01 13:05:51.766 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 13:05:52.076 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 13:05:52.078 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 13:05:52.727 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 13:05:52.728 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 13:05:53.448 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 13:05:53.449 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 13:05:53.752 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 13:05:54.165 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 3.5117060178890824e-05
2025-06-01 13:05:54.166 | INFO     | __main__:apply_scale_correction:354 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 13:05:54.167 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 13:05:54.168 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 704.0707187916267
2025-06-01 13:05:54.169 | INFO     | __main__:run_ml_forecast:384 - Corrección de escala aplicada a predicciones diarias
2025-06-01 13:05:54.170 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 6.997384843998589e-05
2025-06-01 13:05:54.170 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 5000000.00) a predicciones anormalmente bajas
2025-06-01 13:05:54.172 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 349.86924219992943
2025-06-01 13:05:54.173 | INFO     | __main__:run_ml_forecast:388 - Corrección de escala aplicada a predicciones semanales
2025-06-01 13:05:54.174 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 6.997384843998589e-05
2025-06-01 13:05:54.176 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 20000000.00) a predicciones anormalmente bajas
2025-06-01 13:05:54.178 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 1399.4769687997177
2025-06-01 13:05:54.180 | INFO     | __main__:run_ml_forecast:392 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 13:05:54.180 | INFO     | __main__:run_ml_forecast:395 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 13:05:54.193 | INFO     | __main__:run_ml_forecast:430 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 13:05:54.199 | INFO     | __main__:run_ml_forecast:434 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 13:05:54.201 | INFO     | __main__:run_ml_forecast:440 - Generando predicciones por producto para tenant 1...
2025-06-01 13:05:57.584 | INFO     | __main__:run_ml_forecast:444 - Predicciones generadas para 9 productos
2025-06-01 13:05:57.585 | INFO     | __main__:apply_product_scale_correction:454 - Valor máximo de predicción por producto antes de corrección: 0.00016028121171984822
2025-06-01 13:05:57.586 | WARNING  | __main__:apply_product_scale_correction:460 - Aplicando corrección de escala (factor: 623903.44) a predicciones por producto
2025-06-01 13:05:57.587 | INFO     | __main__:apply_product_scale_correction:464 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 13:05:57.588 | INFO     | __main__:run_ml_forecast:472 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 13:05:57.602 | INFO     | __main__:run_ml_forecast:476 - Generando predicciones por categoría para tenant 1...
2025-06-01 13:05:59.444 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 0.0001807995759008918
2025-06-01 13:05:59.445 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 829647.96) a predicciones anormalmente bajas
2025-06-01 13:05:59.446 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 13:05:59.447 | INFO     | __main__:run_ml_forecast:484 - Predicciones generadas para 5 categorías
2025-06-01 13:05:59.453 | INFO     | __main__:run_ml_forecast:510 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 13:05:59.455 | INFO     | __main__:run_ml_forecast:524 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 13:05:59.839 | ERROR    | __main__:run_ml_forecast:637 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 13:05:59.841 | WARNING  | __main__:main:704 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 13:05:59.842 | INFO     | __main__:main:706 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 13:05:59.842 | INFO     | __main__:main:708 - Todos los tenants procesados correctamente
2025-06-01 13:05:59.843 | INFO     | __main__:main:712 - Iniciando servidor GraphQL para pruebas...
2025-06-01 13:05:59.845 | INFO     | __main__:main:740 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 13:05:59.847 | INFO     | __main__:main:741 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 13:05:59.848 | INFO     | __main__:main:742 - Presiona Ctrl+C para terminar.
2025-06-01 13:06:00.141 | INFO     | __main__:run_server:723 - Servidor importado desde api.server
2025-06-01 13:35:21.183 | INFO     | __main__:main:748 - Programa interrumpido por el usuario
2025-06-01 13:35:21.184 | INFO     | __main__:main:755 - Servicio finalizado. Cerrando conexiones...
2025-06-01 13:35:21.187 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 13:35:21.190 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 13:38:51.800 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 13:38:51.801 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 13:38:52.245 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 13:38:52.247 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.11 segundos
2025-06-01 13:38:57.601 | INFO     | __main__:main:649 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 13:38:57.602 | INFO     | __main__:main:650 - Modo desarrollo: True
2025-06-01 13:38:57.604 | INFO     | __main__:main:651 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 13:38:57
2025-06-01 13:38:57.604 | INFO     | __main__:main:652 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 13:38:57.605 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 13:38:57.606 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 13:38:57.608 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 13:38:57.609 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 13:38:57.611 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 13:38:57.613 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 13:38:57.614 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 13:38:57.616 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 13:38:57.617 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 13:38:57.618 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 13:38:57.619 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 13:38:57.621 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 13:38:57.623 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 13:38:57.625 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 13:38:57.626 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 13:38:57.627 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 13:38:57.627 | INFO     | __main__:main:689 - ======= PROCESANDO TENANT 1 =======
2025-06-01 13:38:57.628 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 13:38:57.629 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 13:38:57.630 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 13:38:57.636 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 13:38:57.639 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 13:38:57.647 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 13:38:57.649 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 13:38:57.651 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 13:38:57.654 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 13:38:57.656 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 13:38:57.672 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 13:38:57.674 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 13:38:57.675 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 13:38:57.676 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 13:38:57.678 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 13:38:57.680 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 13:38:57.683 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 13:38:57.685 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 13:38:57.686 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 13:38:57.689 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 13:38:57.690 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 13:38:57.691 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 13:38:57.692 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 13:38:57.693 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 13:38:57.694 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 13:39:45.835 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 48.14 segundos
2025-06-01 13:39:45.837 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 13:39:45.889 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 13:39:45.890 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 13:43:47.636 | ERROR    | db.mongo_client:_connect:37 - No se pudo conectar a MongoDB: localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms), Timeout: 5.0s, Topology Description: <TopologyDescription id: 683c914e57521ebd1c1106f6, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>
2025-06-01 13:44:33.682 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 13:44:33.683 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-01 13:44:34.690 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 13:44:34.692 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.23 segundos
2025-06-01 13:44:55.533 | INFO     | __main__:main:649 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 13:44:55.533 | INFO     | __main__:main:650 - Modo desarrollo: True
2025-06-01 13:44:55.534 | INFO     | __main__:main:651 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 13:44:55
2025-06-01 13:44:55.534 | INFO     | __main__:main:652 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 13:44:55.534 | INFO     | __main__:test_connections:86 - Probando conexiones a bases de datos...
2025-06-01 13:44:55.536 | INFO     | __main__:test_connections:93 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 13:44:55.538 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 13:44:55.538 | INFO     | __main__:test_connections:102 - Conexión a PostgreSQL funciona correctamente
2025-06-01 13:44:55.542 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 13:44:55.544 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 13:44:55.546 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 13:44:55.548 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 13:44:55.550 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 13:44:55.552 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 13:44:55.553 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 13:44:55.555 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 13:44:55.558 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 13:44:55.560 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 13:44:55.562 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 13:44:55.563 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 13:44:55.565 | INFO     | __main__:main:689 - ======= PROCESANDO TENANT 1 =======
2025-06-01 13:44:55.566 | INFO     | __main__:run_ml_forecast:181 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 13:44:55.566 | INFO     | __main__:diagnosticar_datos_disponibles:29 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 13:44:55.569 | INFO     | __main__:diagnosticar_datos_disponibles:33 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 13:44:55.589 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 13:44:55.599 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 13:44:55.613 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 13:44:55.626 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 13:44:55.631 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 13:44:55.634 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 13:44:55.639 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 13:44:55.666 | INFO     | __main__:diagnosticar_datos_disponibles:62 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 13:44:55.673 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 13:44:55.675 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 13:44:55.676 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 13:44:55.683 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 13:44:55.687 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 13:44:55.692 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 13:44:55.694 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 13:44:55.697 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 13:44:55.703 | INFO     | __main__:diagnosticar_datos_disponibles:73 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 13:44:55.705 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 13:44:55.706 | INFO     | __main__:diagnosticar_datos_disponibles:80 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 13:44:55.706 | INFO     | __main__:diagnosticar_datos_disponibles:82 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 13:44:55.707 | INFO     | __main__:run_ml_forecast:231 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 13:44:55.709 | INFO     | __main__:run_ml_forecast:244 - Entrenando en CPU
2025-06-01 13:45:25.252 | INFO     | __main__:run_ml_forecast:252 - Entrenamiento del modelo general completado en 29.54 segundos
2025-06-01 13:45:25.252 | INFO     | __main__:run_ml_forecast:256 - Guardando modelo general entrenado para tenant 1...
2025-06-01 13:45:25.285 | INFO     | __main__:run_ml_forecast:259 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 13:45:25.285 | INFO     | __main__:run_ml_forecast:278 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 13:48:30.686 | INFO     | __main__:run_ml_forecast:289 - Entrenamiento de 9/10 modelos de productos completado en 185.4 segundos
2025-06-01 13:48:30.687 | INFO     | __main__:run_ml_forecast:293 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 13:48:30.920 | INFO     | __main__:run_ml_forecast:296 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 13:48:30.920 | INFO     | __main__:run_ml_forecast:299 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 13:48:31.687 | INFO     | __main__:run_ml_forecast:303 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 13:48:31.688 | INFO     | __main__:run_ml_forecast:306 - Generando predicciones semanales para tenant 1...
2025-06-01 13:48:31.892 | INFO     | __main__:run_ml_forecast:308 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 13:48:31.893 | INFO     | __main__:run_ml_forecast:311 - Generando predicciones mensuales para tenant 1...
2025-06-01 13:48:32.161 | INFO     | __main__:run_ml_forecast:313 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 13:48:32.382 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 5.064385186415166e-05
2025-06-01 13:48:32.382 | INFO     | __main__:apply_scale_correction:354 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 13:48:32.383 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 13:48:32.384 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 1015.3712469873424
2025-06-01 13:48:32.385 | INFO     | __main__:run_ml_forecast:384 - Corrección de escala aplicada a predicciones diarias
2025-06-01 13:48:32.386 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 0.00015375590919575188
2025-06-01 13:48:32.387 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 3251907.54) a predicciones anormalmente bajas
2025-06-01 13:48:32.388 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 500.0
2025-06-01 13:48:32.389 | INFO     | __main__:run_ml_forecast:388 - Corrección de escala aplicada a predicciones semanales
2025-06-01 13:48:32.390 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 0.00015375590919575188
2025-06-01 13:48:32.392 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 13007630.15) a predicciones anormalmente bajas
2025-06-01 13:48:32.392 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 2000.0
2025-06-01 13:48:32.393 | INFO     | __main__:run_ml_forecast:392 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 13:48:32.394 | INFO     | __main__:run_ml_forecast:395 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 13:48:32.407 | INFO     | __main__:run_ml_forecast:430 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 13:48:32.410 | INFO     | __main__:run_ml_forecast:434 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 13:48:32.410 | INFO     | __main__:run_ml_forecast:440 - Generando predicciones por producto para tenant 1...
2025-06-01 13:48:35.318 | INFO     | __main__:run_ml_forecast:444 - Predicciones generadas para 9 productos
2025-06-01 13:48:35.319 | INFO     | __main__:apply_product_scale_correction:454 - Valor máximo de predicción por producto antes de corrección: 0.0001170315663330257
2025-06-01 13:48:35.320 | WARNING  | __main__:apply_product_scale_correction:460 - Aplicando corrección de escala (factor: 854470.32) a predicciones por producto
2025-06-01 13:48:35.322 | INFO     | __main__:apply_product_scale_correction:464 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 13:48:35.323 | INFO     | __main__:run_ml_forecast:472 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 13:48:35.334 | INFO     | __main__:run_ml_forecast:476 - Generando predicciones por categoría para tenant 1...
2025-06-01 13:48:36.567 | INFO     | __main__:apply_scale_correction:333 - Valor máximo de predicción antes de corrección: 0.00019061691273236647
2025-06-01 13:48:36.568 | WARNING  | __main__:apply_scale_correction:358 - Aplicando corrección de escala (factor: 786918.63) a predicciones anormalmente bajas
2025-06-01 13:48:36.569 | INFO     | __main__:apply_scale_correction:366 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 13:48:36.569 | INFO     | __main__:run_ml_forecast:484 - Predicciones generadas para 5 categorías
2025-06-01 13:48:36.578 | INFO     | __main__:run_ml_forecast:510 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 13:48:36.579 | INFO     | __main__:run_ml_forecast:524 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 13:48:36.765 | ERROR    | __main__:run_ml_forecast:637 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 13:48:36.766 | WARNING  | __main__:main:704 - El módulo ML presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 13:48:36.766 | INFO     | __main__:main:706 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 13:48:36.767 | INFO     | __main__:main:708 - Todos los tenants procesados correctamente
2025-06-01 13:48:36.768 | INFO     | __main__:main:712 - Iniciando servidor GraphQL para pruebas...
2025-06-01 13:48:36.769 | INFO     | __main__:main:740 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 13:48:36.769 | INFO     | __main__:main:741 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 13:48:36.770 | INFO     | __main__:main:742 - Presiona Ctrl+C para terminar.
2025-06-01 13:48:37.699 | INFO     | __main__:run_server:723 - Servidor importado desde api.server
2025-06-01 13:52:34.025 | INFO     | __main__:main:748 - Programa interrumpido por el usuario
2025-06-01 13:52:34.026 | INFO     | __main__:main:755 - Servicio finalizado. Cerrando conexiones...
2025-06-01 13:52:34.027 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 13:52:34.029 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 14:56:35.905 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 14:56:35.905 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 14:56:36.179 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 14:56:36.179 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 14:57:20.892 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 14:57:20.893 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 14:57:21.156 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 14:57:21.157 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 14:57:24.482 | INFO     | __main__:main:772 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 14:57:24.483 | INFO     | __main__:main:773 - Modo desarrollo: True
2025-06-01 14:57:24.483 | INFO     | __main__:main:774 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 14:57:24
2025-06-01 14:57:24.484 | INFO     | __main__:main:775 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 14:57:24.484 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 14:57:24.485 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 14:57:24.487 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 14:57:24.487 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 14:57:24.488 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 14:57:24.489 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 14:57:24.490 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 14:57:24.491 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 14:57:24.493 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 14:57:24.494 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 14:57:24.496 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 14:57:24.496 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 14:57:24.497 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 14:57:24.498 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 14:57:24.499 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 14:57:24.500 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 14:57:24.500 | INFO     | __main__:main:812 - ======= PROCESANDO TENANT 1 =======
2025-06-01 14:57:24.500 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 14:57:24.501 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 14:57:24.502 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 14:57:24.505 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 14:57:24.506 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 14:57:24.513 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 14:57:24.515 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 14:57:24.516 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 14:57:24.519 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 14:57:24.521 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 14:57:24.534 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 14:57:24.536 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 14:57:24.538 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 14:57:24.539 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 14:57:24.541 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 14:57:24.544 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 14:57:24.546 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 14:57:24.547 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 14:57:24.547 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 14:57:24.549 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 14:57:24.550 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 14:57:24.550 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 14:57:24.551 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 14:57:24.552 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 14:57:24.552 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 14:57:41.630 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 17.08 segundos
2025-06-01 14:57:41.631 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 14:57:41.662 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 14:57:41.662 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 15:00:03.778 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 142.12 segundos
2025-06-01 15:00:03.779 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 15:00:03.980 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 15:00:03.981 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 15:00:04.512 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 15:00:04.513 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 15:00:04.651 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 15:00:04.652 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 15:00:04.792 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 15:00:04.976 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 2.3548975150333717e-05
2025-06-01 15:00:04.977 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 15:00:04.978 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 15:00:04.978 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 472.13929003282817
2025-06-01 15:00:04.979 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 15:00:04.979 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 5.509589141183824e-05
2025-06-01 15:00:04.979 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 5000000.00) a predicciones anormalmente bajas
2025-06-01 15:00:04.980 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 275.4794570591912
2025-06-01 15:00:04.980 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 15:00:04.980 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 5.509589141183824e-05
2025-06-01 15:00:04.981 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20000000.00) a predicciones anormalmente bajas
2025-06-01 15:00:04.981 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 1101.9178282367648
2025-06-01 15:00:04.981 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 15:00:04.981 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 15:00:04.987 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 15:00:04.988 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 15:00:04.988 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 15:00:07.581 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 15:00:07.582 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.000100367957202252
2025-06-01 15:00:07.582 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 996333.92) a predicciones por producto
2025-06-01 15:00:07.583 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 15:00:07.583 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 15:00:07.590 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 15:00:08.652 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00013199932072893716
2025-06-01 15:00:08.652 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 1136369.48) a predicciones anormalmente bajas
2025-06-01 15:00:08.653 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 15:00:08.653 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 15:00:08.656 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 15:00:08.657 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 15:00:08.826 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 15:00:08.827 | WARNING  | __main__:main:827 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:00:08.827 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 15:00:08.829 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 15:00:08.920 | INFO     | __main__:run_ml_segmentation:693 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 15:00:08.921 | INFO     | __main__:run_ml_segmentation:696 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 15:00:08.928 | INFO     | __main__:run_ml_segmentation:700 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 15:00:10.898 | INFO     | __main__:run_ml_segmentation:705 - Segmentación completada en 1.97 segundos
2025-06-01 15:00:10.900 | INFO     | __main__:run_ml_segmentation:706 - Distribución de clientes por segmento: {2: 86, 0: 80, 1: 1}
2025-06-01 15:00:10.900 | INFO     | __main__:run_ml_segmentation:710 - Generando visualizaciones para segmentación de clientes...
2025-06-01 15:00:12.287 | INFO     | __main__:run_ml_segmentation:712 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 15:00:12.287 | INFO     | __main__:run_ml_segmentation:715 - Guardando resultados de la segmentación...
2025-06-01 15:00:12.304 | INFO     | __main__:run_ml_segmentation:719 - Guardando resultados de segmentación en MongoDB...
2025-06-01 15:00:12.306 | CRITICAL | __main__:main:889 - Error fatal en el servicio: "'q'"
2025-06-01 15:00:12.306 | INFO     | __main__:main:891 - Servicio finalizado. Cerrando conexiones...
2025-06-01 15:00:12.307 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 15:00:12.311 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 15:09:32.932 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 15:09:32.933 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 15:09:33.233 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 15:09:33.233 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 15:09:37.051 | INFO     | __main__:main:773 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 15:09:37.052 | INFO     | __main__:main:774 - Modo desarrollo: True
2025-06-01 15:09:37.052 | INFO     | __main__:main:775 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 15:09:37
2025-06-01 15:09:37.053 | INFO     | __main__:main:776 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 15:09:37.054 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 15:09:37.055 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 15:09:37.056 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 15:09:37.057 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 15:09:37.059 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 15:09:37.060 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 15:09:37.061 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 15:09:37.063 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 15:09:37.064 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 15:09:37.064 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 15:09:37.065 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 15:09:37.066 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:09:37.067 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:09:37.067 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 15:09:37.068 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 15:09:37.068 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 15:09:37.069 | INFO     | __main__:main:813 - ======= PROCESANDO TENANT 1 =======
2025-06-01 15:09:37.069 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 15:09:37.069 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 15:09:37.070 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', '1']
2025-06-01 15:09:37.074 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 15:09:37.075 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 15:09:37.082 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 15:09:37.083 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 15:09:37.086 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 15:09:37.087 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 15:09:37.088 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 15:09:37.196 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 15:09:37.198 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 15:09:37.199 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 15:09:37.200 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 15:09:37.202 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 15:09:37.203 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 15:09:37.205 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 15:09:37.207 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 15:09:37.207 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 15:09:37.209 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 15:09:37.210 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 15:09:37.211 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 15:09:37.212 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 15:09:37.213 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 15:09:37.213 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 15:09:54.951 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 17.74 segundos
2025-06-01 15:09:54.951 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 15:09:54.979 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 15:09:54.980 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 15:12:39.636 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 164.65 segundos
2025-06-01 15:12:39.638 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 15:12:39.973 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 15:12:39.973 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 15:12:40.680 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 15:12:40.680 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 15:12:40.873 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 15:12:40.874 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 15:12:41.066 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 15:12:41.263 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 2.0884779587504454e-05
2025-06-01 15:12:41.264 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 15:12:41.265 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 15:12:41.265 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 418.7241671447736
2025-06-01 15:12:41.266 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 15:12:41.267 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 4.1720100853126496e-05
2025-06-01 15:12:41.267 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 5000000.00) a predicciones anormalmente bajas
2025-06-01 15:12:41.268 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 208.60050426563248
2025-06-01 15:12:41.268 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 15:12:41.269 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 4.1720100853126496e-05
2025-06-01 15:12:41.269 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20000000.00) a predicciones anormalmente bajas
2025-06-01 15:12:41.270 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 834.4020170625299
2025-06-01 15:12:41.270 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 15:12:41.271 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 15:12:41.276 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 15:12:41.278 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 15:12:41.278 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 15:12:44.659 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 15:12:44.660 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 5.573381713475101e-05
2025-06-01 15:12:44.661 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 1000000.00) a predicciones por producto
2025-06-01 15:12:44.662 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 55.73381713475101
2025-06-01 15:12:44.663 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 15:12:44.671 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 15:12:46.120 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 9.081041571334936e-05
2025-06-01 15:12:46.121 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 1500000.00) a predicciones anormalmente bajas
2025-06-01 15:12:46.122 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 136.21562357002404
2025-06-01 15:12:46.122 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 15:12:46.126 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 15:12:46.128 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 15:12:46.340 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 15:12:46.340 | WARNING  | __main__:main:828 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:12:46.342 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 15:12:46.342 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 15:12:46.450 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 15:12:46.451 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 15:12:46.467 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 15:12:48.399 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.93 segundos
2025-06-01 15:12:48.400 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {2: 86, 0: 80, 1: 1}
2025-06-01 15:12:48.401 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 15:12:49.045 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 15:12:49.046 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 15:12:49.060 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 15:12:49.062 | ERROR    | __main__:run_ml_segmentation:761 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 15:12:49.063 | WARNING  | __main__:main:840 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:12:49.063 | INFO     | __main__:main:842 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 15:12:49.064 | INFO     | __main__:main:844 - Todos los tenants procesados correctamente
2025-06-01 15:12:49.064 | INFO     | __main__:main:848 - Iniciando servidor GraphQL para pruebas...
2025-06-01 15:12:49.066 | INFO     | __main__:main:876 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 15:12:49.066 | INFO     | __main__:main:877 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 15:12:49.067 | INFO     | __main__:main:878 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 15:12:49.068 | INFO     | __main__:main:879 - Presiona Ctrl+C para terminar.
2025-06-01 15:12:49.475 | INFO     | __main__:run_server:859 - Servidor importado desde api.server
2025-06-01 15:16:33.536 | INFO     | __main__:main:885 - Programa interrumpido por el usuario
2025-06-01 15:16:33.536 | INFO     | __main__:main:892 - Servicio finalizado. Cerrando conexiones...
2025-06-01 15:16:33.538 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 15:16:33.539 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 15:19:30.041 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 15:19:30.041 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.01 segundos
2025-06-01 15:19:30.308 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 15:19:30.308 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 15:19:33.689 | INFO     | __main__:main:773 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 15:19:33.690 | INFO     | __main__:main:774 - Modo desarrollo: True
2025-06-01 15:19:33.691 | INFO     | __main__:main:775 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 15:19:33
2025-06-01 15:19:33.691 | INFO     | __main__:main:776 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 15:19:33.692 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 15:19:33.693 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 15:19:33.695 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 15:19:33.696 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 15:19:33.697 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 15:19:33.698 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 15:19:33.699 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 15:19:33.700 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 15:19:33.701 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 15:19:33.702 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 15:19:33.705 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 15:19:33.706 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:19:33.707 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:19:33.707 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 15:19:33.708 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 15:19:33.708 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 15:19:33.709 | INFO     | __main__:main:813 - ======= PROCESANDO TENANT 1 =======
2025-06-01 15:19:33.710 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 15:19:33.710 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 15:19:33.711 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 15:19:33.715 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 15:19:33.716 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 15:19:33.723 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 15:19:33.725 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 15:19:33.727 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 15:19:33.729 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 15:19:33.730 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 15:19:33.743 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 15:19:33.745 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 15:19:33.747 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 15:19:33.747 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 15:19:33.749 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 15:19:33.751 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 15:19:33.753 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 15:19:33.754 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 15:19:33.755 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 15:19:33.757 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 15:19:33.759 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 15:19:33.759 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 15:19:33.761 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 15:19:33.762 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 15:19:33.763 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 15:19:33.764 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 15:19:33.764 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 15:19:50.804 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 17.04 segundos
2025-06-01 15:19:50.805 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 15:19:50.831 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 15:19:50.832 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 15:22:21.316 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 150.48 segundos
2025-06-01 15:22:21.317 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 15:22:21.546 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 15:22:21.547 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 15:22:22.096 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 15:22:22.096 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 15:22:22.237 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 15:22:22.237 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 15:22:22.380 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 15:22:22.564 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 6.122310878708959e-05
2025-06-01 15:22:22.565 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 15:22:22.565 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 15:22:22.566 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 1227.4774138495557
2025-06-01 15:22:22.566 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 15:22:22.566 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00012104596771678189
2025-06-01 15:22:22.567 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 4130662.17) a predicciones anormalmente bajas
2025-06-01 15:22:22.567 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 500.0
2025-06-01 15:22:22.567 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 15:22:22.568 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00012104596771678189
2025-06-01 15:22:22.568 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 16522648.69) a predicciones anormalmente bajas
2025-06-01 15:22:22.568 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 2000.0
2025-06-01 15:22:22.569 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 15:22:22.569 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 15:22:22.573 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 15:22:22.574 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 15:22:22.575 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 15:22:25.112 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 15:22:25.113 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.00011189185897819698
2025-06-01 15:22:25.114 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 893720.07) a predicciones por producto
2025-06-01 15:22:25.115 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 15:22:25.115 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 15:22:25.124 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 15:22:26.212 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.0001184853335871594
2025-06-01 15:22:26.213 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 1265979.47) a predicciones anormalmente bajas
2025-06-01 15:22:26.213 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 15:22:26.213 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 15:22:26.216 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 15:22:26.217 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 15:22:26.401 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 15:22:26.402 | WARNING  | __main__:main:828 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:22:26.403 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 15:22:26.404 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 15:22:26.530 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 15:22:26.531 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 15:22:26.542 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 15:22:28.159 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.62 segundos
2025-06-01 15:22:28.160 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 15:22:28.161 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 15:22:28.799 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 15:22:28.800 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 15:22:28.808 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 15:22:28.810 | ERROR    | __main__:run_ml_segmentation:761 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 15:22:28.811 | WARNING  | __main__:main:840 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:22:28.811 | INFO     | __main__:main:842 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 15:22:28.812 | INFO     | __main__:main:844 - Todos los tenants procesados correctamente
2025-06-01 15:22:28.812 | INFO     | __main__:main:848 - Iniciando servidor GraphQL para pruebas...
2025-06-01 15:22:28.814 | INFO     | __main__:main:876 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 15:22:28.814 | INFO     | __main__:main:877 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 15:22:28.815 | INFO     | __main__:main:878 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 15:22:28.816 | INFO     | __main__:main:879 - Presiona Ctrl+C para terminar.
2025-06-01 15:22:29.030 | INFO     | __main__:run_server:859 - Servidor importado desde api.server
2025-06-01 15:38:00.545 | INFO     | __main__:main:885 - Programa interrumpido por el usuario
2025-06-01 15:38:00.546 | INFO     | __main__:main:892 - Servicio finalizado. Cerrando conexiones...
2025-06-01 15:38:00.548 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 15:38:00.549 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 15:41:41.007 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 15:41:41.008 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 15:41:41.307 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 15:41:41.308 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 15:41:45.434 | INFO     | __main__:main:773 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 15:41:45.435 | INFO     | __main__:main:774 - Modo desarrollo: True
2025-06-01 15:41:45.435 | INFO     | __main__:main:775 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 15:41:45
2025-06-01 15:41:45.436 | INFO     | __main__:main:776 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 15:41:45.436 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 15:41:45.438 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 15:41:45.440 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 15:41:45.440 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 15:41:45.442 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 15:41:45.443 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 15:41:45.445 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 15:41:45.446 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 15:41:45.447 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 15:41:45.450 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 15:41:45.451 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 15:41:45.452 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:41:45.453 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:41:45.454 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 15:41:45.456 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 15:41:45.457 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 15:41:45.457 | INFO     | __main__:main:813 - ======= PROCESANDO TENANT 1 =======
2025-06-01 15:41:45.458 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 15:41:45.458 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 15:41:45.459 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 15:41:45.462 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 15:41:45.464 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 15:41:45.470 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 15:41:45.472 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 15:41:45.474 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 15:41:45.475 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 15:41:45.476 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 15:41:45.658 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 15:41:45.660 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 15:41:45.662 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 15:41:45.662 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 15:41:45.664 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 15:41:45.666 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 15:41:45.667 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 15:41:45.670 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 15:41:45.670 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 15:41:45.673 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 15:41:45.674 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 15:41:45.675 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 15:41:45.677 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 15:41:45.679 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 15:41:45.679 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 15:41:45.680 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 15:41:45.680 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 15:42:02.738 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 17.06 segundos
2025-06-01 15:42:02.738 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 15:42:02.768 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 15:42:02.768 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 15:44:39.892 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 157.12 segundos
2025-06-01 15:44:39.893 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 15:44:40.134 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 15:44:40.135 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 15:44:40.669 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 15:44:40.669 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 15:44:40.951 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 15:44:40.952 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 15:44:41.235 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 15:44:41.629 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00011688108497764915
2025-06-01 15:44:41.629 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 15:44:41.630 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 17153545.42) a predicciones anormalmente bajas
2025-06-01 15:44:41.630 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 2004.9249999999997
2025-06-01 15:44:41.631 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 15:44:41.631 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.0002303932828908728
2025-06-01 15:44:41.631 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 2170202.16) a predicciones anormalmente bajas
2025-06-01 15:44:41.632 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 500.0
2025-06-01 15:44:41.632 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 15:44:41.633 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.0002303932828908728
2025-06-01 15:44:41.633 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 8680808.64) a predicciones anormalmente bajas
2025-06-01 15:44:41.633 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 2000.0
2025-06-01 15:44:41.634 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 15:44:41.636 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 15:44:41.640 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 15:44:41.641 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 15:44:41.641 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 15:44:44.015 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 15:44:44.016 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.0001905406970763579
2025-06-01 15:44:44.017 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 524822.26) a predicciones por producto
2025-06-01 15:44:44.018 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 15:44:44.018 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 15:44:44.024 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 15:44:45.287 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00022615752095589414
2025-06-01 15:44:45.287 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 663254.53) a predicciones anormalmente bajas
2025-06-01 15:44:45.288 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 15:44:45.288 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 15:44:45.291 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 15:44:45.292 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 15:44:45.467 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 15:44:45.468 | WARNING  | __main__:main:828 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:44:45.468 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 15:44:45.470 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 15:44:45.561 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 15:44:45.563 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 15:44:45.571 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 15:44:47.211 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.64 segundos
2025-06-01 15:44:47.212 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 15:44:47.214 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 15:44:47.828 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 15:44:47.828 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 15:44:47.837 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 15:44:47.838 | ERROR    | __main__:run_ml_segmentation:761 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 15:44:47.839 | WARNING  | __main__:main:840 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:44:47.839 | INFO     | __main__:main:842 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 15:44:47.840 | INFO     | __main__:main:844 - Todos los tenants procesados correctamente
2025-06-01 15:44:47.840 | INFO     | __main__:main:848 - Iniciando servidor GraphQL para pruebas...
2025-06-01 15:44:47.841 | INFO     | __main__:main:876 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 15:44:47.842 | INFO     | __main__:main:877 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 15:44:47.842 | INFO     | __main__:main:878 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 15:44:47.843 | INFO     | __main__:main:879 - Presiona Ctrl+C para terminar.
2025-06-01 15:44:48.062 | ERROR    | __main__:run_server:865 - No se pudo importar el servidor. Verificar que exista api/server.py o server.py
2025-06-01 15:45:13.468 | INFO     | __main__:main:885 - Programa interrumpido por el usuario
2025-06-01 15:45:13.469 | INFO     | __main__:main:892 - Servicio finalizado. Cerrando conexiones...
2025-06-01 15:45:13.471 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 15:45:13.475 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 15:55:01.932 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 15:55:01.932 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 15:55:02.216 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 15:55:02.217 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 15:55:05.657 | INFO     | __main__:main:773 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 15:55:05.658 | INFO     | __main__:main:774 - Modo desarrollo: True
2025-06-01 15:55:05.658 | INFO     | __main__:main:775 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 15:55:05
2025-06-01 15:55:05.659 | INFO     | __main__:main:776 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 15:55:05.659 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 15:55:05.660 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 15:55:05.662 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 15:55:05.663 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 15:55:05.664 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 15:55:05.665 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 15:55:05.667 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 15:55:05.668 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 15:55:05.670 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 15:55:05.671 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 15:55:05.673 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 15:55:05.674 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:55:05.675 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 15:55:05.676 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 15:55:05.676 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 15:55:05.678 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 15:55:05.678 | INFO     | __main__:main:813 - ======= PROCESANDO TENANT 1 =======
2025-06-01 15:55:05.678 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 15:55:05.679 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 15:55:05.679 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 15:55:05.682 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 15:55:05.683 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 15:55:05.690 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 15:55:05.691 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 15:55:05.694 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 15:55:05.695 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 15:55:05.696 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 15:55:05.711 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 15:55:05.713 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 15:55:05.714 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 15:55:05.714 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 15:55:05.716 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 15:55:05.717 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 15:55:05.718 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 15:55:05.719 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 15:55:05.720 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 15:55:05.722 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 15:55:05.723 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 15:55:05.724 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 15:55:05.725 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 15:55:05.726 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 15:55:05.727 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 15:55:05.727 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 15:55:05.728 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 15:55:27.171 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 21.44 segundos
2025-06-01 15:55:27.172 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 15:55:27.223 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 15:55:27.224 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 15:57:58.932 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 151.71 segundos
2025-06-01 15:57:58.932 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 15:57:59.160 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 15:57:59.160 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 15:57:59.707 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 15:57:59.707 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 15:57:59.848 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 15:57:59.848 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 15:57:59.991 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 15:58:00.168 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 7.832127448637038e-05
2025-06-01 15:58:00.169 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 15:58:00.169 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 15:58:00.170 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 1570.2828124958612
2025-06-01 15:58:00.170 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 15:58:00.170 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 7.832127448637038e-05
2025-06-01 15:58:00.171 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 5000000.00) a predicciones anormalmente bajas
2025-06-01 15:58:00.171 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 391.6063724318519
2025-06-01 15:58:00.171 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 15:58:00.171 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 7.832127448637038e-05
2025-06-01 15:58:00.172 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20000000.00) a predicciones anormalmente bajas
2025-06-01 15:58:00.172 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 1566.4254897274077
2025-06-01 15:58:00.172 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 15:58:00.173 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 15:58:00.176 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 15:58:00.177 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 15:58:00.177 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 15:58:02.735 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 15:58:02.736 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.00016714840603526682
2025-06-01 15:58:02.736 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 598270.74) a predicciones por producto
2025-06-01 15:58:02.737 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 99.99999999999999
2025-06-01 15:58:02.738 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 15:58:02.744 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 15:58:03.899 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00016902521019801497
2025-06-01 15:58:03.899 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 887441.58) a predicciones anormalmente bajas
2025-06-01 15:58:03.900 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 15:58:03.901 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 15:58:03.903 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 15:58:03.904 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 15:58:04.074 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 15:58:04.075 | WARNING  | __main__:main:828 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:58:04.075 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 15:58:04.076 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 15:58:04.167 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 15:58:04.168 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 15:58:04.178 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 15:58:05.779 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.6 segundos
2025-06-01 15:58:05.780 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 15:58:05.781 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 15:58:06.380 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 15:58:06.380 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 15:58:06.388 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 15:58:06.390 | ERROR    | __main__:run_ml_segmentation:761 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 15:58:06.390 | WARNING  | __main__:main:840 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 15:58:06.391 | INFO     | __main__:main:842 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 15:58:06.391 | INFO     | __main__:main:844 - Todos los tenants procesados correctamente
2025-06-01 15:58:06.391 | INFO     | __main__:main:848 - Iniciando servidor GraphQL para pruebas...
2025-06-01 15:58:06.392 | INFO     | __main__:main:876 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 15:58:06.393 | INFO     | __main__:main:877 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 15:58:06.394 | INFO     | __main__:main:878 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 15:58:06.395 | INFO     | __main__:main:879 - Presiona Ctrl+C para terminar.
2025-06-01 15:58:06.592 | ERROR    | __main__:run_server:865 - No se pudo importar el servidor. Verificar que exista api/server.py o server.py
2025-06-01 15:59:35.730 | INFO     | __main__:main:885 - Programa interrumpido por el usuario
2025-06-01 15:59:35.732 | INFO     | __main__:main:892 - Servicio finalizado. Cerrando conexiones...
2025-06-01 15:59:35.734 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 15:59:35.740 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 16:11:22.204 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 16:11:22.205 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 16:11:22.482 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 16:11:22.483 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 16:11:26.357 | INFO     | __main__:main:1025 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 16:11:26.358 | INFO     | __main__:main:1026 - Modo desarrollo: True
2025-06-01 16:11:26.358 | INFO     | __main__:main:1027 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 16:11:26
2025-06-01 16:11:26.359 | INFO     | __main__:main:1028 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 16:11:26.359 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 16:11:26.360 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 16:11:26.362 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 16:11:26.362 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 16:11:26.364 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 16:11:26.365 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 16:11:26.366 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 16:11:26.366 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 16:11:26.367 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 16:11:26.368 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 16:11:26.369 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 16:11:26.369 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 16:11:26.370 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 16:11:26.371 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 16:11:26.371 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 16:11:26.372 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 16:11:26.372 | INFO     | __main__:main:1068 - ======= PROCESANDO TENANT 1 =======
2025-06-01 16:11:26.373 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 16:11:26.373 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 16:11:26.374 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 16:11:26.378 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 16:11:26.379 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 16:11:26.386 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 16:11:26.388 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 16:11:26.389 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 16:11:26.391 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 16:11:26.392 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 16:11:26.406 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 16:11:26.408 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 16:11:26.409 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 16:11:26.410 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 16:11:26.412 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 16:11:26.413 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 16:11:26.415 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 16:11:26.417 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 16:11:26.418 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 16:11:26.420 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 16:11:26.422 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 16:11:26.422 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 16:11:26.424 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 16:11:26.426 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 16:11:26.426 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 16:11:26.427 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 16:11:26.428 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 16:11:48.395 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 21.97 segundos
2025-06-01 16:11:48.396 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 16:11:48.452 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 16:11:48.453 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 16:14:43.003 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 174.55 segundos
2025-06-01 16:14:43.003 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 16:14:43.221 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 16:14:43.221 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 16:14:43.804 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 16:14:43.805 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 16:14:43.952 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 16:14:43.952 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 16:14:44.099 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 16:14:44.285 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 7.951503357617185e-05
2025-06-01 16:14:44.286 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 16:14:44.286 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 16:14:44.287 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 1594.2167869270631
2025-06-01 16:14:44.287 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 16:14:44.287 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.0001635451062611537
2025-06-01 16:14:44.288 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 3057260.54) a predicciones anormalmente bajas
2025-06-01 16:14:44.288 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 500.0
2025-06-01 16:14:44.288 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 16:14:44.289 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.0001635451062611537
2025-06-01 16:14:44.289 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 12229042.16) a predicciones anormalmente bajas
2025-06-01 16:14:44.289 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 2000.0
2025-06-01 16:14:44.289 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 16:14:44.290 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 16:14:44.293 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 16:14:44.294 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 16:14:44.295 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 16:14:46.898 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 16:14:46.899 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.00015172567509580404
2025-06-01 16:14:46.899 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 659084.23) a predicciones por producto
2025-06-01 16:14:46.900 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 16:14:46.901 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 16:14:46.907 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 16:14:48.024 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00015172567509580404
2025-06-01 16:14:48.024 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 988626.35) a predicciones anormalmente bajas
2025-06-01 16:14:48.025 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 16:14:48.025 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 16:14:48.027 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 16:14:48.028 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 16:14:48.328 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 16:14:48.329 | WARNING  | __main__:main:1083 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 16:14:48.329 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 16:14:48.330 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 16:14:48.422 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 16:14:48.422 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 16:14:48.432 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 16:14:50.109 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.68 segundos
2025-06-01 16:14:50.110 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 16:14:50.110 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 16:14:50.738 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 16:14:50.739 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 16:14:50.748 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 16:14:50.750 | ERROR    | __main__:run_ml_segmentation:783 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 16:14:50.750 | WARNING  | __main__:main:1095 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 16:14:50.751 | INFO     | __main__:main:1097 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 16:14:50.751 | INFO     | __main__:main:1099 - Todos los tenants procesados correctamente
2025-06-01 16:14:50.751 | INFO     | __main__:main:1103 - Iniciando servidor GraphQL para pruebas...
2025-06-01 16:14:50.752 | INFO     | __main__:main:1131 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 16:14:50.752 | INFO     | __main__:main:1132 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 16:14:50.753 | INFO     | __main__:main:1133 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 16:14:50.754 | INFO     | __main__:main:1134 - Presiona Ctrl+C para terminar.
2025-06-01 16:14:50.964 | ERROR    | __main__:run_server:1120 - No se pudo importar el servidor. Verificar que exista api/server.py o server.py
2025-06-01 16:17:01.926 | INFO     | __main__:main:1140 - Programa interrumpido por el usuario
2025-06-01 16:17:01.927 | INFO     | __main__:main:1147 - Servicio finalizado. Cerrando conexiones...
2025-06-01 16:17:01.929 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 16:17:01.935 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 18:01:15.045 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 18:01:15.046 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 18:01:15.315 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 18:01:15.316 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 18:01:18.875 | INFO     | __main__:main:1025 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 18:01:18.876 | INFO     | __main__:main:1026 - Modo desarrollo: True
2025-06-01 18:01:18.876 | INFO     | __main__:main:1027 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 18:01:18
2025-06-01 18:01:18.877 | INFO     | __main__:main:1028 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 18:01:18.877 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 18:01:18.878 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 18:01:18.880 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 18:01:18.880 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 18:01:18.881 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 18:01:18.882 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 18:01:18.884 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 18:01:18.886 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 18:01:18.887 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 18:01:18.887 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 18:01:18.889 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 18:01:18.890 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:01:18.891 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:01:18.892 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 18:01:18.893 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 18:01:18.893 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 18:01:18.894 | INFO     | __main__:main:1068 - ======= PROCESANDO TENANT 1 =======
2025-06-01 18:01:18.894 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 18:01:18.895 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 18:01:18.896 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 18:01:18.899 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 18:01:18.900 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 18:01:18.906 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 18:01:18.908 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 18:01:18.910 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 18:01:18.912 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 18:01:18.913 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 18:01:18.927 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 18:01:18.930 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 18:01:18.931 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 18:01:18.932 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 18:01:18.933 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 18:01:18.934 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 18:01:18.935 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 18:01:18.936 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 18:01:18.937 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 18:01:18.938 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 18:01:18.939 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 18:01:18.940 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 18:01:18.942 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 18:01:18.943 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 18:01:18.943 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 18:01:18.944 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 18:01:18.944 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 18:01:40.050 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 21.1 segundos
2025-06-01 18:01:40.051 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 18:01:40.117 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 18:01:40.119 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 18:04:37.408 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 177.28 segundos
2025-06-01 18:04:37.408 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 18:04:37.652 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 18:04:37.653 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 18:04:38.223 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 18:04:38.224 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 18:04:38.371 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 18:04:38.371 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 18:04:38.524 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 18:04:38.724 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 1.3041444617556408e-05
2025-06-01 18:04:38.725 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 18:04:38.726 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 18:04:38.726 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 261.47118349854276
2025-06-01 18:04:38.727 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 18:04:38.727 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 2.4482324079144746e-05
2025-06-01 18:04:38.727 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 5000000.00) a predicciones anormalmente bajas
2025-06-01 18:04:38.728 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 122.41162039572373
2025-06-01 18:04:38.728 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 18:04:38.729 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 2.4482324079144746e-05
2025-06-01 18:04:38.729 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20000000.00) a predicciones anormalmente bajas
2025-06-01 18:04:38.730 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 489.6464815828949
2025-06-01 18:04:38.730 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 18:04:38.732 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 18:04:38.737 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 18:04:38.739 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 18:04:38.739 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 18:04:41.575 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 18:04:41.576 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.00020991871133446693
2025-06-01 18:04:41.576 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 476374.88) a predicciones por producto
2025-06-01 18:04:41.578 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 18:04:41.578 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 18:04:41.586 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 18:04:42.786 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00020991871133446693
2025-06-01 18:04:42.787 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 714562.31) a predicciones anormalmente bajas
2025-06-01 18:04:42.787 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 18:04:42.788 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 18:04:42.791 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 18:04:42.792 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 18:04:42.980 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 18:04:42.981 | WARNING  | __main__:main:1083 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:04:42.981 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 18:04:42.982 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 18:04:43.082 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 18:04:43.083 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 18:04:43.093 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 18:04:45.095 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 2.0 segundos
2025-06-01 18:04:45.096 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 18:04:45.097 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 18:04:45.742 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 18:04:45.743 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 18:04:45.751 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 18:04:45.754 | ERROR    | __main__:run_ml_segmentation:783 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 18:04:45.754 | WARNING  | __main__:main:1095 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:04:45.755 | INFO     | __main__:main:1097 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 18:04:45.755 | INFO     | __main__:main:1099 - Todos los tenants procesados correctamente
2025-06-01 18:04:45.755 | INFO     | __main__:main:1103 - Iniciando servidor GraphQL para pruebas...
2025-06-01 18:04:45.756 | INFO     | __main__:main:1131 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 18:04:45.757 | INFO     | __main__:main:1132 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 18:04:45.757 | INFO     | __main__:main:1133 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 18:04:45.757 | INFO     | __main__:main:1134 - Presiona Ctrl+C para terminar.
2025-06-01 18:04:45.972 | ERROR    | __main__:run_server:1120 - No se pudo importar el servidor. Verificar que exista api/server.py o server.py
2025-06-01 18:11:57.354 | INFO     | __main__:main:1140 - Programa interrumpido por el usuario
2025-06-01 18:11:57.355 | INFO     | __main__:main:1147 - Servicio finalizado. Cerrando conexiones...
2025-06-01 18:11:57.356 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 18:11:57.362 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 18:12:01.616 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 18:12:01.618 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 18:12:01.939 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 18:12:01.939 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 18:12:05.890 | INFO     | __main__:main:1025 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 18:12:05.891 | INFO     | __main__:main:1026 - Modo desarrollo: True
2025-06-01 18:12:05.891 | INFO     | __main__:main:1027 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 18:12:05
2025-06-01 18:12:05.892 | INFO     | __main__:main:1028 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 18:12:05.892 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 18:12:05.893 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 18:12:05.895 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 18:12:05.895 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 18:12:05.896 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 18:12:05.897 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 18:12:05.898 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 18:12:05.899 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 18:12:05.900 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 18:12:05.901 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 18:12:05.902 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 18:12:05.903 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:12:05.903 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:12:05.904 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 18:12:05.906 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 18:12:05.906 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 18:12:05.907 | INFO     | __main__:main:1068 - ======= PROCESANDO TENANT 1 =======
2025-06-01 18:12:05.907 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 18:12:05.908 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 18:12:05.909 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 18:12:05.912 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 18:12:05.913 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 18:12:05.920 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 18:12:05.921 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 18:12:05.923 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 18:12:05.924 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 18:12:05.926 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 18:12:05.940 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 18:12:05.942 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 18:12:05.943 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 18:12:05.944 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 18:12:05.946 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 18:12:05.947 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 18:12:05.949 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 18:12:05.950 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 18:12:05.950 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 18:12:05.952 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 18:12:05.954 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 18:12:05.954 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 18:12:05.956 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 18:12:05.958 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 18:12:05.959 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 18:12:05.959 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 18:12:05.960 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 18:12:35.829 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 29.87 segundos
2025-06-01 18:12:35.830 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 18:12:35.879 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 18:12:35.880 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 18:15:28.521 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 172.64 segundos
2025-06-01 18:15:28.522 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 18:15:28.766 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 18:15:28.766 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 18:15:29.365 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 18:15:29.366 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 18:15:29.540 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 18:15:29.540 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 18:15:29.700 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 18:15:29.900 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 1.5503492249990813e-05
2025-06-01 18:15:29.900 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 18:15:29.901 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 18:15:29.901 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 310.83339199312826
2025-06-01 18:15:29.902 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 18:15:29.902 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 2.879050998672028e-05
2025-06-01 18:15:29.902 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 5000000.00) a predicciones anormalmente bajas
2025-06-01 18:15:29.902 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 143.9525499336014
2025-06-01 18:15:29.903 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 18:15:29.903 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 2.879050998672028e-05
2025-06-01 18:15:29.904 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20000000.00) a predicciones anormalmente bajas
2025-06-01 18:15:29.904 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 575.8101997344056
2025-06-01 18:15:29.905 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 18:15:29.906 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 18:15:29.910 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 18:15:29.912 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 18:15:29.912 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 18:15:32.801 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 18:15:32.802 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.00015561962209176272
2025-06-01 18:15:32.803 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 642592.49) a predicciones por producto
2025-06-01 18:15:32.803 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 18:15:32.804 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 18:15:32.813 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 18:15:34.077 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00022305132006295025
2025-06-01 18:15:34.077 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 672490.98) a predicciones anormalmente bajas
2025-06-01 18:15:34.078 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 18:15:34.078 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 18:15:34.082 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 18:15:34.083 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 18:15:34.268 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 18:15:34.268 | WARNING  | __main__:main:1083 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:15:34.269 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 18:15:34.270 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 18:15:34.368 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 18:15:34.369 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 18:15:34.378 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 18:15:36.274 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.89 segundos
2025-06-01 18:15:36.275 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 18:15:36.276 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 18:15:36.919 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 18:15:36.919 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 18:15:36.928 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 18:15:36.930 | ERROR    | __main__:run_ml_segmentation:783 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 18:15:36.931 | WARNING  | __main__:main:1095 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:15:36.931 | INFO     | __main__:main:1097 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 18:15:36.932 | INFO     | __main__:main:1099 - Todos los tenants procesados correctamente
2025-06-01 18:15:36.933 | INFO     | __main__:main:1103 - Iniciando servidor GraphQL para pruebas...
2025-06-01 18:15:36.934 | INFO     | __main__:main:1131 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 18:15:36.935 | INFO     | __main__:main:1132 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 18:15:36.936 | INFO     | __main__:main:1133 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 18:15:36.936 | INFO     | __main__:main:1134 - Presiona Ctrl+C para terminar.
2025-06-01 18:15:37.166 | ERROR    | __main__:run_server:1120 - No se pudo importar el servidor. Verificar que exista api/server.py o server.py
2025-06-01 18:15:59.810 | INFO     | __main__:main:1140 - Programa interrumpido por el usuario
2025-06-01 18:15:59.810 | INFO     | __main__:main:1147 - Servicio finalizado. Cerrando conexiones...
2025-06-01 18:15:59.811 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 18:15:59.826 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 18:16:12.084 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 18:16:12.084 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 18:26:02.878 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 18:26:02.878 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 18:26:03.168 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 18:26:03.169 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 18:26:06.812 | INFO     | __main__:main:1025 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 18:26:06.813 | INFO     | __main__:main:1026 - Modo desarrollo: True
2025-06-01 18:26:06.814 | INFO     | __main__:main:1027 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 18:26:06
2025-06-01 18:26:06.814 | INFO     | __main__:main:1028 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 18:26:06.815 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 18:26:06.816 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 18:26:06.818 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 18:26:06.819 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 18:26:06.820 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 18:26:06.821 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 18:26:06.822 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 18:26:06.823 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 18:26:06.824 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 18:26:06.825 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 18:26:06.826 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 18:26:06.827 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:26:06.828 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:26:06.829 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 18:26:06.830 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 18:26:06.830 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 18:26:06.831 | INFO     | __main__:main:1068 - ======= PROCESANDO TENANT 1 =======
2025-06-01 18:26:06.831 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 18:26:06.832 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 18:26:06.833 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 18:26:06.837 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 18:26:06.839 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 18:26:06.846 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 18:26:06.848 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 18:26:06.850 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 18:26:06.852 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 18:26:06.854 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 18:26:06.868 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 18:26:06.869 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 18:26:06.872 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 18:26:06.873 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 18:26:06.875 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 18:26:06.876 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 18:26:06.878 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 18:26:06.880 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 18:26:06.880 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 18:26:06.882 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 18:26:06.884 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 18:26:06.885 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 18:26:06.886 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 18:26:06.890 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 18:26:06.891 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 18:26:06.892 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 18:26:06.893 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 18:26:24.706 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 17.81 segundos
2025-06-01 18:26:24.707 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 18:26:24.737 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 18:26:24.737 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 18:29:16.347 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 171.61 segundos
2025-06-01 18:29:16.348 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 18:29:16.578 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 18:29:16.579 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 18:29:17.160 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 18:29:17.160 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 18:29:17.305 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 18:29:17.305 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 18:29:17.449 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 18:29:17.627 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 4.7601199185010046e-05
2025-06-01 18:29:17.628 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 18:29:17.628 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 18:29:17.628 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 954.3683427600624
2025-06-01 18:29:17.629 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 18:29:17.629 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.0001461789711356687
2025-06-01 18:29:17.630 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 3420464.63) a predicciones anormalmente bajas
2025-06-01 18:29:17.630 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 500.00000000000006
2025-06-01 18:29:17.630 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 18:29:17.632 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.0001461789711356687
2025-06-01 18:29:17.632 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 13681858.51) a predicciones anormalmente bajas
2025-06-01 18:29:17.632 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 2000.0000000000002
2025-06-01 18:29:17.632 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 18:29:17.632 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 18:29:17.636 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 18:29:17.637 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 18:29:17.638 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 18:29:20.346 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 18:29:20.347 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 0.00010932522127404809
2025-06-01 18:29:20.348 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 914702.01) a predicciones por producto
2025-06-01 18:29:20.349 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-01 18:29:20.349 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 18:29:20.356 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 18:29:21.549 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00019240913388784975
2025-06-01 18:29:21.549 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 779588.77) a predicciones anormalmente bajas
2025-06-01 18:29:21.550 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-01 18:29:21.550 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 18:29:21.553 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 18:29:21.554 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 18:29:21.749 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 18:29:21.750 | WARNING  | __main__:main:1083 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:29:21.750 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 18:29:21.751 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 18:29:21.854 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 18:29:21.854 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 18:29:21.866 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 18:29:23.490 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.62 segundos
2025-06-01 18:29:23.491 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 18:29:23.491 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 18:29:24.109 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 18:29:24.109 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 18:29:24.117 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 18:29:24.119 | ERROR    | __main__:run_ml_segmentation:783 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 18:29:24.120 | WARNING  | __main__:main:1095 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:29:24.120 | INFO     | __main__:main:1097 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 18:29:24.120 | INFO     | __main__:main:1099 - Todos los tenants procesados correctamente
2025-06-01 18:29:24.121 | INFO     | __main__:main:1103 - Iniciando servidor GraphQL para pruebas...
2025-06-01 18:29:24.122 | INFO     | __main__:main:1131 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 18:29:24.122 | INFO     | __main__:main:1132 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 18:29:24.123 | INFO     | __main__:main:1133 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 18:29:24.123 | INFO     | __main__:main:1134 - Presiona Ctrl+C para terminar.
2025-06-01 18:29:24.350 | INFO     | __main__:run_server:1114 - Servidor importado desde api.server
2025-06-01 18:33:08.912 | INFO     | __main__:main:1140 - Programa interrumpido por el usuario
2025-06-01 18:33:08.912 | INFO     | __main__:main:1147 - Servicio finalizado. Cerrando conexiones...
2025-06-01 18:33:08.913 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 18:33:08.914 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-01 18:35:06.117 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 18:35:06.117 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.02 segundos
2025-06-01 18:35:06.399 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 18:35:06.400 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 18:35:13.601 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-01 18:35:13.602 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-01 18:35:13.894 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-01 18:35:13.894 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-01 18:35:17.540 | INFO     | __main__:main:1025 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-01 18:35:17.540 | INFO     | __main__:main:1026 - Modo desarrollo: True
2025-06-01 18:35:17.541 | INFO     | __main__:main:1027 - Sistema multi-tenant activado - Fecha actual: 2025-06-01 18:35:17
2025-06-01 18:35:17.541 | INFO     | __main__:main:1028 - Fecha actual como punto pivote: 2025-06-01 00:00:00
2025-06-01 18:35:17.542 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-01 18:35:17.543 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-01 18:35:17.545 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-01 18:35:17.546 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-01 18:35:17.548 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-01 18:35:17.549 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-01 18:35:17.550 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-01 18:35:17.551 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-01 18:35:17.552 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-01 18:35:17.553 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-01 18:35:17.554 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-01 18:35:17.554 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:35:17.554 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-01 18:35:17.555 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-01 18:35:17.556 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-01 18:35:17.556 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-01 18:35:17.557 | INFO     | __main__:main:1068 - ======= PROCESANDO TENANT 1 =======
2025-06-01 18:35:17.557 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-01 00:00:00...
2025-06-01 18:35:17.558 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-01 18:35:17.560 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-01 18:35:17.564 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-01 18:35:17.566 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-01 18:35:17.572 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-01 18:35:17.572 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-01 18:35:17.575 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-01 18:35:17.575 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-01 18:35:17.576 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-01 18:35:17.591 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-01 18:35:17.593 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-01 18:35:17.595 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-01 18:35:17.596 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-01 18:35:17.598 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-01 18:35:17.600 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-01 18:35:17.601 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-01 18:35:17.602 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-01 18:35:17.603 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-01 18:35:17.605 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-01 18:35:17.606 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-01 18:35:17.607 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-01 18:35:17.608 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 0 documentos para tenant 1
2025-06-01 18:35:17.610 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 0 documentos para tenant 1
2025-06-01 18:35:17.611 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-01 18:35:17.611 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-01 18:35:17.613 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-01 18:35:41.371 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 23.76 segundos
2025-06-01 18:35:41.372 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-01 18:35:41.427 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-01 18:35:41.428 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-01 18:39:05.805 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 204.38 segundos
2025-06-01 18:39:05.806 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-01 18:39:06.042 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-01 18:39:06.043 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-01 00:00:00)...
2025-06-01 18:39:06.627 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-01 18:39:06.627 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-01 18:39:06.783 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-01 18:39:06.784 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-01 18:39:06.942 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-01 18:39:07.135 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 7.244776497827843e-05
2025-06-01 18:39:07.136 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 2004.9249999999997
2025-06-01 18:39:07.137 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 20049250.00) a predicciones anormalmente bajas
2025-06-01 18:39:07.137 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 1452.5233519907486
2025-06-01 18:39:07.139 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-01 18:39:07.139 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00014745616863365285
2025-06-01 18:39:07.139 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 3390838.14) a predicciones anormalmente bajas
2025-06-01 18:39:07.140 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 500.0
2025-06-01 18:39:07.140 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-01 18:39:07.140 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00014745616863365285
2025-06-01 18:39:07.141 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 13563352.54) a predicciones anormalmente bajas
2025-06-01 18:39:07.141 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 2000.0
2025-06-01 18:39:07.141 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-01 18:39:07.142 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-01 18:39:07.146 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-01 18:39:07.147 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-01 18:39:07.147 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-01 18:39:10.016 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-01 18:39:10.018 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 6.416191172320396e-05
2025-06-01 18:39:10.018 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 1000000.00) a predicciones por producto
2025-06-01 18:39:10.019 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 64.16191172320396
2025-06-01 18:39:10.020 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-01 18:39:10.027 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-01 18:39:11.696 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 9.618369585950859e-05
2025-06-01 18:39:11.697 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 1500000.00) a predicciones anormalmente bajas
2025-06-01 18:39:11.698 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 144.27554378926288
2025-06-01 18:39:11.699 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-01 18:39:11.704 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-01 18:39:11.705 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-01 18:39:11.962 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-01 18:39:11.964 | WARNING  | __main__:main:1083 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:39:11.965 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-01 18:39:11.966 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-01 18:39:12.093 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-01 18:39:12.093 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-01 18:39:12.106 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-01 18:39:13.769 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.66 segundos
2025-06-01 18:39:13.770 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-01 18:39:13.771 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-01 18:39:14.454 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-01 18:39:14.455 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-01 18:39:14.466 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-01 18:39:14.468 | ERROR    | __main__:run_ml_segmentation:783 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-01 18:39:14.469 | WARNING  | __main__:main:1095 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-01 18:39:14.469 | INFO     | __main__:main:1097 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-01 18:39:14.469 | INFO     | __main__:main:1099 - Todos los tenants procesados correctamente
2025-06-01 18:39:14.470 | INFO     | __main__:main:1103 - Iniciando servidor GraphQL para pruebas...
2025-06-01 18:39:14.471 | INFO     | __main__:main:1131 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-01 18:39:14.471 | INFO     | __main__:main:1132 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-01 18:39:14.472 | INFO     | __main__:main:1133 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-01 18:39:14.472 | INFO     | __main__:main:1134 - Presiona Ctrl+C para terminar.
2025-06-01 18:39:14.728 | INFO     | __main__:run_server:1114 - Servidor importado desde api.server
2025-06-01 18:42:48.249 | INFO     | __main__:main:1140 - Programa interrumpido por el usuario
2025-06-01 18:42:48.249 | INFO     | __main__:main:1147 - Servicio finalizado. Cerrando conexiones...
2025-06-01 18:42:48.251 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-01 18:42:48.252 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-02 17:32:15.809 | ERROR    | db.mongo_client:_connect:37 - No se pudo conectar a MongoDB: localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms), Timeout: 5.0s, Topology Description: <TopologyDescription id: 683e185ae98498f490528fec, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No se puede establecer una conexión ya que el equipo de destino denegó expresamente dicha conexión (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')>]>
2025-06-02 17:32:57.148 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-02 17:32:57.149 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-02 17:32:58.195 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-02 17:32:58.196 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.23 segundos
2025-06-02 17:33:17.268 | INFO     | __main__:main:1025 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-02 17:33:17.268 | INFO     | __main__:main:1026 - Modo desarrollo: True
2025-06-02 17:33:17.269 | INFO     | __main__:main:1027 - Sistema multi-tenant activado - Fecha actual: 2025-06-02 17:33:17
2025-06-02 17:33:17.269 | INFO     | __main__:main:1028 - Fecha actual como punto pivote: 2025-06-02 00:00:00
2025-06-02 17:33:17.270 | INFO     | __main__:test_connections:102 - Probando conexiones a bases de datos...
2025-06-02 17:33:17.271 | INFO     | __main__:test_connections:109 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-02 17:33:17.275 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-02 17:33:17.275 | INFO     | __main__:test_connections:118 - Conexión a PostgreSQL funciona correctamente
2025-06-02 17:33:17.277 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-02 17:33:17.278 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-02 17:33:17.279 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-02 17:33:17.280 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-02 17:33:17.282 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-02 17:33:17.284 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-02 17:33:17.285 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-02 17:33:17.286 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-02 17:33:17.289 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-02 17:33:17.290 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-02 17:33:17.292 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-02 17:33:17.292 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-02 17:33:17.293 | INFO     | __main__:main:1068 - ======= PROCESANDO TENANT 1 =======
2025-06-02 17:33:17.294 | INFO     | __main__:run_ml_forecast:197 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-02 00:00:00...
2025-06-02 17:33:17.295 | INFO     | __main__:diagnosticar_datos_disponibles:34 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-02 17:33:17.297 | INFO     | __main__:diagnosticar_datos_disponibles:38 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-02 17:33:17.302 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-02 17:33:17.306 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-02 17:33:17.322 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-02 17:33:17.325 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-02 17:33:17.330 | INFO     | __main__:diagnosticar_datos_disponibles:44 - Colección raw_productos: 31 documentos para tenant 1
2025-06-02 17:33:17.332 | INFO     | __main__:diagnosticar_datos_disponibles:49 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-02 17:33:17.335 | INFO     | __main__:diagnosticar_datos_disponibles:55 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-02 17:33:17.366 | INFO     | __main__:diagnosticar_datos_disponibles:67 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-02 17:33:17.368 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-02 17:33:17.370 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-02 17:33:17.370 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_ventas: 2025-06-02 00:00:00
2025-06-02 17:33:17.373 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-02 17:33:17.375 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-02 17:33:17.377 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-02 17:33:17.379 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-02 17:33:17.380 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en predicciones_productos: 2025-06-02 00:00:00
2025-06-02 17:33:17.382 | INFO     | __main__:diagnosticar_datos_disponibles:78 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-02 17:33:17.383 | INFO     | __main__:diagnosticar_datos_disponibles:83 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-02 17:33:17.384 | INFO     | __main__:diagnosticar_datos_disponibles:85 - Primera fecha en ml_predicciones_categoria: 2025-06-02 00:00:00
2025-06-02 17:33:17.386 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cliente_segmentacion: 166 documentos para tenant 1
2025-06-02 17:33:17.387 | INFO     | __main__:diagnosticar_datos_disponibles:96 - Ejemplo de cliente_segmentacion: ['_id', 'cliente_id', 'cluster', 'cluster_nombre', 'num_visitas', 'comensales_promedio', 'gasto_total', 'tenant_id', 'timestamp']
2025-06-02 17:33:17.390 | INFO     | __main__:diagnosticar_datos_disponibles:91 - Colección cluster_perfiles: 4 documentos para tenant 1
2025-06-02 17:33:17.392 | INFO     | __main__:diagnosticar_datos_disponibles:96 - Ejemplo de cluster_perfiles: ['_id', 'cluster_id', 'nombre', 'num_clientes', 'gasto_promedio', 'visitas_promedio', 'comensales_promedio', 'descripcion', 'tenant_id', 'timestamp']
2025-06-02 17:33:17.393 | INFO     | __main__:diagnosticar_datos_disponibles:98 - === FIN DEL DIAGNÓSTICO ===
2025-06-02 17:33:17.394 | INFO     | __main__:run_ml_forecast:247 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-02 17:33:17.397 | INFO     | __main__:run_ml_forecast:260 - Entrenando en CPU
2025-06-02 17:33:38.316 | INFO     | __main__:run_ml_forecast:268 - Entrenamiento del modelo general completado en 20.92 segundos
2025-06-02 17:33:38.317 | INFO     | __main__:run_ml_forecast:272 - Guardando modelo general entrenado para tenant 1...
2025-06-02 17:33:38.360 | INFO     | __main__:run_ml_forecast:275 - Modelo general guardado en models/forecast/tenant_1
2025-06-02 17:33:38.361 | INFO     | __main__:run_ml_forecast:294 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-02 17:36:51.582 | INFO     | __main__:run_ml_forecast:305 - Entrenamiento de 9/10 modelos de productos completado en 193.22 segundos
2025-06-02 17:36:51.583 | INFO     | __main__:run_ml_forecast:309 - Guardando modelos de productos entrenados para tenant 1...
2025-06-02 17:36:51.913 | INFO     | __main__:run_ml_forecast:312 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-02 17:36:51.914 | INFO     | __main__:run_ml_forecast:315 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-02 00:00:00)...
2025-06-02 17:36:52.618 | INFO     | __main__:run_ml_forecast:319 - Predicciones diarias generadas para los próximos 7 días
2025-06-02 17:36:52.618 | INFO     | __main__:run_ml_forecast:322 - Generando predicciones semanales para tenant 1...
2025-06-02 17:36:52.825 | INFO     | __main__:run_ml_forecast:324 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-02 17:36:52.825 | INFO     | __main__:run_ml_forecast:327 - Generando predicciones mensuales para tenant 1...
2025-06-02 17:36:53.001 | INFO     | __main__:run_ml_forecast:329 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-02 17:36:53.238 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 6.4747771830298e-05
2025-06-02 17:36:53.239 | INFO     | __main__:apply_scale_correction:370 - Valor promedio de ventas históricas: 1680.6584000000003
2025-06-02 17:36:53.240 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 16806584.00) a predicciones anormalmente bajas
2025-06-02 17:36:53.240 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 1088.1888660787372
2025-06-02 17:36:53.241 | INFO     | __main__:run_ml_forecast:400 - Corrección de escala aplicada a predicciones diarias
2025-06-02 17:36:53.241 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00012729339050565613
2025-06-02 17:36:53.242 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 3927933.71) a predicciones anormalmente bajas
2025-06-02 17:36:53.243 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 500.0
2025-06-02 17:36:53.245 | INFO     | __main__:run_ml_forecast:404 - Corrección de escala aplicada a predicciones semanales
2025-06-02 17:36:53.245 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00012729339050565613
2025-06-02 17:36:53.245 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 15711734.85) a predicciones anormalmente bajas
2025-06-02 17:36:53.247 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 2000.0
2025-06-02 17:36:53.248 | INFO     | __main__:run_ml_forecast:408 - Corrección de escala aplicada a predicciones mensuales
2025-06-02 17:36:53.248 | INFO     | __main__:run_ml_forecast:411 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-02 17:36:53.257 | INFO     | __main__:run_ml_forecast:446 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-02 17:36:53.259 | INFO     | __main__:run_ml_forecast:450 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-02 17:36:53.260 | INFO     | __main__:run_ml_forecast:456 - Generando predicciones por producto para tenant 1...
2025-06-02 17:36:56.426 | INFO     | __main__:run_ml_forecast:460 - Predicciones generadas para 9 productos
2025-06-02 17:36:56.428 | INFO     | __main__:apply_product_scale_correction:470 - Valor máximo de predicción por producto antes de corrección: 7.54914726712741e-05
2025-06-02 17:36:56.429 | WARNING  | __main__:apply_product_scale_correction:476 - Aplicando corrección de escala (factor: 1000000.00) a predicciones por producto
2025-06-02 17:36:56.429 | INFO     | __main__:apply_product_scale_correction:480 - Valor máximo de predicción por producto después de corrección: 75.4914726712741
2025-06-02 17:36:56.430 | INFO     | __main__:run_ml_forecast:488 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-02 17:36:56.442 | INFO     | __main__:run_ml_forecast:492 - Generando predicciones por categoría para tenant 1...
2025-06-02 17:36:57.887 | INFO     | __main__:apply_scale_correction:349 - Valor máximo de predicción antes de corrección: 0.00012616240928764455
2025-06-02 17:36:57.888 | WARNING  | __main__:apply_scale_correction:374 - Aplicando corrección de escala (factor: 1188943.69) a predicciones anormalmente bajas
2025-06-02 17:36:57.888 | INFO     | __main__:apply_scale_correction:382 - Valor máximo de predicción después de corrección: 150.0
2025-06-02 17:36:57.889 | INFO     | __main__:run_ml_forecast:500 - Predicciones generadas para 5 categorías
2025-06-02 17:36:57.892 | INFO     | __main__:run_ml_forecast:526 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-02 17:36:57.893 | INFO     | __main__:run_ml_forecast:540 - Generando visualización de predicciones generales para tenant 1...
2025-06-02 17:36:58.124 | ERROR    | __main__:run_ml_forecast:653 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-02 17:36:58.125 | WARNING  | __main__:main:1083 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 17:36:58.127 | INFO     | __main__:run_ml_segmentation:665 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-02 17:36:58.128 | INFO     | __main__:run_ml_segmentation:681 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-02 17:36:58.270 | INFO     | __main__:run_ml_segmentation:695 - Datos cargados: 167 clientes, 5000 cuenta mesas, 7449 pedidos
2025-06-02 17:36:58.271 | INFO     | __main__:run_ml_segmentation:698 - Preparando características para segmentación de clientes del tenant 1...
2025-06-02 17:36:58.297 | INFO     | __main__:run_ml_segmentation:702 - Ejecutando algoritmo K-means con 3 clusters...
2025-06-02 17:36:59.900 | INFO     | __main__:run_ml_segmentation:707 - Segmentación completada en 1.6 segundos
2025-06-02 17:36:59.902 | INFO     | __main__:run_ml_segmentation:708 - Distribución de clientes por segmento: {0: 99, 1: 67, 2: 1}
2025-06-02 17:36:59.903 | INFO     | __main__:run_ml_segmentation:712 - Generando visualizaciones para segmentación de clientes...
2025-06-02 17:37:01.610 | INFO     | __main__:run_ml_segmentation:714 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-02 17:37:01.611 | INFO     | __main__:run_ml_segmentation:717 - Guardando resultados de la segmentación...
2025-06-02 17:37:01.624 | INFO     | __main__:run_ml_segmentation:721 - Guardando resultados de segmentación en MongoDB...
2025-06-02 17:37:01.626 | ERROR    | __main__:run_ml_segmentation:783 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-02 17:37:01.627 | WARNING  | __main__:main:1095 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 17:37:01.628 | INFO     | __main__:main:1097 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-02 17:37:01.629 | INFO     | __main__:main:1099 - Todos los tenants procesados correctamente
2025-06-02 17:37:01.630 | INFO     | __main__:main:1103 - Iniciando servidor GraphQL para pruebas...
2025-06-02 17:37:01.631 | INFO     | __main__:main:1131 - Servidor GraphQL iniciado en http://localhost:5000/graphql
2025-06-02 17:37:01.632 | INFO     | __main__:main:1132 - API soporta visualización combinada (histórico + predicción) con fecha actual como punto pivote
2025-06-02 17:37:01.633 | INFO     | __main__:main:1133 - API soporta segmentación de clientes (K-means en 3 clusters)
2025-06-02 17:37:01.633 | INFO     | __main__:main:1134 - Presiona Ctrl+C para terminar.
2025-06-02 18:04:00.993 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-02 18:04:00.994 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.03 segundos
2025-06-02 18:04:01.271 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-02 18:04:01.272 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-02 18:04:04.993 | INFO     | __main__:main:1026 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-02 18:04:04.994 | INFO     | __main__:main:1027 - Modo desarrollo: True
2025-06-02 18:04:04.995 | INFO     | __main__:main:1028 - Sistema multi-tenant activado - Fecha actual: 2025-06-02 18:04:04
2025-06-02 18:04:04.995 | INFO     | __main__:main:1029 - Fecha actual como punto pivote: 2025-06-02 00:00:00
2025-06-02 18:04:04.996 | INFO     | __main__:test_connections:103 - Probando conexiones a bases de datos...
2025-06-02 18:04:04.998 | INFO     | __main__:test_connections:110 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-02 18:04:05.000 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-02 18:04:05.000 | INFO     | __main__:test_connections:119 - Conexión a PostgreSQL funciona correctamente
2025-06-02 18:04:05.002 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-02 18:04:05.003 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-02 18:04:05.005 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-02 18:04:05.007 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-02 18:04:05.008 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-02 18:04:05.009 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-02 18:04:05.010 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-02 18:04:05.012 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-02 18:04:05.013 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-02 18:04:05.014 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-02 18:04:05.015 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-02 18:04:05.016 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-02 18:04:05.017 | INFO     | __main__:main:1069 - ======= PROCESANDO TENANT 1 =======
2025-06-02 18:04:05.017 | INFO     | __main__:run_ml_forecast:198 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-02 00:00:00...
2025-06-02 18:04:05.018 | INFO     | __main__:diagnosticar_datos_disponibles:35 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-02 18:04:05.019 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-02 18:04:05.023 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-02 18:04:05.025 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-02 18:04:05.032 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-02 18:04:05.033 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-02 18:04:05.035 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_productos: 31 documentos para tenant 1
2025-06-02 18:04:05.037 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-02 18:04:05.038 | INFO     | __main__:diagnosticar_datos_disponibles:56 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-02 18:04:05.051 | INFO     | __main__:diagnosticar_datos_disponibles:68 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-02 18:04:05.054 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-02 18:04:05.055 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-02 18:04:05.056 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en predicciones_ventas: 2025-06-03 00:00:00
2025-06-02 18:04:05.057 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-02 18:04:05.059 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-02 18:04:05.061 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-02 18:04:05.064 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-02 18:04:05.065 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en predicciones_productos: 2025-06-03 00:00:00
2025-06-02 18:04:05.068 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-02 18:04:05.070 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-02 18:04:05.071 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en ml_predicciones_categoria: 2025-06-03 00:00:00
2025-06-02 18:04:05.073 | INFO     | __main__:diagnosticar_datos_disponibles:92 - Colección cliente_segmentacion: 166 documentos para tenant 1
2025-06-02 18:04:05.076 | INFO     | __main__:diagnosticar_datos_disponibles:97 - Ejemplo de cliente_segmentacion: ['_id', 'cliente_id', 'cluster', 'cluster_nombre', 'num_visitas', 'comensales_promedio', 'gasto_total', 'tenant_id', 'timestamp']
2025-06-02 18:04:05.078 | INFO     | __main__:diagnosticar_datos_disponibles:92 - Colección cluster_perfiles: 4 documentos para tenant 1
2025-06-02 18:04:05.080 | INFO     | __main__:diagnosticar_datos_disponibles:97 - Ejemplo de cluster_perfiles: ['_id', 'cluster_id', 'nombre', 'num_clientes', 'gasto_promedio', 'visitas_promedio', 'comensales_promedio', 'descripcion', 'tenant_id', 'timestamp']
2025-06-02 18:04:05.080 | INFO     | __main__:diagnosticar_datos_disponibles:99 - === FIN DEL DIAGNÓSTICO ===
2025-06-02 18:04:05.081 | INFO     | __main__:run_ml_forecast:248 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-02 18:04:05.083 | INFO     | __main__:run_ml_forecast:261 - Entrenando en CPU
2025-06-02 18:04:26.589 | INFO     | __main__:run_ml_forecast:269 - Entrenamiento del modelo general completado en 21.51 segundos
2025-06-02 18:04:26.590 | INFO     | __main__:run_ml_forecast:273 - Guardando modelo general entrenado para tenant 1...
2025-06-02 18:04:26.635 | INFO     | __main__:run_ml_forecast:276 - Modelo general guardado en models/forecast/tenant_1
2025-06-02 18:04:26.636 | INFO     | __main__:run_ml_forecast:295 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-02 18:07:20.478 | INFO     | __main__:run_ml_forecast:306 - Entrenamiento de 9/10 modelos de productos completado en 173.84 segundos
2025-06-02 18:07:20.479 | INFO     | __main__:run_ml_forecast:310 - Guardando modelos de productos entrenados para tenant 1...
2025-06-02 18:07:20.693 | INFO     | __main__:run_ml_forecast:313 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-02 18:07:20.694 | INFO     | __main__:run_ml_forecast:316 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-02 00:00:00)...
2025-06-02 18:07:21.241 | INFO     | __main__:run_ml_forecast:320 - Predicciones diarias generadas para los próximos 7 días
2025-06-02 18:07:21.241 | INFO     | __main__:run_ml_forecast:323 - Generando predicciones semanales para tenant 1...
2025-06-02 18:07:21.385 | INFO     | __main__:run_ml_forecast:325 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-02 18:07:21.386 | INFO     | __main__:run_ml_forecast:328 - Generando predicciones mensuales para tenant 1...
2025-06-02 18:07:21.524 | INFO     | __main__:run_ml_forecast:330 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-02 18:07:21.712 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 3.255396950407885e-05
2025-06-02 18:07:21.713 | INFO     | __main__:apply_scale_correction:371 - Valor promedio de ventas históricas: 1680.6584000000003
2025-06-02 18:07:21.714 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 16806584.00) a predicciones anormalmente bajas
2025-06-02 18:07:21.714 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 547.1210230037395
2025-06-02 18:07:21.714 | INFO     | __main__:run_ml_forecast:401 - Corrección de escala aplicada a predicciones diarias
2025-06-02 18:07:21.715 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 4.21415743403486e-05
2025-06-02 18:07:21.715 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 5000000.00) a predicciones anormalmente bajas
2025-06-02 18:07:21.716 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 210.707871701743
2025-06-02 18:07:21.716 | INFO     | __main__:run_ml_forecast:405 - Corrección de escala aplicada a predicciones semanales
2025-06-02 18:07:21.716 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 4.21415743403486e-05
2025-06-02 18:07:21.717 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 20000000.00) a predicciones anormalmente bajas
2025-06-02 18:07:21.717 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 842.831486806972
2025-06-02 18:07:21.718 | INFO     | __main__:run_ml_forecast:409 - Corrección de escala aplicada a predicciones mensuales
2025-06-02 18:07:21.718 | INFO     | __main__:run_ml_forecast:412 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-02 18:07:21.723 | INFO     | __main__:run_ml_forecast:447 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-02 18:07:21.725 | INFO     | __main__:run_ml_forecast:451 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-02 18:07:21.725 | INFO     | __main__:run_ml_forecast:457 - Generando predicciones por producto para tenant 1...
2025-06-02 18:07:24.290 | INFO     | __main__:run_ml_forecast:461 - Predicciones generadas para 9 productos
2025-06-02 18:07:24.291 | INFO     | __main__:apply_product_scale_correction:471 - Valor máximo de predicción por producto antes de corrección: 6.678570207441226e-05
2025-06-02 18:07:24.292 | WARNING  | __main__:apply_product_scale_correction:477 - Aplicando corrección de escala (factor: 1000000.00) a predicciones por producto
2025-06-02 18:07:24.292 | INFO     | __main__:apply_product_scale_correction:481 - Valor máximo de predicción por producto después de corrección: 66.78570207441226
2025-06-02 18:07:24.293 | INFO     | __main__:run_ml_forecast:489 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-02 18:07:24.299 | INFO     | __main__:run_ml_forecast:493 - Generando predicciones por categoría para tenant 1...
2025-06-02 18:07:25.446 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 8.705993604962714e-05
2025-06-02 18:07:25.447 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 1500000.00) a predicciones anormalmente bajas
2025-06-02 18:07:25.447 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 130.5899040744407
2025-06-02 18:07:25.447 | INFO     | __main__:run_ml_forecast:501 - Predicciones generadas para 5 categorías
2025-06-02 18:07:25.451 | INFO     | __main__:run_ml_forecast:527 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-02 18:07:25.452 | INFO     | __main__:run_ml_forecast:541 - Generando visualización de predicciones generales para tenant 1...
2025-06-02 18:07:25.621 | ERROR    | __main__:run_ml_forecast:654 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-02 18:07:25.622 | WARNING  | __main__:main:1084 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 18:07:25.622 | INFO     | __main__:run_ml_segmentation:666 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-02 18:07:25.623 | INFO     | __main__:run_ml_segmentation:682 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-02 18:07:25.714 | INFO     | __main__:run_ml_segmentation:696 - Datos cargados: 166 clientes, 3734 cuenta mesas, 7449 pedidos
2025-06-02 18:07:25.715 | INFO     | __main__:run_ml_segmentation:699 - Preparando características para segmentación de clientes del tenant 1...
2025-06-02 18:07:25.725 | INFO     | __main__:run_ml_segmentation:703 - Ejecutando algoritmo K-means con 4 clusters...
2025-06-02 18:07:27.394 | INFO     | __main__:run_ml_segmentation:708 - Segmentación completada en 1.67 segundos
2025-06-02 18:07:27.395 | INFO     | __main__:run_ml_segmentation:709 - Distribución de clientes por segmento: {2: 48, 3: 43, 0: 38, 1: 37}
2025-06-02 18:07:27.395 | INFO     | __main__:run_ml_segmentation:713 - Generando visualizaciones para segmentación de clientes...
2025-06-02 18:07:27.987 | INFO     | __main__:run_ml_segmentation:715 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-02 18:07:27.988 | INFO     | __main__:run_ml_segmentation:718 - Guardando resultados de la segmentación...
2025-06-02 18:07:27.995 | INFO     | __main__:run_ml_segmentation:722 - Guardando resultados de segmentación en MongoDB...
2025-06-02 18:07:27.997 | ERROR    | __main__:run_ml_segmentation:784 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-02 18:07:27.998 | WARNING  | __main__:main:1096 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 18:07:27.998 | INFO     | __main__:main:1098 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-02 18:07:27.998 | INFO     | __main__:main:1100 - Todos los tenants procesados correctamente
2025-06-02 18:07:27.999 | INFO     | __main__:main:1104 - Procesamiento ML completado. Iniciando servidor GraphQL desde server.py...
2025-06-02 18:07:27.999 | INFO     | __main__:main:1105 - Si deseas ejecutar solo el servidor sin reentrenar modelos ML, ejecuta 'python server.py'
2025-06-02 18:07:28.007 | ERROR    | __main__:main:1117 - Error al iniciar server.py: invalid character '¡' (U+00A1) (server.py, line 1)
2025-06-02 18:07:28.007 | INFO     | __main__:main:1118 - Puedes iniciar el servidor manualmente con: python server.py
2025-06-02 18:07:28.007 | INFO     | __main__:main:1127 - Servicio finalizado. Cerrando conexiones...
2025-06-02 18:07:28.008 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-02 18:07:28.012 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-02 18:11:26.839 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-02 18:11:26.840 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-02 18:11:27.110 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-02 18:11:27.111 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-02 18:11:30.532 | INFO     | __main__:main:1026 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-02 18:11:30.532 | INFO     | __main__:main:1027 - Modo desarrollo: True
2025-06-02 18:11:30.533 | INFO     | __main__:main:1028 - Sistema multi-tenant activado - Fecha actual: 2025-06-02 18:11:30
2025-06-02 18:11:30.533 | INFO     | __main__:main:1029 - Fecha actual como punto pivote: 2025-06-02 00:00:00
2025-06-02 18:11:30.534 | INFO     | __main__:test_connections:103 - Probando conexiones a bases de datos...
2025-06-02 18:11:30.535 | INFO     | __main__:test_connections:110 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-02 18:11:30.537 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-02 18:11:30.537 | INFO     | __main__:test_connections:119 - Conexión a PostgreSQL funciona correctamente
2025-06-02 18:11:30.539 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-02 18:11:30.540 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-02 18:11:30.542 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-02 18:11:30.542 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-02 18:11:30.543 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-02 18:11:30.544 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-02 18:11:30.546 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-02 18:11:30.547 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-02 18:11:30.548 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-02 18:11:30.549 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-02 18:11:30.550 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-02 18:11:30.550 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-02 18:11:30.551 | INFO     | __main__:main:1069 - ======= PROCESANDO TENANT 1 =======
2025-06-02 18:11:30.551 | INFO     | __main__:run_ml_forecast:198 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-02 00:00:00...
2025-06-02 18:11:30.551 | INFO     | __main__:diagnosticar_datos_disponibles:35 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-02 18:11:30.552 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-02 18:11:30.556 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-02 18:11:30.557 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-02 18:11:30.563 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-02 18:11:30.564 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-02 18:11:30.566 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_productos: 31 documentos para tenant 1
2025-06-02 18:11:30.567 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-02 18:11:30.568 | INFO     | __main__:diagnosticar_datos_disponibles:56 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-02 18:11:30.581 | INFO     | __main__:diagnosticar_datos_disponibles:68 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-02 18:11:30.583 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-02 18:11:30.585 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-02 18:11:30.585 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en predicciones_ventas: 2025-06-03 00:00:00
2025-06-02 18:11:30.587 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-02 18:11:30.590 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-02 18:11:30.591 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-02 18:11:30.593 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-02 18:11:30.594 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en predicciones_productos: 2025-06-03 00:00:00
2025-06-02 18:11:30.596 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-02 18:11:30.598 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-02 18:11:30.599 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en ml_predicciones_categoria: 2025-06-03 00:00:00
2025-06-02 18:11:30.601 | INFO     | __main__:diagnosticar_datos_disponibles:92 - Colección cliente_segmentacion: 166 documentos para tenant 1
2025-06-02 18:11:30.602 | INFO     | __main__:diagnosticar_datos_disponibles:97 - Ejemplo de cliente_segmentacion: ['_id', 'cliente_id', 'cluster', 'cluster_nombre', 'num_visitas', 'comensales_promedio', 'gasto_total', 'tenant_id', 'timestamp']
2025-06-02 18:11:30.604 | INFO     | __main__:diagnosticar_datos_disponibles:92 - Colección cluster_perfiles: 4 documentos para tenant 1
2025-06-02 18:11:30.606 | INFO     | __main__:diagnosticar_datos_disponibles:97 - Ejemplo de cluster_perfiles: ['_id', 'cluster_id', 'nombre', 'num_clientes', 'gasto_promedio', 'visitas_promedio', 'comensales_promedio', 'descripcion', 'tenant_id', 'timestamp']
2025-06-02 18:11:30.606 | INFO     | __main__:diagnosticar_datos_disponibles:99 - === FIN DEL DIAGNÓSTICO ===
2025-06-02 18:11:30.607 | INFO     | __main__:run_ml_forecast:248 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-02 18:11:30.608 | INFO     | __main__:run_ml_forecast:261 - Entrenando en CPU
2025-06-02 18:11:48.307 | INFO     | __main__:run_ml_forecast:269 - Entrenamiento del modelo general completado en 17.7 segundos
2025-06-02 18:11:48.307 | INFO     | __main__:run_ml_forecast:273 - Guardando modelo general entrenado para tenant 1...
2025-06-02 18:11:48.336 | INFO     | __main__:run_ml_forecast:276 - Modelo general guardado en models/forecast/tenant_1
2025-06-02 18:11:48.336 | INFO     | __main__:run_ml_forecast:295 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-02 18:14:46.817 | INFO     | __main__:run_ml_forecast:306 - Entrenamiento de 9/10 modelos de productos completado en 178.48 segundos
2025-06-02 18:14:46.817 | INFO     | __main__:run_ml_forecast:310 - Guardando modelos de productos entrenados para tenant 1...
2025-06-02 18:14:47.034 | INFO     | __main__:run_ml_forecast:313 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-02 18:14:47.035 | INFO     | __main__:run_ml_forecast:316 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-02 00:00:00)...
2025-06-02 18:14:47.588 | INFO     | __main__:run_ml_forecast:320 - Predicciones diarias generadas para los próximos 7 días
2025-06-02 18:14:47.589 | INFO     | __main__:run_ml_forecast:323 - Generando predicciones semanales para tenant 1...
2025-06-02 18:14:47.741 | INFO     | __main__:run_ml_forecast:325 - Predicciones semanales generadas para las próximas 1 semanas
2025-06-02 18:14:47.742 | INFO     | __main__:run_ml_forecast:328 - Generando predicciones mensuales para tenant 1...
2025-06-02 18:14:47.894 | INFO     | __main__:run_ml_forecast:330 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-02 18:14:48.075 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 8.231678657466546e-05
2025-06-02 18:14:48.076 | INFO     | __main__:apply_scale_correction:371 - Valor promedio de ventas históricas: 1680.6584000000003
2025-06-02 18:14:48.077 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 16806584.00) a predicciones anormalmente bajas
2025-06-02 18:14:48.077 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 1383.4639881771873
2025-06-02 18:14:48.078 | INFO     | __main__:run_ml_forecast:401 - Corrección de escala aplicada a predicciones diarias
2025-06-02 18:14:48.078 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 0.00014956590712245088
2025-06-02 18:14:48.079 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 3343007.84) a predicciones anormalmente bajas
2025-06-02 18:14:48.079 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 499.99999999999994
2025-06-02 18:14:48.080 | INFO     | __main__:run_ml_forecast:405 - Corrección de escala aplicada a predicciones semanales
2025-06-02 18:14:48.080 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 0.00014956590712245088
2025-06-02 18:14:48.080 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 13372031.36) a predicciones anormalmente bajas
2025-06-02 18:14:48.081 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 1999.9999999999998
2025-06-02 18:14:48.081 | INFO     | __main__:run_ml_forecast:409 - Corrección de escala aplicada a predicciones mensuales
2025-06-02 18:14:48.082 | INFO     | __main__:run_ml_forecast:412 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-02 18:14:48.086 | INFO     | __main__:run_ml_forecast:447 - Guardadas 1 predicciones semanales en MongoDB para tenant 1
2025-06-02 18:14:48.088 | INFO     | __main__:run_ml_forecast:451 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-02 18:14:48.088 | INFO     | __main__:run_ml_forecast:457 - Generando predicciones por producto para tenant 1...
2025-06-02 18:14:50.586 | INFO     | __main__:run_ml_forecast:461 - Predicciones generadas para 9 productos
2025-06-02 18:14:50.587 | INFO     | __main__:apply_product_scale_correction:471 - Valor máximo de predicción por producto antes de corrección: 0.0005235220305621624
2025-06-02 18:14:50.587 | WARNING  | __main__:apply_product_scale_correction:477 - Aplicando corrección de escala (factor: 191013.93) a predicciones por producto
2025-06-02 18:14:50.588 | INFO     | __main__:apply_product_scale_correction:481 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-02 18:14:50.589 | INFO     | __main__:run_ml_forecast:489 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-02 18:14:50.595 | INFO     | __main__:run_ml_forecast:493 - Generando predicciones por categoría para tenant 1...
2025-06-02 18:14:51.701 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 0.0005561974576266948
2025-06-02 18:14:51.701 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 269688.40) a predicciones anormalmente bajas
2025-06-02 18:14:51.702 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 150.0
2025-06-02 18:14:51.702 | INFO     | __main__:run_ml_forecast:501 - Predicciones generadas para 5 categorías
2025-06-02 18:14:51.705 | INFO     | __main__:run_ml_forecast:527 - Guardadas 35 predicciones por categoría en MongoDB para tenant 1
2025-06-02 18:14:51.705 | INFO     | __main__:run_ml_forecast:541 - Generando visualización de predicciones generales para tenant 1...
2025-06-02 18:14:51.885 | ERROR    | __main__:run_ml_forecast:654 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-02 18:14:51.887 | WARNING  | __main__:main:1084 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 18:14:51.887 | INFO     | __main__:run_ml_segmentation:666 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-02 18:14:51.888 | INFO     | __main__:run_ml_segmentation:682 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-02 18:14:51.984 | INFO     | __main__:run_ml_segmentation:696 - Datos cargados: 166 clientes, 3734 cuenta mesas, 7449 pedidos
2025-06-02 18:14:51.985 | INFO     | __main__:run_ml_segmentation:699 - Preparando características para segmentación de clientes del tenant 1...
2025-06-02 18:14:51.995 | INFO     | __main__:run_ml_segmentation:703 - Ejecutando algoritmo K-means con 4 clusters...
2025-06-02 18:14:53.600 | INFO     | __main__:run_ml_segmentation:708 - Segmentación completada en 1.61 segundos
2025-06-02 18:14:53.601 | INFO     | __main__:run_ml_segmentation:709 - Distribución de clientes por segmento: {2: 48, 3: 43, 0: 38, 1: 37}
2025-06-02 18:14:53.601 | INFO     | __main__:run_ml_segmentation:713 - Generando visualizaciones para segmentación de clientes...
2025-06-02 18:14:54.186 | INFO     | __main__:run_ml_segmentation:715 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-02 18:14:54.187 | INFO     | __main__:run_ml_segmentation:718 - Guardando resultados de la segmentación...
2025-06-02 18:14:54.195 | INFO     | __main__:run_ml_segmentation:722 - Guardando resultados de segmentación en MongoDB...
2025-06-02 18:14:54.197 | ERROR    | __main__:run_ml_segmentation:784 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-02 18:14:54.198 | WARNING  | __main__:main:1096 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 18:14:54.198 | INFO     | __main__:main:1098 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-02 18:14:54.199 | INFO     | __main__:main:1100 - Todos los tenants procesados correctamente
2025-06-02 18:14:54.199 | INFO     | __main__:main:1104 - Procesamiento ML completado. Iniciando servidor GraphQL desde server.py...
2025-06-02 18:14:54.200 | INFO     | __main__:main:1105 - Si deseas ejecutar solo el servidor sin reentrenar modelos ML, ejecuta 'python server.py'
2025-06-02 18:40:56.325 | INFO     | __main__:main:1127 - Servicio finalizado. Cerrando conexiones...
2025-06-02 18:40:56.327 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-02 18:40:56.330 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
2025-06-02 18:41:42.220 | INFO     | db.mongo_client:_connect:35 - Conexión a MongoDB establecida: mongodb://localhost:27017/
2025-06-02 18:41:42.221 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.04 segundos
2025-06-02 18:41:42.490 | INFO     | etl.extract:_connect:87 - Conexión a PostgreSQL establecida: postgresql://postgres:will@localhost:5432/microservicio_erp5
2025-06-02 18:41:42.490 | DEBUG    | utils:wrapper:35 - Función _connect ejecutada en 0.07 segundos
2025-06-02 18:41:46.286 | INFO     | __main__:main:1026 - Iniciando Restaurant ML Microservice v0.1.0
2025-06-02 18:41:46.287 | INFO     | __main__:main:1027 - Modo desarrollo: True
2025-06-02 18:41:46.287 | INFO     | __main__:main:1028 - Sistema multi-tenant activado - Fecha actual: 2025-06-02 18:41:46
2025-06-02 18:41:46.288 | INFO     | __main__:main:1029 - Fecha actual como punto pivote: 2025-06-02 00:00:00
2025-06-02 18:41:46.289 | INFO     | __main__:test_connections:103 - Probando conexiones a bases de datos...
2025-06-02 18:41:46.290 | INFO     | __main__:test_connections:110 - Conexión a MongoDB funciona correctamente: versión 8.0.6
2025-06-02 18:41:46.292 | DEBUG    | utils:wrapper:35 - Función execute_query ejecutada en 0.00 segundos
2025-06-02 18:41:46.292 | INFO     | __main__:test_connections:119 - Conexión a PostgreSQL funciona correctamente
2025-06-02 18:41:46.294 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedidos
2025-06-02 18:41:46.295 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_hora_-1' creado en raw_pedidos
2025-06-02 18:41:46.297 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_detalle_id_1' creado en raw_pedido_detalles
2025-06-02 18:41:46.298 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_pedido_id_1' creado en raw_pedido_detalles
2025-06-02 18:41:46.300 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_pedido_detalles
2025-06-02 18:41:46.302 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en raw_productos
2025-06-02 18:41:46.304 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en raw_productos
2025-06-02 18:41:46.306 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_fecha_1_producto_id_1' creado en ventas_diarias
2025-06-02 18:41:46.307 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_producto_id_1' creado en ventas_diarias
2025-06-02 18:41:46.309 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_categoria_id_1' creado en ventas_diarias
2025-06-02 18:41:46.310 | INFO     | db.mongo_client:create_index:172 - Índice 'tenant_id_1_table_name_1' creado en sync_status
2025-06-02 18:41:46.311 | INFO     | db.models:create_indexes:145 - Índices creados para todas las colecciones
2025-06-02 18:41:46.311 | INFO     | __main__:main:1069 - ======= PROCESANDO TENANT 1 =======
2025-06-02 18:41:46.313 | INFO     | __main__:run_ml_forecast:198 - Iniciando módulo de forecasting para tenant 1 con fecha pivote 2025-06-02 00:00:00...
2025-06-02 18:41:46.314 | INFO     | __main__:diagnosticar_datos_disponibles:35 - === DIAGNÓSTICO DE DATOS EN MONGODB PARA TENANT 1 ===
2025-06-02 18:41:46.316 | INFO     | __main__:diagnosticar_datos_disponibles:39 - Colecciones disponibles: ['ml_predicciones_categoria', 'sync_status', 'raw_usuarios', 'cluster_perfiles', 'ml_predicciones', 'raw_clientes', 'raw_productos', 'predicciones_productos', 'raw_reservas', 'ventas_diarias', 'predicciones_ventas', 'raw_pedidos', 'raw_mesas', 'raw_cuenta_mesas', 'raw_pedido_detalles', 'raw_ventas', 'raw_categorias', 'cliente_segmentacion', '1']
2025-06-02 18:41:46.323 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_pedidos: 7449 documentos para tenant 1
2025-06-02 18:41:46.325 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_pedidos: ['_id', 'pedido_id', 'cuenta_mesa_id', 'dia_semana', 'etl_timestamp', 'fecha', 'fecha_hora', 'hora', 'nota', 'tenant_id', 'total']
2025-06-02 18:41:46.335 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_pedido_detalles: 25943 documentos para tenant 1
2025-06-02 18:41:46.337 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_pedido_detalles: ['_id', 'pedido_detalle_id', 'cantidad', 'estado', 'etl_timestamp', 'nota', 'pedido_id', 'precio_unitario', 'producto_id', 'subtotal', 'tenant_id']
2025-06-02 18:41:46.340 | INFO     | __main__:diagnosticar_datos_disponibles:45 - Colección raw_productos: 31 documentos para tenant 1
2025-06-02 18:41:46.342 | INFO     | __main__:diagnosticar_datos_disponibles:50 - Ejemplo de raw_productos: ['_id', 'producto_id', 'activo', 'categoria_id', 'codigo', 'costo', 'descripcion', 'etl_timestamp', 'imagen_url', 'nombre', 'precio', 'preparacion_minutos', 'stock', 'tenant_id', 'unidad_medida']
2025-06-02 18:41:46.343 | INFO     | __main__:diagnosticar_datos_disponibles:56 - Ejemplos de productos disponibles para tenant 1: [ObjectId('68387a1b34901322cba5f918'), ObjectId('6838818a34901322cba600eb'), ObjectId('6838818a34901322cba600ec'), ObjectId('6838818a34901322cba600ed'), ObjectId('6838818a34901322cba600ee')]
2025-06-02 18:41:46.361 | INFO     | __main__:diagnosticar_datos_disponibles:68 - Pedido 6838818934901322cba5f91a tiene 0 detalles
2025-06-02 18:41:46.362 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección predicciones_ventas: 7 documentos para tenant 1
2025-06-02 18:41:46.364 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de predicciones_ventas: ['_id', 'fecha', 'dia', 'prediccion', 'confianza', 'timestamp', 'tipo', 'generado_en', 'generado_por', 'tenant_id']
2025-06-02 18:41:46.365 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en predicciones_ventas: 2025-06-03 00:00:00
2025-06-02 18:41:46.366 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección ml_predicciones: 2 documentos para tenant 1
2025-06-02 18:41:46.367 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de ml_predicciones: ['_id', 'tipo', 'periodo', 'fecha_inicio', 'fecha_fin', 'prediccion', 'confianza', 'timestamp', 'tenant_id']
2025-06-02 18:41:46.369 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección predicciones_productos: 63 documentos para tenant 1
2025-06-02 18:41:46.371 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de predicciones_productos: ['_id', 'fecha', 'dia', 'producto_id', 'nombre_producto', 'prediccion', 'confianza', 'timestamp', 'tenant_id', 'categoria_id']
2025-06-02 18:41:46.372 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en predicciones_productos: 2025-06-03 00:00:00
2025-06-02 18:41:46.374 | INFO     | __main__:diagnosticar_datos_disponibles:79 - Colección ml_predicciones_categoria: 35 documentos para tenant 1
2025-06-02 18:41:46.375 | INFO     | __main__:diagnosticar_datos_disponibles:84 - Ejemplo de ml_predicciones_categoria: ['_id', 'fecha', 'dia', 'categoria_id', 'nombre_categoria', 'prediccion', 'confianza', 'productos', 'timestamp', 'tenant_id']
2025-06-02 18:41:46.375 | INFO     | __main__:diagnosticar_datos_disponibles:86 - Primera fecha en ml_predicciones_categoria: 2025-06-03 00:00:00
2025-06-02 18:41:46.377 | INFO     | __main__:diagnosticar_datos_disponibles:92 - Colección cliente_segmentacion: 166 documentos para tenant 1
2025-06-02 18:41:46.378 | INFO     | __main__:diagnosticar_datos_disponibles:97 - Ejemplo de cliente_segmentacion: ['_id', 'cliente_id', 'cluster', 'cluster_nombre', 'num_visitas', 'comensales_promedio', 'gasto_total', 'tenant_id', 'timestamp']
2025-06-02 18:41:46.379 | INFO     | __main__:diagnosticar_datos_disponibles:92 - Colección cluster_perfiles: 4 documentos para tenant 1
2025-06-02 18:41:46.380 | INFO     | __main__:diagnosticar_datos_disponibles:97 - Ejemplo de cluster_perfiles: ['_id', 'cluster_id', 'nombre', 'num_clientes', 'gasto_promedio', 'visitas_promedio', 'comensales_promedio', 'descripcion', 'tenant_id', 'timestamp']
2025-06-02 18:41:46.380 | INFO     | __main__:diagnosticar_datos_disponibles:99 - === FIN DEL DIAGNÓSTICO ===
2025-06-02 18:41:46.382 | INFO     | __main__:run_ml_forecast:248 - Iniciando entrenamiento de nuevo modelo general para tenant 1...
2025-06-02 18:41:46.382 | INFO     | __main__:run_ml_forecast:261 - Entrenando en CPU
2025-06-02 18:42:44.498 | INFO     | __main__:run_ml_forecast:269 - Entrenamiento del modelo general completado en 58.12 segundos
2025-06-02 18:42:44.499 | INFO     | __main__:run_ml_forecast:273 - Guardando modelo general entrenado para tenant 1...
2025-06-02 18:42:44.559 | INFO     | __main__:run_ml_forecast:276 - Modelo general guardado en models/forecast/tenant_1
2025-06-02 18:42:44.559 | INFO     | __main__:run_ml_forecast:295 - Iniciando entrenamiento de modelos para los top 10 productos del tenant 1...
2025-06-02 18:49:26.627 | INFO     | __main__:run_ml_forecast:306 - Entrenamiento de 9/10 modelos de productos completado en 402.07 segundos
2025-06-02 18:49:26.628 | INFO     | __main__:run_ml_forecast:310 - Guardando modelos de productos entrenados para tenant 1...
2025-06-02 18:49:27.004 | INFO     | __main__:run_ml_forecast:313 - Modelos de productos guardados en models/forecast/tenant_1/products
2025-06-02 18:49:27.004 | INFO     | __main__:run_ml_forecast:316 - Generando predicciones generales para tenant 1 desde fecha actual (2025-06-02 00:00:00)...
2025-06-02 18:49:27.720 | INFO     | __main__:run_ml_forecast:320 - Predicciones diarias generadas para los próximos 15 días
2025-06-02 18:49:27.721 | INFO     | __main__:run_ml_forecast:323 - Generando predicciones semanales para tenant 1...
2025-06-02 18:49:27.980 | INFO     | __main__:run_ml_forecast:325 - Predicciones semanales generadas para las próximas 3 semanas
2025-06-02 18:49:27.980 | INFO     | __main__:run_ml_forecast:328 - Generando predicciones mensuales para tenant 1...
2025-06-02 18:49:28.200 | INFO     | __main__:run_ml_forecast:330 - Predicciones mensuales generadas para los próximos 1 meses
2025-06-02 18:49:28.486 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 6.234181637410074e-05
2025-06-02 18:49:28.486 | INFO     | __main__:apply_scale_correction:371 - Valor promedio de ventas históricas: 1680.6584000000003
2025-06-02 18:49:28.487 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 16806584.00) a predicciones anormalmente bajas
2025-06-02 18:49:28.487 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 1047.7529736038996
2025-06-02 18:49:28.488 | INFO     | __main__:run_ml_forecast:401 - Corrección de escala aplicada a predicciones diarias
2025-06-02 18:49:28.488 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 0.0001340867938779411
2025-06-02 18:49:28.489 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 3728928.00) a predicciones anormalmente bajas
2025-06-02 18:49:28.490 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 500.0
2025-06-02 18:49:28.490 | INFO     | __main__:run_ml_forecast:405 - Corrección de escala aplicada a predicciones semanales
2025-06-02 18:49:28.490 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 0.00021228072455414804
2025-06-02 18:49:28.491 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 9421486.59) a predicciones anormalmente bajas
2025-06-02 18:49:28.491 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 1999.9999999999998
2025-06-02 18:49:28.492 | INFO     | __main__:run_ml_forecast:409 - Corrección de escala aplicada a predicciones mensuales
2025-06-02 18:49:28.492 | INFO     | __main__:run_ml_forecast:412 - Guardando predicciones diarias en MongoDB para tenant 1...
2025-06-02 18:49:28.496 | INFO     | __main__:run_ml_forecast:447 - Guardadas 3 predicciones semanales en MongoDB para tenant 1
2025-06-02 18:49:28.497 | INFO     | __main__:run_ml_forecast:451 - Guardadas 1 predicciones mensuales en MongoDB para tenant 1
2025-06-02 18:49:28.498 | INFO     | __main__:run_ml_forecast:457 - Generando predicciones por producto para tenant 1...
2025-06-02 18:49:32.551 | INFO     | __main__:run_ml_forecast:461 - Predicciones generadas para 9 productos
2025-06-02 18:49:32.552 | INFO     | __main__:apply_product_scale_correction:471 - Valor máximo de predicción por producto antes de corrección: 0.00011816540791187435
2025-06-02 18:49:32.553 | WARNING  | __main__:apply_product_scale_correction:477 - Aplicando corrección de escala (factor: 846271.36) a predicciones por producto
2025-06-02 18:49:32.554 | INFO     | __main__:apply_product_scale_correction:481 - Valor máximo de predicción por producto después de corrección: 100.0
2025-06-02 18:49:32.555 | INFO     | __main__:run_ml_forecast:489 - Guardando predicciones por producto en MongoDB para tenant 1...
2025-06-02 18:49:32.574 | INFO     | __main__:run_ml_forecast:493 - Generando predicciones por categoría para tenant 1...
2025-06-02 18:49:34.597 | INFO     | __main__:apply_scale_correction:350 - Valor máximo de predicción antes de corrección: 0.00013244701403891668
2025-06-02 18:49:34.597 | WARNING  | __main__:apply_scale_correction:375 - Aplicando corrección de escala (factor: 1132528.36) a predicciones anormalmente bajas
2025-06-02 18:49:34.598 | INFO     | __main__:apply_scale_correction:383 - Valor máximo de predicción después de corrección: 150.00000000000003
2025-06-02 18:49:34.599 | INFO     | __main__:run_ml_forecast:501 - Predicciones generadas para 5 categorías
2025-06-02 18:49:34.603 | INFO     | __main__:run_ml_forecast:527 - Guardadas 75 predicciones por categoría en MongoDB para tenant 1
2025-06-02 18:49:34.604 | INFO     | __main__:run_ml_forecast:541 - Generando visualización de predicciones generales para tenant 1...
2025-06-02 18:49:34.888 | ERROR    | __main__:run_ml_forecast:654 - Error en el proceso de forecasting para tenant 1: 'NoneType' object has no attribute 'savefig'
2025-06-02 18:49:34.890 | WARNING  | __main__:main:1084 - El módulo ML de forecasting presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 18:49:34.891 | INFO     | __main__:run_ml_segmentation:666 - Iniciando módulo de segmentación de clientes para tenant 1...
2025-06-02 18:49:34.893 | INFO     | __main__:run_ml_segmentation:682 - Cargando datos para segmentación de clientes del tenant 1...
2025-06-02 18:49:35.022 | INFO     | __main__:run_ml_segmentation:696 - Datos cargados: 166 clientes, 3734 cuenta mesas, 7449 pedidos
2025-06-02 18:49:35.022 | INFO     | __main__:run_ml_segmentation:699 - Preparando características para segmentación de clientes del tenant 1...
2025-06-02 18:49:35.037 | INFO     | __main__:run_ml_segmentation:703 - Ejecutando algoritmo K-means con 4 clusters...
2025-06-02 18:49:36.712 | INFO     | __main__:run_ml_segmentation:708 - Segmentación completada en 1.67 segundos
2025-06-02 18:49:36.714 | INFO     | __main__:run_ml_segmentation:709 - Distribución de clientes por segmento: {2: 48, 3: 43, 0: 38, 1: 37}
2025-06-02 18:49:36.715 | INFO     | __main__:run_ml_segmentation:713 - Generando visualizaciones para segmentación de clientes...
2025-06-02 18:49:37.666 | INFO     | __main__:run_ml_segmentation:715 - Visualizaciones guardadas en plots/tenant_1/segmentation
2025-06-02 18:49:37.666 | INFO     | __main__:run_ml_segmentation:718 - Guardando resultados de la segmentación...
2025-06-02 18:49:37.676 | INFO     | __main__:run_ml_segmentation:722 - Guardando resultados de segmentación en MongoDB...
2025-06-02 18:49:37.678 | ERROR    | __main__:run_ml_segmentation:784 - Error en el proceso de segmentación para tenant 1: "'q'"
2025-06-02 18:49:37.679 | WARNING  | __main__:main:1096 - El módulo ML de segmentación presentó errores para tenant 1. Revisar logs para más detalles.
2025-06-02 18:49:37.680 | INFO     | __main__:main:1098 - ======= FIN PROCESAMIENTO TENANT 1 =======
2025-06-02 18:49:37.680 | INFO     | __main__:main:1100 - Todos los tenants procesados correctamente
2025-06-02 18:49:37.680 | INFO     | __main__:main:1104 - Procesamiento ML completado. Iniciando servidor GraphQL desde server.py...
2025-06-02 18:49:37.681 | INFO     | __main__:main:1105 - Si deseas ejecutar solo el servidor sin reentrenar modelos ML, ejecuta 'python server.py'
2025-06-02 18:56:18.700 | INFO     | __main__:main:1127 - Servicio finalizado. Cerrando conexiones...
2025-06-02 18:56:18.702 | INFO     | etl.extract:close:328 - Conexión a PostgreSQL cerrada
2025-06-02 18:56:18.704 | INFO     | db.mongo_client:close:194 - Conexión a MongoDB cerrada
